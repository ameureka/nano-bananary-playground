# MKSAAS é›†æˆç­–ç•¥ä¸æ¶æ„é¢„ç•™æ–¹æ¡ˆ

> **æ–‡æ¡£ç›®æ ‡**: ä¸ºé¦™è•‰PSä¹å›­æœªæ¥é›†æˆ MKSAAS æ¡†æ¶æä¾›å®Œæ•´çš„ç­–ç•¥è§„åˆ’å’Œæ¶æ„é¢„ç•™æ–¹æ¡ˆ  
> **ç”Ÿæˆæ—¥æœŸ**: 2025-10-27  
> **å†³ç­–çŠ¶æ€**: âœ… å·²ç¡®è®¤ - é‡‡ç”¨åˆ†é˜¶æ®µé›†æˆç­–ç•¥  
> **é€‚ç”¨èŒƒå›´**: Phase 1 (Next.js è¿ç§») çš„æ¶æ„é¢„ç•™è®¾è®¡

---

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [MKSAAS æ¡†æ¶ç‰¹ç‚¹åˆ†æ](#mksaas-æ¡†æ¶ç‰¹ç‚¹åˆ†æ)
3. [å¯¹é½éœ€æ±‚åˆ†æ](#å¯¹é½éœ€æ±‚åˆ†æ)
4. [è¿ç§»æ—¶æœºå†³ç­–](#è¿ç§»æ—¶æœºå†³ç­–)
5. [Phase 1 æ¶æ„é¢„ç•™æ–¹æ¡ˆ](#phase-1-æ¶æ„é¢„ç•™æ–¹æ¡ˆ)
6. [Phase 3 é›†æˆè·¯çº¿å›¾](#phase-3-é›†æˆè·¯çº¿å›¾)
7. [æŠ•èµ„å›æŠ¥åˆ†æ](#æŠ•èµ„å›æŠ¥åˆ†æ)

---

## æ‰§è¡Œæ‘˜è¦

### æ ¸å¿ƒå†³ç­–

**âœ… é‡‡ç”¨åˆ†é˜¶æ®µé›†æˆç­–ç•¥**

```
Phase 1: Next.js åŸºç¡€è¿ç§»ï¼ˆ7-8å‘¨ï¼‰
â”œâ”€â”€ æ¶æ„è¿ç§» + åŠŸèƒ½ä¿æŒ
â”œâ”€â”€ åšå¥½ MKSAAS æ¶æ„é¢„ç•™ï¼ˆ5ä¸ªå…³é”®ç‚¹ï¼‰
â””â”€â”€ é£é™©: ä¸­ç­‰ï¼Œå¯æ§

Phase 2: Tailwind CSS è¿ç§»ï¼ˆ4-6å‘¨ï¼‰
â”œâ”€â”€ æ ·å¼ç°ä»£åŒ–
â””â”€â”€ é£é™©: ä½

Phase 3: MKSAAS é›†æˆï¼ˆ8-12å‘¨ï¼‰
â”œâ”€â”€ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
â”œâ”€â”€ æ•°æ®åº“æ¶æ„
â”œâ”€â”€ è®¢é˜…è®¡è´¹ç³»ç»Ÿ
â””â”€â”€ é£é™©: é«˜ï¼Œä½†åœ¨ç¨³å®šåŸºç¡€ä¸Š

æ€»è®¡: 19-26å‘¨ï¼ˆ4-6ä¸ªæœˆï¼‰
```

### å…³é”®ç†ç”±

1. **é£é™©å¯æ§** - æ¯ä¸ªé˜¶æ®µç‹¬ç«‹ï¼Œé—®é¢˜å®¹æ˜“å®šä½
2. **ä¸šåŠ¡è¿ç»­æ€§** - ä¸å½±å“ç°æœ‰ç”¨æˆ·ä½¿ç”¨
3. **æŠ€æœ¯å€ºåŠ¡æœ€å°** - æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„æŠ€æœ¯ç›®æ ‡
4. **æŠ•èµ„å›æŠ¥é«˜** - Phase 1 çš„ 5 å¤©æŠ•å…¥å¯èŠ‚çœ Phase 3 çš„ 6-7 å‘¨

### Phase 1 å¿…é¡»åšçš„ 5 ä¸ªæ¶æ„é¢„ç•™

1. âœ… æ•°æ®å±‚æŠ½è±¡ï¼ˆæŠ•å…¥ï¼š1å¤©ï¼Œæ”¶ç›Šï¼šèŠ‚çœ2å‘¨ï¼‰
2. âœ… ç”¨æˆ·ä¸Šä¸‹æ–‡é¢„ç•™ï¼ˆæŠ•å…¥ï¼š0.5å¤©ï¼Œæ”¶ç›Šï¼šèŠ‚çœ1å‘¨ï¼‰
3. âœ… API è°ƒç”¨å±‚æŠ½è±¡ï¼ˆæŠ•å…¥ï¼š1å¤©ï¼Œæ”¶ç›Šï¼šèŠ‚çœ1-2å‘¨ï¼‰
4. âœ… æ•°æ®åº“è¡¨è®¾è®¡é¢„ç•™ï¼ˆæŠ•å…¥ï¼š2å¤©ï¼Œæ”¶ç›Šï¼šèŠ‚çœ2-3å‘¨ï¼‰
5. âœ… ç¯å¢ƒå˜é‡æ ‡å‡†åŒ–ï¼ˆæŠ•å…¥ï¼š0.25å¤©ï¼Œæ”¶ç›Šï¼šèŠ‚çœ2-3å¤©ï¼‰

**æ€»æŠ•å…¥**: çº¦ 5 å¤©  
**æ€»æ”¶ç›Š**: èŠ‚çœ 6-7 å‘¨  
**æŠ•èµ„å›æŠ¥ç‡**: çº¦ 800-1000%

---

## MKSAAS æ¡†æ¶ç‰¹ç‚¹åˆ†æ

### ğŸ—ï¸ æ ¸å¿ƒç‰¹ç‚¹

åŸºäºå¯¹ MKSAAS æ–‡æ¡£çš„æ·±å…¥åˆ†æï¼ŒMKSAAS æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§ SaaS å¿«é€Ÿå¼€å‘æ¡†æ¶**ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹ç‚¹ï¼š

#### 1. æŠ€æœ¯æ ˆæ¶æ„

- **å‰ç«¯**: Next.js 15 App Router + React 19
- **åç«¯**: Next.js API Routes + Server Actions
- **æ•°æ®åº“**: PostgreSQL + Drizzle ORM
- **è®¤è¯**: Better Authï¼ˆç°ä»£åŒ–è®¤è¯æ–¹æ¡ˆï¼‰
- **æ”¯ä»˜**: Stripe é›†æˆ
- **UI**: Tailwind CSS + shadcn/ui + Magic UI
- **å›½é™…åŒ–**: Next-intl
- **éƒ¨ç½²**: Vercel/Docker/Cloudflare

#### 2. SaaS æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

```
ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ:
â”œâ”€â”€ ç”¨æˆ·æ³¨å†Œ/ç™»å½•/è®¤è¯ï¼ˆBetter Authï¼‰
â”œâ”€â”€ ç”¨æˆ·è§’è‰²å’Œæƒé™ç®¡ç†
â”œâ”€â”€ ç”¨æˆ·é…ç½®æ–‡ä»¶ç®¡ç†
â”œâ”€â”€ OAuth é›†æˆï¼ˆGoogle/GitHubï¼‰
â””â”€â”€ ä¼šè¯ç®¡ç†

è®¢é˜…è®¡è´¹ç³»ç»Ÿ:
â”œâ”€â”€ ä»·æ ¼è®¡åˆ’é…ç½®ï¼ˆæœˆä»˜/å¹´ä»˜/ç»ˆèº«ï¼‰
â”œâ”€â”€ ä¿¡ç”¨å¥—é¤ç³»ç»Ÿï¼ˆç§¯åˆ†è´­ä¹°ï¼‰
â”œâ”€â”€ Stripe æ”¯ä»˜é›†æˆ
â”œâ”€â”€ ä½¿ç”¨é‡è®¡è´¹
â””â”€â”€ è‡ªåŠ¨ç»­è´¹ç®¡ç†

ä¼ä¸šåŠŸèƒ½:
â”œâ”€â”€ å¤šå…¬å¸/ç»„ç»‡ç®¡ç†
â”œâ”€â”€ å›¢é˜Ÿåä½œåŠŸèƒ½
â”œâ”€â”€ API å¯†é’¥ç®¡ç†
â”œâ”€â”€ ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ
â””â”€â”€ ç®¡ç†åå°

åŸºç¡€è®¾æ–½:
â”œâ”€â”€ é‚®ä»¶ç³»ç»Ÿï¼ˆResend + React Emailï¼‰
â”œâ”€â”€ æ–‡ä»¶å­˜å‚¨ï¼ˆCloudflare R2 / S3ï¼‰
â”œâ”€â”€ è®¡åˆ’ä»»åŠ¡ï¼ˆCron Jobsï¼‰
â”œâ”€â”€ åˆ†æå·¥å…·ï¼ˆVercel Analytics / GAï¼‰
â”œâ”€â”€ é€šçŸ¥ç³»ç»Ÿ
â””â”€â”€ åšå®¢/æ–‡æ¡£ç³»ç»Ÿï¼ˆFumadocsï¼‰
```

#### 3. é…ç½®é©±åŠ¨çš„æ¶æ„ï¼ˆ13 è¦ç´ é…ç½®ç³»ç»Ÿï¼‰

1. æ•°æ®åº“è®¾è®¡ï¼ˆUUID + JSONB + è½¯åˆ é™¤ï¼‰
2. API è®¾è®¡æ¨¡å¼ï¼ˆRESTful + åˆ†å±‚æ¶æ„ï¼‰
3. ç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆç±»å‹å®‰å…¨ï¼‰
4. æ–‡ä»¶å­˜å‚¨ç­–ç•¥ï¼ˆR2/S3ï¼‰
5. å‰ç«¯çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰
6. é”™è¯¯å¤„ç†ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰
7. å›½é™…åŒ–æ¶æ„ï¼ˆNext-intlï¼‰
8. å…ƒæ•°æ®/SEOï¼ˆNext.js Metadata APIï¼‰
9. ä¸»é¢˜ç³»ç»Ÿï¼ˆTailwind + CSS å˜é‡ï¼‰
10. é…ç½®é©±åŠ¨ï¼ˆæ•°æ®åº“é…ç½®ï¼‰
11. ç”¨æˆ·åå¥½ï¼ˆä¸ªæ€§åŒ–è®¾ç½®ï¼‰
12. åˆ†æåŸ‹ç‚¹ï¼ˆäº‹ä»¶è¿½è¸ªï¼‰
13. æ³•å¾‹åˆè§„ï¼ˆéšç§æ”¿ç­–/æœåŠ¡æ¡æ¬¾ï¼‰

#### 4. æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§

```typescript
// MKSAAS çš„æ¨¡å—åŒ–è®¾è®¡
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/            # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â”œâ”€â”€ (marketing)/       # è¥é”€é¡µé¢
â”‚   â”œâ”€â”€ (protected)/       # å—ä¿æŠ¤é¡µé¢ï¼ˆéœ€ç™»å½•ï¼‰
â”‚   â””â”€â”€ api/               # API Routes
â”‚
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/               # åŸºç¡€ UI ç»„ä»¶
â”‚   â”œâ”€â”€ auth/             # è®¤è¯ç»„ä»¶
â”‚   â””â”€â”€ dashboard/        # ä»ªè¡¨æ¿ç»„ä»¶
â”‚
â”œâ”€â”€ lib/                   # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ db.ts             # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ stripe.ts         # æ”¯ä»˜æœåŠ¡
â”‚   â””â”€â”€ credits.ts        # ç§¯åˆ†æœåŠ¡
â”‚
â””â”€â”€ db/                    # æ•°æ®åº“æ¨¡å¼
    â””â”€â”€ schema/           # Drizzle æ¨¡å¼å®šä¹‰
```

---

## å¯¹é½éœ€æ±‚åˆ†æ

### ğŸ¯ é¦™è•‰PSä¹å›­éœ€è¦å¯¹é½çš„ 6 ä¸ªå…³é”®é¢†åŸŸ

#### 1. ç”¨æˆ·è®¤è¯å’Œç®¡ç† ğŸ”´ Critical

**å½“å‰çŠ¶æ€**: 
- æ— ç”¨æˆ·ç³»ç»Ÿï¼Œå®Œå…¨åŒ¿åä½¿ç”¨
- æ— æƒé™æ§åˆ¶
- æ— ç”¨æˆ·æ•°æ®å…³è”

**MKSAAS è¦æ±‚**: 
- å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œç®¡ç†ç³»ç»Ÿï¼ˆBetter Authï¼‰
- æ‰€æœ‰ä¸šåŠ¡æ•°æ®å…³è” `userId`
- è§’è‰²æƒé™ç®¡ç†

**éœ€è¦å¯¹é½çš„è®¾è®¡**:
```typescript
// å½“å‰: åŒ¿åä½¿ç”¨
localStorage.setItem('user-settings', settings);

// MKSAAS å¯¹é½: ç”¨æˆ·å…³è”
const session = await auth.api.getSession();
await updateUserSettings(session.user.id, settings);
```

**Phase 1 æ¶æ„é¢„ç•™æ–¹æ¡ˆ**:
```typescript
// æ•°æ®è¡¨è®¾è®¡æ—¶é¢„ç•™ userId å­—æ®µ
interface Asset {
  id: string;
  userId: string | null;  // ç°åœ¨å¯ä»¥ä¸º nullï¼Œæœªæ¥å¿…å¡«
  imageUrl: string;
  // ...
}

// ç»„ä»¶è®¾è®¡æ—¶æ¥å—ç”¨æˆ·ä¸Šä¸‹æ–‡
interface EditorProps {
  user?: UserContext;  // å¯é€‰ï¼Œæœªæ¥å¿…å¡«
  // ...
}
```

---

#### 2. æ•°æ®æŒä¹…åŒ–æ¶æ„ ğŸ”´ Critical

**å½“å‰çŠ¶æ€**: 
- localStorage å®¢æˆ·ç«¯å­˜å‚¨
- åˆ·æ–°åæ•°æ®å¯èƒ½ä¸¢å¤±
- æ— æ³•è·¨è®¾å¤‡åŒæ­¥

**MKSAAS è¦æ±‚**: 
- PostgreSQL + Drizzle ORM æ•°æ®åº“
- æ‰€æœ‰æ•°æ®æœåŠ¡ç«¯æŒä¹…åŒ–
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œå…³ç³»

**éœ€è¦å¯¹é½çš„è®¾è®¡**:
```typescript
// å½“å‰: å®¢æˆ·ç«¯å­˜å‚¨
const images = useAssetLibraryStore(s => s.assetLibrary);

// MKSAAS å¯¹é½: æ•°æ®åº“å­˜å‚¨
const images = await db.select()
  .from(assets)
  .where(eq(assets.userId, userId));
```

**Phase 1 æ¶æ„é¢„ç•™æ–¹æ¡ˆ**:
```typescript
// åˆ›å»ºå­˜å‚¨é€‚é…å™¨æ¥å£
interface StorageAdapter {
  saveAsset(asset: Asset): Promise<string>;
  getAssets(userId: string): Promise<Asset[]>;
  deleteAsset(id: string): Promise<void>;
}

// Phase 1: localStorage å®ç°
class LocalStorageAdapter implements StorageAdapter { ... }

// Phase 3: æ•°æ®åº“å®ç°
class DatabaseAdapter implements StorageAdapter { ... }
```

---

#### 3. API å¯†é’¥å’Œé…é¢ç®¡ç† ğŸ”´ Critical

**å½“å‰çŠ¶æ€**: 
- ç”¨æˆ·è‡ªå·±æä¾› API å¯†é’¥
- æ— ä½¿ç”¨é™åˆ¶
- API Key æš´éœ²åœ¨å®¢æˆ·ç«¯

**MKSAAS è¦æ±‚**: 
- å¹³å°ç»Ÿä¸€ç®¡ç† API å¯†é’¥
- åŸºäºç§¯åˆ†çš„é…é¢ç³»ç»Ÿ
- åç«¯ä»£ç† API è°ƒç”¨

**éœ€è¦å¯¹é½çš„è®¾è®¡**:
```typescript
// å½“å‰: ç”¨æˆ· API å¯†é’¥
const apiKey = process.env.GEMINI_API_KEY;

// MKSAAS å¯¹é½: å¹³å°é…é¢ç®¡ç†
const credits = await getUserCredits(userId);
if (credits < cost) {
  throw new Error('ç§¯åˆ†ä¸è¶³');
}

await generateImage(prompt, platformApiKey);
await consumeCredits(userId, cost);
```

**Phase 1 æ¶æ„é¢„ç•™æ–¹æ¡ˆ**:
```typescript
// API è°ƒç”¨å±‚æŠ½è±¡
async function generateImage(prompt: string, userId?: string) {
  // Phase 1: ç›´æ¥è°ƒç”¨
  if (!userId) {
    return await geminiService.generateImage(prompt);
  }
  
  // Phase 3: é…é¢æ£€æŸ¥
  await checkQuota(userId);
  const result = await geminiService.generateImage(prompt);
  await recordUsage(userId);
  return result;
}
```

---

#### 4. è®¢é˜…å’Œè®¡è´¹ç³»ç»Ÿ ğŸŸ¡ Medium

**å½“å‰çŠ¶æ€**: 
- å…è´¹ä½¿ç”¨
- æ— å•†ä¸šåŒ–æ¨¡å¼

**MKSAAS è¦æ±‚**: 
- Stripe è®¢é˜…é›†æˆ
- ç§¯åˆ†å¥—é¤è´­ä¹°
- ä½¿ç”¨é‡è®¡è´¹

**éœ€è¦å¯¹é½çš„è®¾è®¡**:
```typescript
// MKSAAS å¯¹é½: è®¡è´¹é›†æˆ
const plan = await getUserSubscriptionPlan(userId);
const cost = calculateImageGenerationCost(effectType, imageSize);

if (plan.type === 'free' && plan.creditsRemaining < cost) {
  throw new Error('ç§¯åˆ†ä¸è¶³ï¼Œè¯·è´­ä¹°ç§¯åˆ†æˆ–å‡çº§å¥—é¤');
}

await chargeCreditOrSubscription(userId, cost);
```

**Phase 1 æ¶æ„é¢„ç•™**: ä¸éœ€è¦å®ç°ï¼Œä½†é¢„ç•™æ¥å£

---

#### 5. å¤šç§Ÿæˆ·æ¶æ„ ğŸŸ¡ Medium

**å½“å‰çŠ¶æ€**: 
- å•ä¸€åº”ç”¨
- æ— ç»„ç»‡/å›¢é˜Ÿæ¦‚å¿µ

**MKSAAS è¦æ±‚**: 
- æ”¯æŒå¤šå…¬å¸/ç»„ç»‡
- å›¢é˜Ÿåä½œåŠŸèƒ½
- èµ„æºéš”ç¦»

**Phase 1 æ¶æ„é¢„ç•™æ–¹æ¡ˆ**:
```typescript
// æ•°æ®è¡¨è®¾è®¡é¢„ç•™
interface Asset {
  id: string;
  userId: string;
  organizationId?: string;  // æœªæ¥æ‰©å±•
  // ...
}
```

---

#### 6. é…ç½®ç³»ç»Ÿå¯¹é½ ğŸŸ¢ Low

**å½“å‰çŠ¶æ€**: 
- ç¡¬ç¼–ç é…ç½®ï¼ˆ86ç§æ•ˆæœï¼‰
- æ— åŠ¨æ€é…ç½®èƒ½åŠ›

**MKSAAS è¦æ±‚**: 
- æ•°æ®åº“é©±åŠ¨çš„é…ç½®ç³»ç»Ÿ
- å¯é€šè¿‡ç®¡ç†åå°ä¿®æ”¹

**Phase 1 æ¶æ„é¢„ç•™**: Phase 2 è€ƒè™‘

---

## è¿ç§»æ—¶æœºå†³ç­–

### ğŸ¤” æ ¸å¿ƒé—®é¢˜ï¼šæœ¬æ¬¡è¿ç§»ä¸­è€ƒè™‘ vs è¿ç§»åè€ƒè™‘ï¼Ÿ

**å†³ç­–ç»“è®º**: âœ… **åˆ†é˜¶æ®µé›†æˆï¼ˆPhase 3 å•ç‹¬å¤„ç†ï¼‰**

### ä¸ºä»€ä¹ˆæ¨è Phase 3 å•ç‹¬å¤„ç†ï¼Ÿ

#### 1. å¤æ‚åº¦ç®¡ç† ğŸ”´ Critical

**å¦‚æœæœ¬æ¬¡è¿ç§»ä¸­åŒæ—¶è€ƒè™‘ MKSAAS**:
```
Next.js è¿ç§»å¤æ‚åº¦: é«˜
+ MKSAAS é›†æˆå¤æ‚åº¦: æé«˜
= æ€»å¤æ‚åº¦: ä¸å¯æ§ ğŸ”´
```

**åˆ†é˜¶æ®µå¤„ç†**:
```
Phase 1: Next.js è¿ç§» (é«˜å¤æ‚åº¦ï¼Œå¯æ§)
Phase 2: Tailwind CSS (ä½å¤æ‚åº¦)
Phase 3: MKSAAS é›†æˆ (é«˜å¤æ‚åº¦ï¼Œä½†åœ¨ç¨³å®šåŸºç¡€ä¸Š)
```

#### 2. æ¶æ„å˜æ›´èŒƒå›´ ğŸ”´ Critical

**MKSAAS é›†æˆéœ€è¦çš„é‡å¤§å˜æ›´**:

```typescript
// æ•°æ®å±‚å®Œå…¨é‡æ„
localStorage â†’ PostgreSQL + Drizzle ORM

// è®¤è¯å±‚ä»æ— åˆ°æœ‰
åŒ¿åä½¿ç”¨ â†’ Better Auth + ç”¨æˆ·ç®¡ç†

// ä¸šåŠ¡é€»è¾‘é‡æ„
å…è´¹ä½¿ç”¨ â†’ é…é¢ç®¡ç† + è®¡è´¹ç³»ç»Ÿ

// API æ¶æ„é‡æ„
ç”¨æˆ·APIå¯†é’¥ â†’ å¹³å°ç»Ÿä¸€ç®¡ç†

// å‰ç«¯ç»„ä»¶é‡æ„
ç‹¬ç«‹ç»„ä»¶ â†’ é›†æˆ MKSAAS Shell
```

è¿™äº›å˜æ›´çš„å½±å“èŒƒå›´å‡ ä¹è¦†ç›–æ•´ä¸ªåº”ç”¨ï¼Œä¸ Next.js è¿ç§»å åŠ é£é™©æé«˜ã€‚

#### 3. æµ‹è¯•å’ŒéªŒè¯å¤æ‚åº¦ ğŸ”´ Critical

**å¦‚æœåŒæ—¶è¿›è¡Œ**:
- éœ€è¦åŒæ—¶æµ‹è¯• Next.js + MKSAAS åŠŸèƒ½
- é—®é¢˜å®šä½å›°éš¾ï¼ˆæ˜¯ Next.js é—®é¢˜è¿˜æ˜¯ MKSAAS é—®é¢˜ï¼Ÿï¼‰
- å›æ»šå›°éš¾ï¼ˆå›æ»šåˆ°å“ªä¸ªçŠ¶æ€ï¼Ÿï¼‰

**åˆ†é˜¶æ®µè¿›è¡Œ**:
- æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„éªŒæ”¶æ ‡å‡†
- é—®é¢˜å®¹æ˜“å®šä½å’Œè§£å†³
- å¯ä»¥ç‹¬ç«‹å›æ»š

#### 4. ä¸šåŠ¡è¿ç»­æ€§ ğŸŸ¡ Medium

**å½“å‰åº”ç”¨å·²ç»æœ‰ç”¨æˆ·åœ¨ä½¿ç”¨**:
- ç”¨æˆ·ä¹ æƒ¯äº†åŒ¿åä½¿ç”¨æ¨¡å¼
- ç”¨æˆ·æœ‰è‡ªå·±çš„ API å¯†é’¥
- ç”¨æˆ·åœ¨ localStorage ä¸­æœ‰æ•°æ®

**å¦‚æœå¼ºåˆ¶è¿ç§»åˆ° MKSAAS**:
- ç”¨æˆ·éœ€è¦æ³¨å†Œè´¦å·
- ç”¨æˆ·éœ€è¦è®¢é˜…ä»˜è´¹è®¡åˆ’
- ç”¨æˆ·æ•°æ®å¯èƒ½ä¸¢å¤±
- å¯èƒ½å¯¼è‡´ç”¨æˆ·æµå¤±

**åˆ†é˜¶æ®µè¿ç§»çš„ä¼˜åŠ¿**:
- Phase 1-2: ä¿æŒç°æœ‰ç”¨æˆ·ä½“éªŒ
- Phase 3: æä¾›é€‰æ‹©ï¼ˆåŒ¿åæ¨¡å¼ + SaaS æ¨¡å¼å¹¶å­˜ï¼‰
- å¹³æ»‘è¿‡æ¸¡ï¼Œé™ä½ç”¨æˆ·æµå¤±é£é™©

---

### å®Œæ•´è¿ç§»è·¯çº¿å›¾

```
Phase 1: Next.js åŸºç¡€è¿ç§»ï¼ˆ7-8å‘¨ï¼‰â­ æœ¬æ¬¡è¿ç§»
â”œâ”€â”€ æ¶æ„è¿ç§» + åŠŸèƒ½ä¿æŒ
â”œâ”€â”€ åšå¥½ MKSAAS æ¶æ„é¢„ç•™ï¼ˆ5ä¸ªå…³é”®ç‚¹ï¼‰
â”œâ”€â”€ æŠ•å…¥ï¼š10-15å¤©çš„é¢å¤–å·¥ä½œ
â””â”€â”€ é£é™©: ä¸­ç­‰ï¼Œå¯æ§

Phase 2: Tailwind CSS è¿ç§»ï¼ˆ4-6å‘¨ï¼‰
â”œâ”€â”€ æ ·å¼ç°ä»£åŒ–
â”œâ”€â”€ å¯¹é½ MKSAAS UI ç»„ä»¶åº“ï¼ˆshadcn/uiï¼‰
â””â”€â”€ é£é™©: ä½

Phase 3: MKSAAS é›†æˆï¼ˆ8-12å‘¨ï¼‰â­ æœªæ¥è®¡åˆ’
â”œâ”€â”€ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
â”œâ”€â”€ æ•°æ®åº“æ¶æ„
â”œâ”€â”€ è®¢é˜…è®¡è´¹ç³»ç»Ÿ
â”œâ”€â”€ å¤šç§Ÿæˆ·æ”¯æŒ
â””â”€â”€ é£é™©: é«˜ï¼Œä½†åœ¨ç¨³å®šåŸºç¡€ä¸Š

æ€»è®¡: 19-26å‘¨ï¼ˆ4-6ä¸ªæœˆï¼‰
```

---

## Phase 1 æ¶æ„é¢„ç•™æ–¹æ¡ˆ

### å¿…é¡»åšçš„ 5 ä¸ªæ¶æ„é¢„ç•™

#### âœ… 1. æ•°æ®å±‚æŠ½è±¡

**æŠ•å…¥**: 1å¤©  
**æ”¶ç›Š**: èŠ‚çœ2å‘¨  
**ä¼˜å…ˆçº§**: ğŸ”´ P0

**å®ç°æ–¹æ¡ˆ**:

```typescript
// lib/storage/adapter.ts
export interface StorageAdapter {
  // èµ„äº§ç®¡ç†
  saveAsset(asset: Asset): Promise<string>;
  getAssets(userId: string, filters?: AssetFilters): Promise<Asset[]>;
  deleteAsset(id: string): Promise<void>;
  
  // ç”¨æˆ·åå¥½
  savePreferences(userId: string, prefs: UserPreferences): Promise<void>;
  getPreferences(userId: string): Promise<UserPreferences>;
}

// lib/storage/local-storage-adapter.ts
export class LocalStorageAdapter implements StorageAdapter {
  async saveAsset(asset: Asset): Promise<string> {
    const assets = JSON.parse(localStorage.getItem('assets') || '[]');
    assets.push(asset);
    localStorage.setItem('assets', JSON.stringify(assets));
    return asset.id;
  }
  
  async getAssets(userId: string): Promise<Asset[]> {
    const assets = JSON.parse(localStorage.getItem('assets') || '[]');
    return assets.filter(a => a.userId === userId);
  }
  
  async deleteAsset(id: string): Promise<void> {
    const assets = JSON.parse(localStorage.getItem('assets') || '[]');
    const filtered = assets.filter(a => a.id !== id);
    localStorage.setItem('assets', JSON.stringify(filtered));
  }
  
  async savePreferences(userId: string, prefs: UserPreferences): Promise<void> {
    localStorage.setItem(`prefs_${userId}`, JSON.stringify(prefs));
  }
  
  async getPreferences(userId: string): Promise<UserPreferences> {
    const prefs = localStorage.getItem(`prefs_${userId}`);
    return prefs ? JSON.parse(prefs) : DEFAULT_PREFERENCES;
  }
}

// lib/storage/index.ts
// Phase 1: ä½¿ç”¨ localStorage
export const storage: StorageAdapter = new LocalStorageAdapter();

// Phase 3: åˆ‡æ¢åˆ°æ•°æ®åº“ï¼ˆåªéœ€æ”¹è¿™ä¸€è¡Œï¼‰
// export const storage: StorageAdapter = new DatabaseAdapter();
```

**ä½¿ç”¨ç¤ºä¾‹**:

```typescript
// åœ¨ç»„ä»¶æˆ– API ä¸­ä½¿ç”¨
import { storage } from '@/lib/storage';

// ä¿å­˜èµ„äº§
const assetId = await storage.saveAsset({
  id: crypto.randomUUID(),
  userId: user.id,
  url: imageUrl,
  prompt: prompt,
  // ...
});

// è·å–èµ„äº§åˆ—è¡¨
const assets = await storage.getAssets(user.id);
```

---

#### âœ… 2. ç”¨æˆ·ä¸Šä¸‹æ–‡é¢„ç•™

**æŠ•å…¥**: 0.5å¤©  
**æ”¶ç›Š**: èŠ‚çœ1å‘¨  
**ä¼˜å…ˆçº§**: ğŸ”´ P0

**å®ç°æ–¹æ¡ˆ**:

```typescript
// types/user.ts
export interface UserContext {
  id: string;  // Phase 1: session ID, Phase 3: real userId
  isAnonymous: boolean;
  email?: string;  // Phase 3 æ·»åŠ 
  plan?: 'free' | 'pro' | 'lifetime';  // Phase 3 æ·»åŠ 
  credits?: number;  // Phase 3 æ·»åŠ 
  settings: UserSettings;
}

export interface UserSettings {
  theme: 'light' | 'dark' | 'system';
  language: 'en' | 'zh';
  defaultEffect?: string;
  defaultAspectRatio: string;
}

// lib/user-context.tsx
'use client';
import { createContext, useContext, useState, useEffect } from 'react';

const UserContext = createContext<UserContext | null>(null);

export function UserProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<UserContext | null>(null);
  
  useEffect(() => {
    // Phase 1: åˆ›å»ºåŒ¿åç”¨æˆ·
    const sessionId = getOrCreateSessionId();
    const settings = loadSettings(sessionId);
    
    setUser({
      id: sessionId,
      isAnonymous: true,
      settings
    });
    
    // Phase 3: ä»è®¤è¯ç³»ç»Ÿè·å–çœŸå®ç”¨æˆ·
    // const session = await auth.api.getSession();
    // if (session) {
    //   setUser({
    //     id: session.user.id,
    //     isAnonymous: false,
    //     email: session.user.email,
    //     plan: session.user.plan,
    //     credits: session.user.credits,
    //     settings: await loadUserSettings(session.user.id)
    //   });
    // }
  }, []);
  
  if (!user) return <LoadingSpinner />;
  
  return (
    <UserContext.Provider value={user}>
      {children}
    </UserContext.Provider>
  );
}

export const useUser = () => {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error('useUser must be used within UserProvider');
  }
  return context;
};

// è¾…åŠ©å‡½æ•°
function getOrCreateSessionId(): string {
  let sessionId = localStorage.getItem('sessionId');
  if (!sessionId) {
    sessionId = crypto.randomUUID();
    localStorage.setItem('sessionId', sessionId);
  }
  return sessionId;
}

function loadSettings(userId: string): UserSettings {
  const stored = localStorage.getItem(`settings_${userId}`);
  return stored ? JSON.parse(stored) : {
    theme: 'system',
    language: 'en',
    defaultAspectRatio: 'Auto'
  };
}
```

**ä½¿ç”¨ç¤ºä¾‹**:

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
'use client';
import { useUser } from '@/lib/user-context';

export function ImageEditor() {
  const user = useUser();
  
  return (
    <div>
      <p>User ID: {user.id}</p>
      <p>Anonymous: {user.isAnonymous ? 'Yes' : 'No'}</p>
      {/* Phase 3 ä¼šæ˜¾ç¤ºæ›´å¤šä¿¡æ¯ */}
      {user.email && <p>Email: {user.email}</p>}
      {user.credits !== undefined && <p>Credits: {user.credits}</p>}
    </div>
  );
}
```

---

#### âœ… 3. API è°ƒç”¨å±‚æŠ½è±¡

**æŠ•å…¥**: 1å¤©  
**æ”¶ç›Š**: èŠ‚çœ1-2å‘¨  
**ä¼˜å…ˆçº§**: ğŸ”´ P0

**å®ç°æ–¹æ¡ˆ**:

```typescript
// lib/api/image-api.ts
export interface ImageGenerationParams {
  prompt: string;
  effect?: string;
  userId?: string;  // Phase 1: å¯é€‰, Phase 3: å¿…å¡«
  images?: string[];
  mask?: string;
  aspectRatio?: string;
}

export interface ImageGenerationResult {
  id: string;
  url: string;
  thumbnailUrl?: string;
  metadata: {
    prompt: string;
    effect?: string;
    generationTime: number;
  };
}

export async function generateImage(
  params: ImageGenerationParams
): Promise<ImageGenerationResult> {
  // Phase 1: ç›´æ¥è°ƒç”¨ Gemini Service
  const startTime = Date.now();
  
  const result = await geminiService.generateImage({
    prompt: params.prompt,
    effect: params.effect,
    images: params.images,
    mask: params.mask,
    aspectRatio: params.aspectRatio
  });
  
  const generationTime = Date.now() - startTime;
  
  // Phase 3: æ·»åŠ é…é¢æ£€æŸ¥ï¼ˆåªéœ€å–æ¶ˆæ³¨é‡Šï¼‰
  // if (params.userId) {
  //   await checkQuota(params.userId, 'image_generation', 1);
  //   await recordUsage(params.userId, 'image_generation', 1, {
  //     effect: params.effect,
  //     generationTime
  //   });
  // }
  
  // ä¿å­˜åˆ°å­˜å‚¨
  const asset: Asset = {
    id: crypto.randomUUID(),
    userId: params.userId || 'anonymous',
    type: 'image',
    url: result.imageUrl,
    prompt: params.prompt,
    effect: params.effect,
    metadata: {
      generationTime
    },
    createdAt: new Date()
  };
  
  await storage.saveAsset(asset);
  
  return {
    id: asset.id,
    url: asset.url,
    metadata: {
      prompt: params.prompt,
      effect: params.effect,
      generationTime
    }
  };
}

// Phase 3: é…é¢ç®¡ç†å‡½æ•°ï¼ˆé¢„ç•™ï¼‰
// async function checkQuota(
//   userId: string,
//   action: string,
//   cost: number
// ): Promise<void> {
//   const credits = await getUserCredits(userId);
//   if (credits < cost) {
//     throw new Error('INSUFFICIENT_CREDITS');
//   }
// }

// async function recordUsage(
//   userId: string,
//   action: string,
//   cost: number,
//   metadata?: any
// ): Promise<void> {
//   await consumeCredits(userId, cost);
//   await db.insert(usageLogs).values({
//     userId,
//     action,
//     creditsUsed: cost,
//     details: metadata
//   });
// }
```

**ä½¿ç”¨ç¤ºä¾‹**:

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { generateImage } from '@/lib/api/image-api';
import { useUser } from '@/lib/user-context';

export function ImageEditor() {
  const user = useUser();
  
  const handleGenerate = async () => {
    try {
      const result = await generateImage({
        prompt: prompt,
        effect: selectedEffect,
        userId: user.id  // Phase 1: session ID, Phase 3: real userId
      });
      
      console.log('Generated:', result);
    } catch (error) {
      if (error.message === 'INSUFFICIENT_CREDITS') {
        // æ˜¾ç¤ºè´­ä¹°ç§¯åˆ†æç¤º
      }
    }
  };
  
  return <button onClick={handleGenerate}>Generate</button>;
}
```

---

#### âœ… 4. æ•°æ®åº“è¡¨è®¾è®¡é¢„ç•™

**æŠ•å…¥**: 2å¤©  
**æ”¶ç›Š**: èŠ‚çœ2-3å‘¨  
**ä¼˜å…ˆçº§**: ğŸ”´ P0

**å®ç°æ–¹æ¡ˆ**:

```typescript
// db/schema/assets.ts
import { pgTable, uuid, text, timestamp, jsonb, integer, index } from 'drizzle-orm/pg-core';

export const assets = pgTable('assets', {
  // ä¸»é”®
  id: uuid('id').primaryKey().defaultRandom(),
  
  // ğŸ”‘ å…³é”®ï¼šé¢„ç•™ userId å­—æ®µ
  // Phase 1: nullable, Phase 3: NOT NULL + FK
  userId: uuid('user_id'),
  
  // èµ„äº§ä¿¡æ¯
  type: text('type').notNull(),  // 'image' | 'video'
  url: text('url').notNull(),
  thumbnailUrl: text('thumbnail_url'),
  
  // ç”Ÿæˆä¿¡æ¯
  prompt: text('prompt'),
  effect: text('effect'),
  
  // ğŸ”‘ å…³é”®ï¼šä½¿ç”¨ JSONB å­˜å‚¨çµæ´»æ•°æ®
  metadata: jsonb('metadata').$type<{
    width?: number;
    height?: number;
    fileSize?: number;
    mimeType?: string;
    aspectRatio?: string;
    generationTime?: number;
    aiModel?: string;
    // Phase 3 å¯ä»¥æ·»åŠ æ›´å¤šå­—æ®µï¼Œæ— éœ€ä¿®æ”¹è¡¨ç»“æ„
    creditsUsed?: number;
    subscriptionTier?: string;
  }>(),
  
  // ç»Ÿè®¡ï¼ˆå¯é€‰ï¼‰
  viewCount: integer('view_count').default(0),
  downloadCount: integer('download_count').default(0),
  
  // æ—¶é—´æˆ³
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
  deletedAt: timestamp('deleted_at'),  // è½¯åˆ é™¤
}, (table) => ({
  // ç´¢å¼•ï¼ˆæå‰è§„åˆ’ï¼‰
  userIdIdx: index('assets_user_id_idx').on(table.userId),
  createdAtIdx: index('assets_created_at_idx').on(table.createdAt),
  typeIdx: index('assets_type_idx').on(table.type),
}));

// TypeScript ç±»å‹æ¨å¯¼
export type Asset = typeof assets.$inferSelect;
export type NewAsset = typeof assets.$inferInsert;

// db/schema/user-preferences.ts
export const userPreferences = pgTable('user_preferences', {
  id: uuid('id').primaryKey().defaultRandom(),
  userId: uuid('user_id'),  // ç°åœ¨å¯ä»¥ç”¨ session IDï¼Œæœªæ¥ç”¨çœŸå® userId
  
  // UI åå¥½
  theme: text('theme').default('light'),  // 'light' | 'dark' | 'system'
  language: text('language').default('en'),
  
  // ä¸šåŠ¡åå¥½
  defaultEffect: text('default_effect'),
  defaultAspectRatio: text('default_aspect_ratio').default('Auto'),
  autoSaveAssets: boolean('auto_save_assets').default(true),
  
  // é€šçŸ¥åå¥½ï¼ˆæœªæ¥ç”¨ï¼‰
  emailNotifications: boolean('email_notifications').default(true),
  
  // æ—¶é—´æˆ³
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

// db/schema/usage-logs.ts (Phase 3 éœ€è¦)
export const usageLogs = pgTable('usage_logs', {
  id: uuid('id').primaryKey().defaultRandom(),
  userId: uuid('user_id').notNull(),
  
  // æ“ä½œä¿¡æ¯
  action: text('action').notNull(), // 'image_generation' | 'image_edit' | 'video_generation'
  creditsUsed: integer('credits_used').notNull(),
  
  // å…³è”èµ„äº§
  assetId: uuid('asset_id').references(() => assets.id),
  
  // è¯¦ç»†ä¿¡æ¯
  details: jsonb('details').$type<{
    effect?: string;
    model?: string;
    prompt?: string;
    success?: boolean;
    errorMessage?: string;
  }>(),
  
  createdAt: timestamp('created_at').defaultNow().notNull()
});
```

**æ•°æ®åº“è¿ç§»ç­–ç•¥**:

```typescript
// Phase 1: åˆ›å»ºè¡¨ï¼ˆuserId å¯ä¸º nullï¼‰
CREATE TABLE assets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID,  -- å¯ä¸º null
  type TEXT NOT NULL,
  url TEXT NOT NULL,
  -- ...
);

// Phase 3: æ·»åŠ å¤–é”®çº¦æŸ
ALTER TABLE assets 
ADD CONSTRAINT assets_user_id_fkey 
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;

-- æ›´æ–°ç°æœ‰æ•°æ®ï¼ˆå°†åŒ¿åç”¨æˆ·è¿ç§»ï¼‰
UPDATE assets 
SET user_id = (SELECT id FROM users WHERE email = 'migration@example.com')
WHERE user_id IS NULL;

-- è®¾ç½®ä¸º NOT NULL
ALTER TABLE assets 
ALTER COLUMN user_id SET NOT NULL;
```

**æ•°æ®åº“é€‰æ‹©å»ºè®®**:

| æ•°æ®åº“ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èåº¦ |
|--------|------|------|--------|
| **Neon (PostgreSQL)** | å…è´¹å±‚æ…·æ…¨ã€è‡ªåŠ¨æ‰©å±•ã€ä¸ MKSAAS å®Œå…¨å…¼å®¹ | éœ€è¦ç½‘ç»œè¿æ¥ | â­â­â­â­â­ |
| **Supabase (PostgreSQL)** | åŠŸèƒ½ä¸°å¯Œã€å®æ—¶è®¢é˜…ã€è®¤è¯é›†æˆ | ç¨å¤æ‚ | â­â­â­â­ |
| **Cloudflare D1 (SQLite)** | è¾¹ç¼˜è®¡ç®—ã€ä½å»¶è¿Ÿ | éœ€è¦è¿ç§»åˆ° PostgreSQL | â­â­â­ |

**æ¨è**: **Neon PostgreSQL**ï¼ˆä¸ MKSAAS å®Œå…¨å…¼å®¹ï¼Œæ— éœ€æ•°æ®è¿ç§»ï¼‰

---

#### âœ… 5. ç¯å¢ƒå˜é‡æ ‡å‡†åŒ–

**æŠ•å…¥**: 0.25å¤©ï¼ˆ2å°æ—¶ï¼‰  
**æ”¶ç›Š**: èŠ‚çœ2-3å¤©  
**ä¼˜å…ˆçº§**: ğŸŸ¡ P1

**å®ç°æ–¹æ¡ˆ**:

```bash
# .env.example

# ============================================
# æ•°æ®åº“é…ç½®ï¼ˆPhase 1 éœ€è¦ï¼‰
# ============================================
DATABASE_URL=postgresql://user:password@host:5432/dbname

# ============================================
# AI æœåŠ¡é…ç½®ï¼ˆPhase 1 éœ€è¦ï¼‰
# ============================================
GEMINI_API_KEY=your_gemini_api_key_here
OPENAI_API_KEY=your_openai_api_key_here  # å¯é€‰

# ============================================
# æ–‡ä»¶å­˜å‚¨é…ç½®ï¼ˆPhase 1 éœ€è¦ï¼‰
# ============================================
# Cloudflare R2
R2_ACCOUNT_ID=your_account_id
R2_ACCESS_KEY_ID=your_access_key
R2_SECRET_ACCESS_KEY=your_secret_key
R2_BUCKET_NAME=your_bucket_name
R2_PUBLIC_URL=https://your-bucket.r2.dev

# ============================================
# åº”ç”¨é…ç½®
# ============================================
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME="Nano Bananary"

# ============================================
# è®¤è¯é…ç½®ï¼ˆPhase 3 éœ€è¦ï¼Œç°åœ¨é¢„ç•™ï¼‰
# ============================================
# BETTER_AUTH_SECRET=
# BETTER_AUTH_URL=
# GOOGLE_CLIENT_ID=
# GOOGLE_CLIENT_SECRET=
# GITHUB_CLIENT_ID=
# GITHUB_CLIENT_SECRET=

# ============================================
# æ”¯ä»˜é…ç½®ï¼ˆPhase 3 éœ€è¦ï¼Œç°åœ¨é¢„ç•™ï¼‰
# ============================================
# STRIPE_SECRET_KEY=
# STRIPE_PUBLISHABLE_KEY=
# STRIPE_WEBHOOK_SECRET=

# ============================================
# é‚®ä»¶é…ç½®ï¼ˆPhase 3 éœ€è¦ï¼Œç°åœ¨é¢„ç•™ï¼‰
# ============================================
# RESEND_API_KEY=

# ============================================
# åˆ†æé…ç½®ï¼ˆå¯é€‰ï¼‰
# ============================================
# NEXT_PUBLIC_GA_ID=
# NEXT_PUBLIC_UMAMI_ID=
```

**ç±»å‹å®‰å…¨çš„ç¯å¢ƒå˜é‡**:

```typescript
// config/env.ts
import { z } from 'zod';

// å®šä¹‰ç¯å¢ƒå˜é‡ schema
const envSchema = z.object({
  // æ•°æ®åº“
  DATABASE_URL: z.string().url(),
  
  // AI æœåŠ¡
  GEMINI_API_KEY: z.string().min(1),
  OPENAI_API_KEY: z.string().optional(),
  
  // å­˜å‚¨
  R2_ACCOUNT_ID: z.string().min(1),
  R2_ACCESS_KEY_ID: z.string().min(1),
  R2_SECRET_ACCESS_KEY: z.string().min(1),
  R2_BUCKET_NAME: z.string().min(1),
  R2_PUBLIC_URL: z.string().url(),
  
  // åº”ç”¨
  NEXT_PUBLIC_APP_URL: z.string().url(),
  NEXT_PUBLIC_APP_NAME: z.string().default('Nano Bananary'),
  
  // æœªæ¥çš„é…ç½®ï¼ˆoptionalï¼‰
  BETTER_AUTH_SECRET: z.string().optional(),
  STRIPE_SECRET_KEY: z.string().optional(),
  RESEND_API_KEY: z.string().optional(),
});

// éªŒè¯å¹¶å¯¼å‡º
export const env = envSchema.parse(process.env);

// TypeScript ç±»å‹æ¨å¯¼
export type Env = z.infer<typeof envSchema>;
```

**ä½¿ç”¨æ–¹å¼**:

```typescript
// âœ… ç±»å‹å®‰å…¨
import { env } from '@/config/env';

const apiKey = env.GEMINI_API_KEY;  // string
const appUrl = env.NEXT_PUBLIC_APP_URL;  // string

// âŒ ç¼–è¯‘é”™è¯¯
const invalid = env.INVALID_KEY;  // TypeScript æŠ¥é”™
```

---

### Phase 1 ä¸åº”è¯¥åšçš„äº‹æƒ…

#### âŒ 1. ä¸å¼•å…¥ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âŒ ä¸å®‰è£… Better Auth
- âŒ ä¸è®¾è®¡ç”¨æˆ·æ³¨å†Œæµç¨‹
- âŒ ä¸å¤„ç†ä¼šè¯ç®¡ç†
- âœ… ä½†æ˜¯ï¼šé¢„ç•™ç”¨æˆ·ä¸Šä¸‹æ–‡æ¥å£

#### âŒ 2. ä¸å¼•å…¥è®¡è´¹ç³»ç»Ÿ
- âŒ ä¸é›†æˆ Stripe
- âŒ ä¸è®¾è®¡è®¢é˜…é€»è¾‘
- âŒ ä¸å¤„ç†é…é¢ç®¡ç†
- âœ… ä½†æ˜¯ï¼šé¢„ç•™é…é¢æ£€æŸ¥æ¥å£

#### âŒ 3. ä¸é‡æ„æ‰€æœ‰ç»„ä»¶
- âŒ ä¸å¼ºåˆ¶ä½¿ç”¨ MKSAAS çš„ UI ç»„ä»¶
- âŒ ä¸ä¿®æ”¹ç°æœ‰çš„ç»„ä»¶ç»“æ„
- âœ… ä½†æ˜¯ï¼šä¿æŒç»„ä»¶æ¨¡å—åŒ–ï¼Œä¾¿äºæœªæ¥é›†æˆ

#### âŒ 4. ä¸è¿‡åº¦è®¾è®¡
- âŒ ä¸å®ç°æœªæ¥æ‰éœ€è¦çš„åŠŸèƒ½
- âŒ ä¸æ·»åŠ ä¸å¿…è¦çš„æŠ½è±¡å±‚
- âœ… ä½†æ˜¯ï¼šä¿æŒä»£ç æ¸…æ™°å’Œå¯æ‰©å±•

---

### Phase 1 å®æ–½æ£€æŸ¥æ¸…å•

**æ•°æ®å±‚æŠ½è±¡**:
- [ ] åˆ›å»º `StorageAdapter` æ¥å£
- [ ] å®ç° `LocalStorageAdapter`
- [ ] é¢„ç•™ `DatabaseAdapter` æ¥å£
- [ ] åœ¨æ‰€æœ‰æ•°æ®æ“ä½œä¸­ä½¿ç”¨é€‚é…å™¨

**ç”¨æˆ·ä¸Šä¸‹æ–‡**:
- [ ] å®šä¹‰ `UserContext` æ¥å£
- [ ] åˆ›å»º `UserProvider` ç»„ä»¶
- [ ] å®ç° `useUser` hook
- [ ] åœ¨æ ¹å¸ƒå±€ä¸­ä½¿ç”¨ `UserProvider`

**API è°ƒç”¨å±‚**:
- [ ] åˆ›å»ºç»Ÿä¸€çš„ API å‡½æ•°
- [ ] é¢„ç•™é…é¢æ£€æŸ¥æ¥å£
- [ ] æ·»åŠ é”™è¯¯å¤„ç†
- [ ] å®ç°ä½¿ç”¨è®°å½•ï¼ˆå¯é€‰ï¼‰

**æ•°æ®åº“è®¾è®¡**:
- [ ] è®¾è®¡ `assets` è¡¨ï¼ˆé¢„ç•™ userIdï¼‰
- [ ] è®¾è®¡ `userPreferences` è¡¨
- [ ] ä½¿ç”¨ UUID ä½œä¸ºä¸»é”®
- [ ] æ·»åŠ  JSONB metadata å­—æ®µ
- [ ] åˆ›å»ºå¿…è¦çš„ç´¢å¼•

**ç¯å¢ƒå˜é‡**:
- [ ] åˆ›å»º `.env.example`
- [ ] éµå¾ª MKSAAS å‘½åè§„èŒƒ
- [ ] ä½¿ç”¨ Zod éªŒè¯
- [ ] é¢„ç•™æœªæ¥éœ€è¦çš„å˜é‡

---

## Phase 3 é›†æˆè·¯çº¿å›¾

### è¯¦ç»†å®æ–½è®¡åˆ’ï¼ˆ8-12å‘¨ï¼‰

#### Week 1-2: ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

**ç›®æ ‡**: é›†æˆ Better Authï¼Œå®ç°ç”¨æˆ·æ³¨å†Œ/ç™»å½•

**ä»»åŠ¡æ¸…å•**:
- [ ] å®‰è£… Better Auth ä¾èµ–
- [ ] é…ç½®è®¤è¯æä¾›å•†ï¼ˆEmail/Password, Google, GitHubï¼‰
- [ ] åˆ›å»ºç”¨æˆ·æ³¨å†Œ/ç™»å½•é¡µé¢
- [ ] å®ç°ä¼šè¯ç®¡ç†
- [ ] åˆ›å»ºç”¨æˆ·ä»ªè¡¨æ¿
- [ ] æµ‹è¯•è®¤è¯æµç¨‹

**æŠ€æœ¯è¦ç‚¹**:
```typescript
// lib/auth.ts
import { betterAuth } from 'better-auth';

export const auth = betterAuth({
  database: {
    provider: 'postgres',
    url: env.DATABASE_URL
  },
  emailAndPassword: {
    enabled: true
  },
  socialProviders: {
    google: {
      clientId: env.GOOGLE_CLIENT_ID,
      clientSecret: env.GOOGLE_CLIENT_SECRET
    }
  }
});
```

**æ•°æ®è¿ç§»**:
```typescript
// è¿ç§»åŒ¿åç”¨æˆ·æ•°æ®
async function migrateAnonymousData(sessionId: string, userId: string) {
  // 1. æ›´æ–° assets è¡¨
  await db.update(assets)
    .set({ userId })
    .where(eq(assets.userId, sessionId));
  
  // 2. æ›´æ–° userPreferences è¡¨
  await db.update(userPreferences)
    .set({ userId })
    .where(eq(userPreferences.userId, sessionId));
}
```

---

#### Week 3-4: æ•°æ®åº“æ¶æ„è¿ç§»

**ç›®æ ‡**: å°† localStorage æ•°æ®å®Œå…¨è¿ç§»åˆ° PostgreSQL

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `DatabaseAdapter`
- [ ] åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬
- [ ] æ·»åŠ å¤–é”®çº¦æŸ
- [ ] å®ç°æ•°æ®åŒæ­¥é€»è¾‘
- [ ] æµ‹è¯•æ•°æ®å®Œæ•´æ€§
- [ ] ç§»é™¤ `LocalStorageAdapter`

**æŠ€æœ¯è¦ç‚¹**:
```typescript
// lib/storage/database-adapter.ts
export class DatabaseAdapter implements StorageAdapter {
  async saveAsset(asset: Asset): Promise<string> {
    const [result] = await db.insert(assets)
      .values(asset)
      .returning();
    return result.id;
  }
  
  async getAssets(userId: string, filters?: AssetFilters): Promise<Asset[]> {
    let query = db.select().from(assets).where(eq(assets.userId, userId));
    
    if (filters?.type) {
      query = query.where(eq(assets.type, filters.type));
    }
    
    return query.orderBy(desc(assets.createdAt));
  }
  
  async deleteAsset(id: string): Promise<void> {
    // è½¯åˆ é™¤
    await db.update(assets)
      .set({ deletedAt: new Date() })
      .where(eq(assets.id, id));
  }
}

// lib/storage/index.ts
// Phase 3: åˆ‡æ¢åˆ°æ•°æ®åº“
export const storage: StorageAdapter = new DatabaseAdapter();
```

---

#### Week 5-6: API é…é¢ç®¡ç†

**ç›®æ ‡**: å®ç°ç§¯åˆ†ç³»ç»Ÿå’Œé…é¢æ£€æŸ¥

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºç§¯åˆ†ç®¡ç†æœåŠ¡
- [ ] å®ç°é…é¢æ£€æŸ¥é€»è¾‘
- [ ] æ·»åŠ ä½¿ç”¨è®°å½•
- [ ] åˆ›å»ºç§¯åˆ†è´­ä¹°é¡µé¢
- [ ] å®ç°ç§¯åˆ†æ¶ˆè´¹é€šçŸ¥
- [ ] æµ‹è¯•é…é¢é™åˆ¶

**æŠ€æœ¯è¦ç‚¹**:
```typescript
// lib/credits.ts
export async function getUserCredits(userId: string): Promise<number> {
  const [user] = await db.select({ credits: users.credits })
    .from(users)
    .where(eq(users.id, userId));
  return user?.credits || 0;
}

export async function consumeCredits(
  userId: string,
  amount: number,
  metadata?: any
): Promise<void> {
  await db.transaction(async (tx) => {
    // 1. æ£€æŸ¥ä½™é¢
    const credits = await getUserCredits(userId);
    if (credits < amount) {
      throw new Error('INSUFFICIENT_CREDITS');
    }
    
    // 2. æ‰£é™¤ç§¯åˆ†
    await tx.update(users)
      .set({ credits: sql`credits - ${amount}` })
      .where(eq(users.id, userId));
    
    // 3. è®°å½•ä½¿ç”¨
    await tx.insert(creditTransactions).values({
      userId,
      amount: -amount,
      type: 'consumption',
      metadata
    });
  });
}

// lib/api/image-api.ts (æ›´æ–°)
export async function generateImage(params: ImageGenerationParams) {
  // Phase 3: æ·»åŠ é…é¢æ£€æŸ¥
  if (params.userId) {
    await checkQuota(params.userId, 'image_generation', 1);
  }
  
  const result = await geminiService.generateImage(params);
  
  // è®°å½•ä½¿ç”¨
  if (params.userId) {
    await recordUsage(params.userId, 'image_generation', 1, {
      effect: params.effect,
      prompt: params.prompt
    });
  }
  
  return result;
}
```

---

#### Week 7-8: è®¢é˜…è®¡è´¹ç³»ç»Ÿ

**ç›®æ ‡**: é›†æˆ Stripeï¼Œå®ç°è®¢é˜…å’Œä¸€æ¬¡æ€§è´­ä¹°

**ä»»åŠ¡æ¸…å•**:
- [ ] é…ç½® Stripe äº§å“å’Œä»·æ ¼
- [ ] åˆ›å»ºå®šä»·é¡µé¢
- [ ] å®ç°è®¢é˜…æµç¨‹
- [ ] å®ç°ç§¯åˆ†è´­ä¹°æµç¨‹
- [ ] å¤„ç† Webhook äº‹ä»¶
- [ ] åˆ›å»ºå®¢æˆ·é—¨æˆ·
- [ ] æµ‹è¯•æ”¯ä»˜æµç¨‹

**æŠ€æœ¯è¦ç‚¹**:
```typescript
// lib/stripe.ts
import Stripe from 'stripe';

export const stripe = new Stripe(env.STRIPE_SECRET_KEY, {
  apiVersion: '2023-10-16'
});

export async function createCheckoutSession(
  userId: string,
  priceId: string
): Promise<string> {
  const session = await stripe.checkout.sessions.create({
    customer: await getOrCreateStripeCustomer(userId),
    line_items: [{ price: priceId, quantity: 1 }],
    mode: 'subscription',
    success_url: `${env.NEXT_PUBLIC_APP_URL}/dashboard?success=true`,
    cancel_url: `${env.NEXT_PUBLIC_APP_URL}/pricing?canceled=true`
  });
  
  return session.url!;
}

// app/api/webhooks/stripe/route.ts
export async function POST(req: Request) {
  const body = await req.text();
  const sig = req.headers.get('stripe-signature')!;
  
  const event = stripe.webhooks.constructEvent(
    body,
    sig,
    env.STRIPE_WEBHOOK_SECRET
  );
  
  switch (event.type) {
    case 'checkout.session.completed':
      await handleCheckoutCompleted(event.data.object);
      break;
    case 'customer.subscription.updated':
      await handleSubscriptionUpdated(event.data.object);
      break;
    // ...
  }
  
  return Response.json({ received: true });
}
```

**å®šä»·æ–¹æ¡ˆç¤ºä¾‹**:
```typescript
// config/pricing.ts
export const PRICING_PLANS = {
  free: {
    name: 'Free',
    price: 0,
    credits: 10,
    features: ['åŸºç¡€å›¾åƒç”Ÿæˆ', '10 å…è´¹ç§¯åˆ†', 'æ ‡å‡†æ•ˆæœ']
  },
  pro: {
    name: 'Pro',
    price: 19,
    interval: 'month',
    credits: 200,
    features: ['æ‰€æœ‰å›¾åƒç”ŸæˆåŠŸèƒ½', 'æ¯æœˆ 200 ç§¯åˆ†', 'é«˜çº§æ•ˆæœ', 'ä¼˜å…ˆæ”¯æŒ']
  },
  lifetime: {
    name: 'Lifetime',
    price: 199,
    credits: -1, // æ— é™
    features: ['ç»ˆèº«è®¿é—®', 'æ— é™ç§¯åˆ†', 'æ‰€æœ‰åŠŸèƒ½', 'VIP æ”¯æŒ']
  }
};
```

---

#### Week 9-10: å¤šç§Ÿæˆ·æ”¯æŒï¼ˆå¯é€‰ï¼‰

**ç›®æ ‡**: æ·»åŠ ç»„ç»‡/å›¢é˜ŸåŠŸèƒ½

**ä»»åŠ¡æ¸…å•**:
- [ ] è®¾è®¡ç»„ç»‡æ•°æ®æ¨¡å‹
- [ ] å®ç°ç»„ç»‡åˆ›å»º/ç®¡ç†
- [ ] æ·»åŠ å›¢é˜Ÿæˆå‘˜é‚€è¯·
- [ ] å®ç°èµ„æºéš”ç¦»
- [ ] åˆ›å»ºç»„ç»‡ä»ªè¡¨æ¿
- [ ] æµ‹è¯•å¤šç§Ÿæˆ·åŠŸèƒ½

**æŠ€æœ¯è¦ç‚¹**:
```typescript
// db/schema/organizations.ts
export const organizations = pgTable('organizations', {
  id: uuid('id').primaryKey().defaultRandom(),
  name: text('name').notNull(),
  ownerId: uuid('owner_id').references(() => users.id),
  plan: text('plan').notNull(),
  credits: integer('credits').default(0),
  createdAt: timestamp('created_at').defaultNow()
});

export const organizationMembers = pgTable('organization_members', {
  id: uuid('id').primaryKey().defaultRandom(),
  organizationId: uuid('organization_id').references(() => organizations.id),
  userId: uuid('user_id').references(() => users.id),
  role: text('role').notNull(), // 'owner' | 'admin' | 'member'
  createdAt: timestamp('created_at').defaultNow()
});

// æ›´æ–° assets è¡¨
export const assets = pgTable('assets', {
  // ...
  organizationId: uuid('organization_id').references(() => organizations.id),
  // ...
});
```

---

#### Week 11-12: æµ‹è¯•å’Œä¼˜åŒ–

**ç›®æ ‡**: å®Œæ•´å›å½’æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**:
- [ ] ç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [ ] å®‰å…¨å®¡è®¡
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] æ–‡æ¡£æ›´æ–°
- [ ] ä¸Šçº¿å‡†å¤‡

**æµ‹è¯•æ¸…å•**:
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•æµç¨‹
- [ ] å›¾åƒç”Ÿæˆå’Œé…é¢æ¶ˆè´¹
- [ ] ç§¯åˆ†è´­ä¹°å’Œè®¢é˜…
- [ ] æ•°æ®æŒä¹…åŒ–å’ŒåŒæ­¥
- [ ] é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
- [ ] æ€§èƒ½å’Œè´Ÿè½½æµ‹è¯•

---

### Phase 3 æˆåŠŸæ ‡å‡†

#### åŠŸèƒ½å®Œæ•´æ€§
- âœ… ç”¨æˆ·å¯ä»¥æ³¨å†Œå’Œç™»å½•
- âœ… æ‰€æœ‰æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“
- âœ… é…é¢ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
- âœ… æ”¯ä»˜æµç¨‹é¡ºç•…
- âœ… åŒ¿åç”¨æˆ·æ•°æ®æˆåŠŸè¿ç§»

#### æ€§èƒ½æŒ‡æ ‡
- âœ… é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’
- âœ… API å“åº”æ—¶é—´ < 500ms
- âœ… æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- âœ… å›¾åƒåŠ è½½ä¼˜åŒ–

#### å®‰å…¨æ€§
- âœ… API Key ä¸æš´éœ²
- âœ… ç”¨æˆ·æ•°æ®éš”ç¦»
- âœ… æ”¯ä»˜ä¿¡æ¯å®‰å…¨
- âœ… é€šè¿‡å®‰å…¨å®¡è®¡

#### ç”¨æˆ·ä½“éªŒ
- âœ… æµç•…çš„æ³¨å†Œæµç¨‹
- âœ… æ¸…æ™°çš„é…é¢æç¤º
- âœ… å‹å¥½çš„é”™è¯¯æç¤º
- âœ… å“åº”å¼è®¾è®¡

---

## æŠ•èµ„å›æŠ¥åˆ†æ

### Phase 1 é¢å¤–æŠ•å…¥è¯¦ç»†åˆ†æ

| æ¶æ„é¢„ç•™é¡¹ | æŠ•å…¥æ—¶é—´ | å…·ä½“å·¥ä½œ | éš¾åº¦ |
|-----------|---------|---------|------|
| æ•°æ®å±‚æŠ½è±¡ | 1å¤© | åˆ›å»ºæ¥å£ã€å®ç° LocalStorageAdapter | ğŸŸ¡ ä¸­ |
| ç”¨æˆ·ä¸Šä¸‹æ–‡é¢„ç•™ | 0.5å¤© | å®šä¹‰æ¥å£ã€å®ç° Provider | ğŸŸ¢ ä½ |
| API è°ƒç”¨å±‚æŠ½è±¡ | 1å¤© | ç»Ÿä¸€ API å‡½æ•°ã€é¢„ç•™é…é¢æ¥å£ | ğŸŸ¡ ä¸­ |
| æ•°æ®åº“è¡¨è®¾è®¡ | 2å¤© | è®¾è®¡ schemaã€åˆ›å»ºè¿ç§»ã€æ·»åŠ ç´¢å¼• | ğŸŸ¡ ä¸­ |
| ç¯å¢ƒå˜é‡æ ‡å‡†åŒ– | 0.25å¤© | åˆ›å»º .env.exampleã€Zod éªŒè¯ | ğŸŸ¢ ä½ |
| **æ€»è®¡** | **4.75å¤©** | **çº¦ 38 å°æ—¶** | - |

### Phase 3 èŠ‚çœæ—¶é—´è¯¦ç»†åˆ†æ

| é¿å…çš„é‡æ„å·¥ä½œ | èŠ‚çœæ—¶é—´ | åŸå›  |
|--------------|---------|------|
| æ•°æ®å±‚é‡æ„ | 2å‘¨ | é¿å…ä» localStorage åˆ°æ•°æ®åº“çš„å¤§è§„æ¨¡é‡æ„ |
| API å±‚é‡æ„ | 1-2å‘¨ | é¿å…é‡å†™æ‰€æœ‰ API è°ƒç”¨é€»è¾‘ |
| æ•°æ®åº“è¿ç§» | 1å‘¨ | é¿å…ä¿®æ”¹è¡¨ç»“æ„å’Œæ•°æ®è¿ç§» |
| ç»„ä»¶ä¿®æ”¹ | 2å‘¨ | é¿å…å¤§è§„æ¨¡ä¿®æ”¹ç»„ä»¶ä»¥é€‚é…æ–°æ¶æ„ |
| æµ‹è¯•å’Œè°ƒè¯• | 1å‘¨ | å‡å°‘å› æ¶æ„ä¸å…¼å®¹å¯¼è‡´çš„é—®é¢˜ |
| **æ€»è®¡** | **7-8å‘¨** | **çº¦ 280-320 å°æ—¶** |

### æŠ•èµ„å›æŠ¥ç‡è®¡ç®—

```
æŠ•å…¥: 4.75å¤© (38å°æ—¶)
æ”¶ç›Š: 7-8å‘¨ (280-320å°æ—¶)

ROI = (æ”¶ç›Š - æŠ•å…¥) / æŠ•å…¥ Ã— 100%
    = (280 - 38) / 38 Ã— 100%
    = 636%

æœ€ä½³æƒ…å†µ ROI = (320 - 38) / 38 Ã— 100%
             = 742%
```

**ç»“è®º**: æŠ•èµ„å›æŠ¥ç‡çº¦ **636-742%**

### é£é™©å¯¹æ¯”åˆ†æ

#### æ–¹æ¡ˆ A: ä¸åšæ¶æ„é¢„ç•™ï¼ˆPhase 1 + Phase 3 åŒæ—¶è¿›è¡Œï¼‰

**é£é™©ç­‰çº§**: ğŸ”´ğŸ”´ğŸ”´ æé«˜

| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | é£é™©å€¼ |
|--------|------|------|--------|
| æ¶æ„ä¸å…¼å®¹ | 80% | æé«˜ | ğŸ”´ æé«˜ |
| æ•°æ®è¿ç§»å¤±è´¥ | 60% | é«˜ | ğŸ”´ é«˜ |
| ç”¨æˆ·æ•°æ®ä¸¢å¤± | 40% | æé«˜ | ğŸ”´ é«˜ |
| é¡¹ç›®å»¶æœŸ | 90% | é«˜ | ğŸ”´ æé«˜ |
| æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯ | 70% | ä¸­ | ğŸŸ¡ ä¸­ |

**é¢„æœŸç»“æœ**:
- é¡¹ç›®å»¶æœŸ 4-6 å‘¨
- éœ€è¦å¤§è§„æ¨¡é‡æ„
- å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
- ç”¨æˆ·ä½“éªŒå—å½±å“

#### æ–¹æ¡ˆ B: åšæ¶æ„é¢„ç•™ï¼ˆæ¨èæ–¹æ¡ˆï¼‰

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­ç­‰

| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | é£é™©å€¼ |
|--------|------|------|--------|
| æ¶æ„ä¸å…¼å®¹ | 10% | ä½ | ğŸŸ¢ ä½ |
| æ•°æ®è¿ç§»å¤±è´¥ | 15% | ä¸­ | ğŸŸ¢ ä½ |
| ç”¨æˆ·æ•°æ®ä¸¢å¤± | 5% | ä½ | ğŸŸ¢ ä½ |
| é¡¹ç›®å»¶æœŸ | 20% | ä½ | ğŸŸ¢ ä½ |
| æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯ | 10% | ä½ | ğŸŸ¢ ä½ |

**é¢„æœŸç»“æœ**:
- æŒ‰æ—¶å®Œæˆ Phase 1
- Phase 3 å¹³æ»‘é›†æˆ
- æ•°æ®å®‰å…¨è¿ç§»
- ç”¨æˆ·ä½“éªŒæ— ç¼è¿‡æ¸¡

### æˆæœ¬æ•ˆç›Šåˆ†æ

#### çŸ­æœŸæˆæœ¬ï¼ˆPhase 1ï¼‰

| æˆæœ¬é¡¹ | é‡‘é¢ï¼ˆæŒ‰æ—¶è–ª $50 è®¡ç®—ï¼‰ |
|--------|----------------------|
| é¢å¤–å¼€å‘æ—¶é—´ | $1,900 (38å°æ—¶) |
| ä»£ç å®¡æŸ¥ | $200 (4å°æ—¶) |
| æ–‡æ¡£ç¼–å†™ | $150 (3å°æ—¶) |
| **æ€»è®¡** | **$2,250** |

#### é•¿æœŸæ”¶ç›Šï¼ˆPhase 3ï¼‰

| æ”¶ç›Šé¡¹ | é‡‘é¢ï¼ˆæŒ‰æ—¶è–ª $50 è®¡ç®—ï¼‰ |
|--------|----------------------|
| èŠ‚çœå¼€å‘æ—¶é—´ | $14,000-16,000 (280-320å°æ—¶) |
| é¿å…è¿”å·¥æˆæœ¬ | $3,000 (60å°æ—¶) |
| å‡å°‘æµ‹è¯•æ—¶é—´ | $2,000 (40å°æ—¶) |
| é™ä½é£é™©æˆæœ¬ | $5,000 (ä¼°ç®—) |
| **æ€»è®¡** | **$24,000-26,000** |

#### å‡€æ”¶ç›Š

```
å‡€æ”¶ç›Š = é•¿æœŸæ”¶ç›Š - çŸ­æœŸæˆæœ¬
       = $24,000 - $2,250
       = $21,750

ROI = $21,750 / $2,250 Ã— 100%
    = 967%
```

---

## æ€»ç»“ä¸å»ºè®®

### æ ¸å¿ƒå†³ç­–ç¡®è®¤

âœ… **é‡‡ç”¨åˆ†é˜¶æ®µé›†æˆç­–ç•¥**
- Phase 1: Next.js è¿ç§» + æ¶æ„é¢„ç•™ï¼ˆ7-8å‘¨ï¼‰
- Phase 2: Tailwind CSS è¿ç§»ï¼ˆ4-6å‘¨ï¼‰
- Phase 3: MKSAAS é›†æˆï¼ˆ8-12å‘¨ï¼‰

âœ… **Phase 1 å¿…é¡»åšçš„ 5 ä¸ªæ¶æ„é¢„ç•™**
1. æ•°æ®å±‚æŠ½è±¡ï¼ˆ1å¤©ï¼‰
2. ç”¨æˆ·ä¸Šä¸‹æ–‡é¢„ç•™ï¼ˆ0.5å¤©ï¼‰
3. API è°ƒç”¨å±‚æŠ½è±¡ï¼ˆ1å¤©ï¼‰
4. æ•°æ®åº“è¡¨è®¾è®¡é¢„ç•™ï¼ˆ2å¤©ï¼‰
5. ç¯å¢ƒå˜é‡æ ‡å‡†åŒ–ï¼ˆ0.25å¤©ï¼‰

### å…³é”®æˆåŠŸå› ç´ 

#### æŠ€æœ¯å±‚é¢
- âœ… æ¸…æ™°çš„æ¶æ„è®¾è®¡
- âœ… æ ‡å‡†åŒ–çš„æ¥å£
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å……åˆ†çš„æµ‹è¯•è¦†ç›–

#### ç®¡ç†å±‚é¢
- âœ… æ˜ç¡®çš„é˜¶æ®µç›®æ ‡
- âœ… å¯è¡¡é‡çš„æˆåŠŸæ ‡å‡†
- âœ… å®šæœŸçš„è¿›åº¦æ£€æŸ¥
- âœ… çµæ´»çš„è°ƒæ•´æœºåˆ¶

#### å›¢é˜Ÿå±‚é¢
- âœ… å……åˆ†çš„æŠ€æœ¯åŸ¹è®­
- âœ… æ¸…æ™°çš„æ–‡æ¡£
- âœ… æœ‰æ•ˆçš„æ²Ÿé€š
- âœ… åˆç†çš„æ—¶é—´å®‰æ’

### é£é™©ç¼“è§£æªæ–½

#### æŠ€æœ¯é£é™©
- ğŸ›¡ï¸ å……åˆ†çš„ä»£ç å®¡æŸ¥
- ğŸ›¡ï¸ å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- ğŸ›¡ï¸ æ¸è¿›å¼è¿ç§»
- ğŸ›¡ï¸ ä¿ç•™å›æ»šæœºåˆ¶

#### ä¸šåŠ¡é£é™©
- ğŸ›¡ï¸ ä¿æŒç”¨æˆ·ä½“éªŒè¿ç»­æ€§
- ğŸ›¡ï¸ æä¾›æ•°æ®è¿ç§»å·¥å…·
- ğŸ›¡ï¸ å……åˆ†çš„ç”¨æˆ·æ²Ÿé€š
- ğŸ›¡ï¸ çµæ´»çš„å®šä»·ç­–ç•¥

#### æ—¶é—´é£é™©
- ğŸ›¡ï¸ é¢„ç•™ç¼“å†²æ—¶é—´
- ğŸ›¡ï¸ ä¼˜å…ˆçº§ç®¡ç†
- ğŸ›¡ï¸ å¹¶è¡Œä»»åŠ¡è§„åˆ’
- ğŸ›¡ï¸ å®šæœŸè¿›åº¦è¯„ä¼°

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

#### ç«‹å³è¡ŒåŠ¨ï¼ˆæœ¬å‘¨ï¼‰
1. âœ… ç¡®è®¤æ¶æ„é¢„ç•™æ–¹æ¡ˆ
2. âœ… åˆ›å»ºæŠ€æœ¯æ–‡æ¡£
3. âœ… è®¾ç½®å¼€å‘ç¯å¢ƒ
4. âœ… å¼€å§‹ Phase 1 å®æ–½

#### çŸ­æœŸè¡ŒåŠ¨ï¼ˆ1-2å‘¨ï¼‰
1. å®ç°æ•°æ®å±‚æŠ½è±¡
2. å®ç°ç”¨æˆ·ä¸Šä¸‹æ–‡
3. å®ç° API è°ƒç”¨å±‚
4. è®¾è®¡æ•°æ®åº“è¡¨

#### ä¸­æœŸè¡ŒåŠ¨ï¼ˆPhase 1 å®Œæˆåï¼‰
1. è¯„ä¼° Phase 1 æˆæœ
2. è§„åˆ’ Phase 2 ç»†èŠ‚
3. å‡†å¤‡ Phase 3 èµ„æº
4. æ›´æ–°é¡¹ç›®æ–‡æ¡£

### æœ€ç»ˆå»ºè®®

åŸºäºè¯¦ç»†çš„åˆ†æå’ŒæŠ•èµ„å›æŠ¥ç‡è®¡ç®—ï¼Œæˆ‘ä»¬**å¼ºçƒˆæ¨è**é‡‡ç”¨åˆ†é˜¶æ®µé›†æˆç­–ç•¥ï¼Œå¹¶åœ¨ Phase 1 ä¸­åšå¥½ 5 ä¸ªå…³é”®çš„æ¶æ„é¢„ç•™ã€‚

**ç†ç”±**:
1. **é£é™©å¯æ§**: æ¯ä¸ªé˜¶æ®µç‹¬ç«‹ï¼Œé—®é¢˜å®¹æ˜“å®šä½å’Œè§£å†³
2. **æŠ•èµ„å›æŠ¥é«˜**: 4.75å¤©çš„æŠ•å…¥å¯èŠ‚çœ 7-8å‘¨çš„é‡æ„æ—¶é—´ï¼ˆROI 636-742%ï¼‰
3. **ä¸šåŠ¡è¿ç»­æ€§**: ä¸å½±å“ç°æœ‰ç”¨æˆ·ä½¿ç”¨ï¼Œå¹³æ»‘è¿‡æ¸¡
4. **æŠ€æœ¯å€ºåŠ¡æœ€å°**: é¿å…æœªæ¥å¤§è§„æ¨¡é‡æ„
5. **å›¢é˜Ÿå­¦ä¹ æ›²çº¿**: é€æ­¥å­¦ä¹ æ–°æŠ€æœ¯ï¼Œé¿å…åŒæ—¶å­¦ä¹ è¿‡å¤š

**å…³é”®æé†’**:
- âš ï¸ Phase 1 çš„æ¶æ„é¢„ç•™æ˜¯æˆåŠŸçš„å…³é”®ï¼Œä¸å¯çœç•¥
- âš ï¸ å¿…é¡»ä¸¥æ ¼éµå¾ª MKSAAS çš„å‘½åå’Œç»“æ„è§„èŒƒ
- âš ï¸ å®šæœŸè¯„ä¼°è¿›åº¦ï¼ŒåŠæ—¶è°ƒæ•´è®¡åˆ’
- âš ï¸ ä¿æŒä¸ MKSAAS æ¡†æ¶çš„åŒæ­¥æ›´æ–°

---

## é™„å½•

### å‚è€ƒæ–‡æ¡£

1. **MKSAAS å®˜æ–¹æ–‡æ¡£**
   - ä»‹ç»: `docs/integration/mksaas/ä»‹ç».md`
   - é¡¹ç›®ç»“æ„: `docs/integration/mksaas/é¡¹ç›®ç»“æ„ç›®å½•.md`
   - é›†æˆæŒ‡å—: `docs/integration/mksaas/bananaryåº”ç”¨é›†æˆMkSaaSè®¾è®¡æŒ‡å—åˆç‰ˆ.md`
   - 13è¦ç´ åˆ†æ: `docs/integration/mksaas/ç‹¬ç«‹åº”ç”¨MkSaaSé›†æˆé¢„å¤‡è®¾è®¡-13è¦ç´ åˆ†æ.md`

2. **Next.js è¿ç§»æ–‡æ¡£**
   - éœ€æ±‚æ–‡æ¡£: `.kiro/specs/nextjs-migration/requirements.md`
   - é£é™©è¯„ä¼°: `.kiro/specs/nextjs-migration/risk-assessment.md`

3. **æŠ€æœ¯æ ˆæ–‡æ¡£**
   - Next.js: https://nextjs.org/docs
   - Drizzle ORM: https://orm.drizzle.team/docs
   - Better Auth: https://better-auth.dev/docs
   - Stripe: https://stripe.com/docs

### æœ¯è¯­è¡¨

- **MKSAAS**: ä¼ä¸šçº§ SaaS å¿«é€Ÿå¼€å‘æ¡†æ¶
- **Better Auth**: ç°ä»£åŒ–çš„è®¤è¯è§£å†³æ–¹æ¡ˆ
- **Drizzle ORM**: TypeScript ORM å·¥å…·
- **Phase 1/2/3**: è¿ç§»çš„ä¸‰ä¸ªé˜¶æ®µ
- **æ¶æ„é¢„ç•™**: åœ¨å½“å‰é˜¶æ®µä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™æ¥å£
- **StorageAdapter**: å­˜å‚¨é€‚é…å™¨æ¥å£
- **UserContext**: ç”¨æˆ·ä¸Šä¸‹æ–‡æ¥å£

### è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥è®¨è®ºï¼Œè¯·è”ç³»ï¼š
- é¡¹ç›®è´Ÿè´£äºº: [å¾…å¡«å†™]
- æŠ€æœ¯é¡¾é—®: Kiro AI Assistant
- æ–‡æ¡£ç»´æŠ¤: [å¾…å¡«å†™]

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-27  
**æœ€åæ›´æ–°**: 2025-10-27  
**çŠ¶æ€**: âœ… å·²ç¡®è®¤  
**ä½œè€…**: Kiro AI Assistant

