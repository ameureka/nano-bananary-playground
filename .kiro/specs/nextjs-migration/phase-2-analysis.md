# Phase 2: æœåŠ¡ç«¯å¢å¼º - æ·±åº¦åˆ†æä¸å¯è¡Œæ€§è¯„ä¼°

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-29  
**åˆ†æèŒƒå›´**: Phase 2 ä»»åŠ¡çš„åˆç†æ€§ã€éš¾ç‚¹å’Œé£é™©è¯„ä¼°

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

åŸºäºå¯¹å½“å‰ä»£ç æ¶æ„çš„æ·±å…¥åˆ†æï¼ŒPhase 2 çš„ä»»åŠ¡è®¾è®¡**æ€»ä½“åˆç†**ï¼Œä½†å­˜åœ¨ä»¥ä¸‹å…³é”®å‘ç°ï¼š

### âœ… ä¼˜åŠ¿
1. **æ¶æ„é¢„ç•™å®Œå–„**: `lib/actions.ts` å·²ç»ä½œä¸ºæŠ½è±¡å±‚å­˜åœ¨ï¼Œè¿ç§»è·¯å¾„æ¸…æ™°
2. **API è°ƒç”¨é›†ä¸­**: æ‰€æœ‰ Gemini API è°ƒç”¨éƒ½åœ¨ `geminiService.ts` ä¸­ï¼Œæ˜“äºè¿ç§»
3. **çŠ¶æ€ç®¡ç†è§£è€¦**: Zustand stores ä¸ API å±‚åˆ†ç¦»è‰¯å¥½

### âš ï¸ æŒ‘æˆ˜
1. **API å¯†é’¥æš´éœ²é£é™©**: å½“å‰ä½¿ç”¨ `NEXT_PUBLIC_GEMINI_API_KEY`ï¼Œå®Œå…¨æš´éœ²åœ¨å®¢æˆ·ç«¯
2. **Base64 æ•°æ®ä¼ è¾“**: å›¾ç‰‡ä»¥ base64 ä¼ è¾“ï¼ŒServer Actions æœ‰ 1MB é™åˆ¶
3. **å®æ—¶è¿›åº¦åé¦ˆ**: è§†é¢‘ç”Ÿæˆçš„è½®è¯¢æœºåˆ¶éœ€è¦é‡æ–°è®¾è®¡
4. **é”™è¯¯å¤„ç†å¤æ‚**: éœ€è¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤å±‚å¤„ç†é”™è¯¯

### ğŸ¯ å»ºè®®è°ƒæ•´
1. ä¼˜å…ˆçº§è°ƒæ•´ï¼šå…ˆåš API å®‰å…¨ï¼ˆ2.1-2.2ï¼‰ï¼Œå†åšæ€§èƒ½ä¼˜åŒ–ï¼ˆ2.4-2.10ï¼‰
2. åˆ†é˜¶æ®µéªŒè¯ï¼šæ¯å®Œæˆä¸€ä¸ª API è¿ç§»å°±æµ‹è¯•ï¼Œä¸è¦ç­‰å…¨éƒ¨å®Œæˆ
3. ä¿ç•™å›é€€æœºåˆ¶ï¼šPhase 1 çš„å®¢æˆ·ç«¯è°ƒç”¨ä¿ç•™ä¸€æ®µæ—¶é—´

---

## ğŸ—ï¸ å½“å‰æ¶æ„åˆ†æ

### 1. API è°ƒç”¨é“¾è·¯


```
ç»„ä»¶/Store â†’ lib/actions.ts â†’ services/geminiService.ts â†’ @google/genai SDK
```

**å½“å‰å®ç°**:
- `lib/actions.ts`: 8ä¸ªå‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ `geminiService`
- `geminiService.ts`: 9ä¸ªæ ¸å¿ƒå‡½æ•°ï¼Œç›´æ¥ä½¿ç”¨ `@google/genai` SDK
- API å¯†é’¥: é€šè¿‡ `utils/env.ts` è·å– `NEXT_PUBLIC_GEMINI_API_KEY`

**ä¼˜ç‚¹**:
- âœ… æŠ½è±¡å±‚å·²å­˜åœ¨ï¼Œè¿ç§»æ—¶åªéœ€ä¿®æ”¹ `lib/actions.ts`
- âœ… æ‰€æœ‰ API è°ƒç”¨é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶
- âœ… é”™è¯¯å¤„ç†ç»Ÿä¸€ï¼ˆ`handleApiError`, `handleApiRequest`ï¼‰

**ç¼ºç‚¹**:
- âŒ API å¯†é’¥å®Œå…¨æš´éœ²åœ¨å®¢æˆ·ç«¯ä»£ç å’Œç½‘ç»œè¯·æ±‚ä¸­
- âŒ æ— é€Ÿç‡é™åˆ¶ï¼Œå®¹æ˜“è¢«æ»¥ç”¨
- âŒ å›¾ç‰‡ base64 æ•°æ®åœ¨å®¢æˆ·ç«¯å’Œ API ä¹‹é—´ä¼ è¾“ï¼Œæ•ˆç‡ä½

### 2. æ•°æ®æµåˆ†æ

#### å›¾åƒç¼–è¾‘æµç¨‹
```
ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ â†’ è½¬ base64 â†’ Store â†’ Action â†’ Service â†’ Gemini API
                                                              â†“
ç”¨æˆ·ä¸‹è½½ â† UI æ˜¾ç¤º â† Store æ›´æ–° â† Action è¿”å› â† base64 å“åº”
```

**æ•°æ®é‡åˆ†æ**:
- å•å¼  1MB å›¾ç‰‡ â†’ base64 çº¦ 1.37MB
- 4å¼ å›¾ç‰‡é€‰é¡¹ â†’ çº¦ 5.5MB æ•°æ®
- Server Actions é™åˆ¶: 1MB per request

**é—®é¢˜**: å½“å‰æ¶æ„ä¸‹ï¼Œå¤šå›¾ç”Ÿæˆä¼šè¶…è¿‡ Server Actions çš„å¤§å°é™åˆ¶ï¼



#### è§†é¢‘ç”Ÿæˆæµç¨‹
```
ç”¨æˆ·è¾“å…¥ â†’ Store â†’ Action â†’ Service â†’ Gemini API (å¯åŠ¨æ“ä½œ)
                                              â†“
                                         è½®è¯¢çŠ¶æ€ (æ¯10ç§’)
                                              â†“
                                         è·å–ä¸‹è½½é“¾æ¥
                                              â†“
Store æ›´æ–° â† Action è¿”å› â† Service â† fetch è§†é¢‘æ–‡ä»¶
```

**é—®é¢˜**: 
- è½®è¯¢åœ¨å®¢æˆ·ç«¯è¿›è¡Œï¼ŒServer Actions ä¸é€‚åˆé•¿æ—¶é—´è¿è¡Œ
- è§†é¢‘æ–‡ä»¶é€šè¿‡å®¢æˆ·ç«¯ fetchï¼ŒAPI å¯†é’¥æš´éœ²

### 3. Store ä¾èµ–åˆ†æ

#### enhancerStore.ts
- **API è°ƒç”¨**: 4ä¸ª
  - `editImageAction`
  - `generateVideoAction`
  - `generateImageFromTextAction`
  - `generateStyleMimicImageAction`
- **å¤æ‚åº¦**: é«˜ï¼ˆå¤šåˆ†æ”¯é€»è¾‘ã€é‡è¯•æœºåˆ¶ã€æ°´å°å¤„ç†ï¼‰
- **è¿ç§»éš¾åº¦**: â­â­â­â­ (4/5)

#### chatStore.ts
- **API è°ƒç”¨**: 2ä¸ª
  - `generateImageInChatAction`
  - `preprocessPromptAction`
- **å¤æ‚åº¦**: ä¸­ï¼ˆå†å²è®°å½•ç®¡ç†ã€é¢„å¤„ç†é€»è¾‘ï¼‰
- **è¿ç§»éš¾åº¦**: â­â­â­ (3/5)

---

## ğŸ“Š Phase 2 ä»»åŠ¡è¯¦ç»†åˆ†æ

### 2.1 åˆ›å»º Server Actionsï¼ˆDay 21-23ï¼Œ3å¤©ï¼‰

#### ä»»åŠ¡åˆç†æ€§: âœ… åˆç†

**éœ€è¦åˆ›å»ºçš„ Server Actions**:
1. `editImageAction` - å›¾åƒç¼–è¾‘
2. `preprocessPromptAction` - æç¤ºè¯é¢„å¤„ç†
3. `getTransformationSuggestionsAction` - æ•ˆæœå»ºè®®
4. `generateImageFromTextAction` - æ–‡æœ¬ç”Ÿæˆå›¾åƒ
5. `generateStyleMimicImageAction` - é£æ ¼æ¨¡ä»¿
6. `generateVideoAction` - è§†é¢‘ç”Ÿæˆ
7. `generateImageInChatAction` - èŠå¤©ä¸­ç”Ÿæˆå›¾åƒ
8. `generateImageEditsBatchAction` - æ‰¹é‡ç¼–è¾‘



#### å…³é”®éš¾ç‚¹

**éš¾ç‚¹ 1: Base64 æ•°æ®å¤§å°é™åˆ¶** â­â­â­â­â­
- **é—®é¢˜**: Server Actions æœ‰ 1MB è¯·æ±‚å¤§å°é™åˆ¶
- **å½±å“**: æ— æ³•ç›´æ¥ä¼ è¾“é«˜åˆ†è¾¨ç‡å›¾ç‰‡
- **è§£å†³æ–¹æ¡ˆ**:
  ```typescript
  // æ–¹æ¡ˆA: ä½¿ç”¨ FormData ä¸Šä¼ åˆ°ä¸´æ—¶å­˜å‚¨
  'use server'
  export async function uploadImageAction(formData: FormData) {
    const file = formData.get('image') as File;
    // ä¸Šä¼ åˆ° Vercel Blob æˆ– S3
    const url = await uploadToStorage(file);
    return url;
  }
  
  // æ–¹æ¡ˆB: åˆ†å—ä¼ è¾“
  export async function editImageAction(imageUrl: string, prompt: string) {
    // æœåŠ¡ç«¯ä» URL è¯»å–å›¾ç‰‡
    const imageBuffer = await fetch(imageUrl).then(r => r.arrayBuffer());
    // è°ƒç”¨ Gemini API
  }
  ```
- **æ¨è**: æ–¹æ¡ˆBï¼Œä½¿ç”¨ä¸´æ—¶ URL è€Œé base64

**éš¾ç‚¹ 2: è§†é¢‘ç”Ÿæˆçš„é•¿æ—¶é—´è¿è¡Œ** â­â­â­â­â­
- **é—®é¢˜**: Server Actions æœ‰ 60 ç§’è¶…æ—¶é™åˆ¶ï¼ˆVercel Hobbyï¼‰
- **å½±å“**: è§†é¢‘ç”Ÿæˆéœ€è¦ 2-5 åˆ†é’Ÿï¼Œä¼šè¶…æ—¶
- **è§£å†³æ–¹æ¡ˆ**:
  ```typescript
  // æ–¹æ¡ˆA: ä½¿ç”¨ API Routes + è½®è¯¢
  // app/api/video/generate/route.ts
  export async function POST(req: Request) {
    const { prompt, imageUrl } = await req.json();
    const operation = await startVideoGeneration(prompt, imageUrl);
    return Response.json({ operationId: operation.name });
  }
  
  // app/api/video/status/[id]/route.ts
  export async function GET(req: Request, { params }: { params: { id: string } }) {
    const operation = await checkVideoStatus(params.id);
    return Response.json(operation);
  }
  
  // æ–¹æ¡ˆB: ä½¿ç”¨ Vercel Cron + æ•°æ®åº“
  // å°†ä»»åŠ¡å­˜å…¥æ•°æ®åº“ï¼Œå®šæ—¶ä»»åŠ¡å¤„ç†
  ```
- **æ¨è**: æ–¹æ¡ˆAï¼Œä½¿ç”¨ API Routes



**éš¾ç‚¹ 3: è¿›åº¦åé¦ˆæœºåˆ¶** â­â­â­â­
- **é—®é¢˜**: Server Actions æ— æ³•å®æ—¶æ¨é€è¿›åº¦
- **å½±å“**: ç”¨æˆ·ä½“éªŒä¸‹é™ï¼Œæ— æ³•çœ‹åˆ°"æ­£åœ¨ç”Ÿæˆ..."
- **è§£å†³æ–¹æ¡ˆ**:
  ```typescript
  // æ–¹æ¡ˆA: ä½¿ç”¨ Server-Sent Events (SSE)
  // app/api/generate/stream/route.ts
  export async function POST(req: Request) {
    const encoder = new TextEncoder();
    const stream = new ReadableStream({
      async start(controller) {
        controller.enqueue(encoder.encode('data: {"progress": 10}\n\n'));
        // è°ƒç”¨ API
        controller.enqueue(encoder.encode('data: {"progress": 50}\n\n'));
        // å®Œæˆ
        controller.enqueue(encoder.encode('data: {"progress": 100, "result": "..."}\n\n'));
        controller.close();
      }
    });
    return new Response(stream, {
      headers: { 'Content-Type': 'text/event-stream' }
    });
  }
  
  // æ–¹æ¡ˆB: å®¢æˆ·ç«¯è½®è¯¢ + æ•°æ®åº“çŠ¶æ€
  // ç®€å•ä½†ä¸å¤Ÿå®æ—¶
  ```
- **æ¨è**: æ–¹æ¡ˆAï¼ˆSSEï¼‰ç”¨äºé•¿ä»»åŠ¡ï¼Œæ–¹æ¡ˆBç”¨äºçŸ­ä»»åŠ¡

**éš¾ç‚¹ 4: é”™è¯¯å¤„ç†çš„åŒå±‚ç»“æ„** â­â­â­
- **é—®é¢˜**: éœ€è¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¤„ç†é”™è¯¯
- **å½±å“**: ä»£ç å¤æ‚åº¦å¢åŠ 
- **è§£å†³æ–¹æ¡ˆ**:
  ```typescript
  // æœåŠ¡ç«¯ç»Ÿä¸€é”™è¯¯æ ¼å¼
  'use server'
  export async function editImageAction(prompt: string, imageUrl: string) {
    try {
      const result = await geminiService.editImage(...);
      return { success: true, data: result };
    } catch (error) {
      return { 
        success: false, 
        error: {
          code: 'GENERATION_FAILED',
          message: error.message,
          userMessage: 'å›¾åƒç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•'
        }
      };
    }
  }
  
  // å®¢æˆ·ç«¯ç»Ÿä¸€å¤„ç†
  const result = await editImageAction(prompt, imageUrl);
  if (!result.success) {
    set({ error: result.error.userMessage });
    return;
  }
  ```
- **æ¨è**: ä½¿ç”¨ç»Ÿä¸€çš„ Result ç±»å‹



#### æ—¶é—´è¯„ä¼°

| å­ä»»åŠ¡ | åŸè®¡åˆ’ | è°ƒæ•´å | è¯´æ˜ |
|--------|--------|--------|------|
| 2.1.1 åˆ›å»ºæ–‡ä»¶ç»“æ„ | 0.5å¤© | 0.5å¤© | åˆç† |
| 2.1.2-2.1.9 å®ç°8ä¸ªå‡½æ•° | 2.5å¤© | 4å¤© | éœ€è¦å¤„ç† base64 é™åˆ¶å’Œé”™è¯¯å¤„ç† |
| **æ€»è®¡** | **3å¤©** | **4.5å¤©** | **å»ºè®®å¢åŠ 1.5å¤©** |

---

### 2.2 æ›´æ–° Store è°ƒç”¨ï¼ˆDay 23-26ï¼Œ3å¤©ï¼‰

#### ä»»åŠ¡åˆç†æ€§: âœ… åˆç†

**éœ€è¦ä¿®æ”¹çš„ Stores**:
1. `enhancerStore.ts` - 4ä¸ª API è°ƒç”¨
2. `chatStore.ts` - 2ä¸ª API è°ƒç”¨
3. `assetLibraryStore.ts` - å¯èƒ½éœ€è¦ä¿®æ”¹ï¼ˆå¦‚æœæ¶‰åŠä¸Šä¼ ï¼‰

#### å…³é”®éš¾ç‚¹

**éš¾ç‚¹ 1: é‡è¯•é€»è¾‘çš„è¿ç§»** â­â­â­
- **é—®é¢˜**: å½“å‰é‡è¯•åœ¨å®¢æˆ·ç«¯ï¼Œè¿ç§»ååº”è¯¥åœ¨æœåŠ¡ç«¯
- **å½±å“**: éœ€è¦é‡æ–°è®¾è®¡é‡è¯•æœºåˆ¶
- **è§£å†³æ–¹æ¡ˆ**:
  ```typescript
  // æœåŠ¡ç«¯å®ç°é‡è¯•
  'use server'
  async function retryWithBackoff<T>(
    fn: () => Promise<T>,
    maxRetries: number = 3
  ): Promise<T> {
    for (let i = 0; i < maxRetries; i++) {
      try {
        return await fn();
      } catch (error) {
        if (i === maxRetries - 1) throw error;
        await new Promise(r => setTimeout(r, 1000 * (i + 1)));
      }
    }
    throw new Error('Max retries exceeded');
  }
  ```

**éš¾ç‚¹ 2: è¿›åº¦æ¨¡æ‹Ÿçš„ä¿ç•™** â­â­
- **é—®é¢˜**: å½“å‰å®¢æˆ·ç«¯æœ‰è¿›åº¦æ¡æ¨¡æ‹Ÿï¼Œè¿ç§»åå¦‚ä½•ä¿æŒ
- **è§£å†³æ–¹æ¡ˆ**: ä¿ç•™å®¢æˆ·ç«¯çš„è¿›åº¦æ¨¡æ‹Ÿï¼ŒæœåŠ¡ç«¯åªè¿”å›æœ€ç»ˆç»“æœ



**éš¾ç‚¹ 3: æ°´å°å¤„ç†çš„ä½ç½®** â­â­â­
- **é—®é¢˜**: å½“å‰æ°´å°åœ¨å®¢æˆ·ç«¯æ·»åŠ ï¼Œè¿ç§»ååº”è¯¥åœ¨å“ªé‡Œ
- **é€‰é¡¹**:
  - A. æœåŠ¡ç«¯æ·»åŠ ï¼šæ›´å®‰å…¨ï¼Œä½†å¢åŠ æœåŠ¡ç«¯è´Ÿè½½
  - B. å®¢æˆ·ç«¯æ·»åŠ ï¼šä¿æŒç°çŠ¶ï¼Œä½†å¯ä»¥è¢«ç»•è¿‡
- **æ¨è**: ä¿æŒå®¢æˆ·ç«¯æ·»åŠ ï¼ˆéæ ¸å¿ƒå®‰å…¨éœ€æ±‚ï¼‰

#### æ—¶é—´è¯„ä¼°

| å­ä»»åŠ¡ | åŸè®¡åˆ’ | è°ƒæ•´å | è¯´æ˜ |
|--------|--------|--------|------|
| 2.2.1-2.2.3 æ›´æ–°3ä¸ªStore | 2å¤© | 2å¤© | åˆç† |
| 2.2.4 éªŒè¯ API å®‰å…¨ | 1å¤© | 1å¤© | åˆç† |
| **æ€»è®¡** | **3å¤©** | **3å¤©** | **æ— éœ€è°ƒæ•´** |

---

### 2.3 å®ç°è¯·æ±‚é€Ÿç‡é™åˆ¶ï¼ˆDay 26-28ï¼Œ2å¤©ï¼‰

#### ä»»åŠ¡åˆç†æ€§: âš ï¸ éœ€è¦è°ƒæ•´

**åŸè®¡åˆ’**: ä½¿ç”¨ Upstash Redis å®ç°é€Ÿç‡é™åˆ¶

#### å…³é”®é—®é¢˜

**é—®é¢˜ 1: ç”¨æˆ·è¯†åˆ«** â­â­â­â­
- **æŒ‘æˆ˜**: å½“å‰åº”ç”¨æ— ç”¨æˆ·ç³»ç»Ÿï¼Œå¦‚ä½•è¯†åˆ«ç”¨æˆ·ï¼Ÿ
- **é€‰é¡¹**:
  - A. IP åœ°å€ï¼šå¯ä»¥è¢«ä»£ç†ç»•è¿‡
  - B. æµè§ˆå™¨æŒ‡çº¹ï¼šå¤æ‚ä¸”ä¸å¯é 
  - C. æš‚ä¸å®ç°ï¼šç­‰ Phase 3 æœ‰ç”¨æˆ·ç³»ç»Ÿåå†åš
- **æ¨è**: é€‰é¡¹Cï¼ŒPhase 2 å…ˆä¸åšé€Ÿç‡é™åˆ¶

**é—®é¢˜ 2: æˆæœ¬è€ƒè™‘** â­â­â­
- **Upstash Redis å®šä»·**:
  - å…è´¹å±‚: 10,000 requests/day
  - ä»˜è´¹: $0.2 per 100K requests
- **è¯„ä¼°**: å¯¹äºä¸ªäººé¡¹ç›®ï¼Œå…è´¹å±‚è¶³å¤Ÿ



#### å»ºè®®è°ƒæ•´

**è°ƒæ•´æ–¹æ¡ˆ**: 
1. **Phase 2**: å®ç°ç®€å•çš„ IP é™æµï¼ˆæ¯åˆ†é’Ÿ 20 æ¬¡ï¼‰
2. **Phase 3**: ç»“åˆç”¨æˆ·ç³»ç»Ÿå®ç°å®Œæ•´çš„é…é¢ç®¡ç†

```typescript
// ç®€åŒ–ç‰ˆå®ç°ï¼ˆæ— éœ€ Redisï¼‰
'use server'
import { headers } from 'next/headers';

const requestCounts = new Map<string, { count: number; resetAt: number }>();

export async function checkRateLimit() {
  const headersList = headers();
  const ip = headersList.get('x-forwarded-for') || 'unknown';
  
  const now = Date.now();
  const record = requestCounts.get(ip);
  
  if (!record || now > record.resetAt) {
    requestCounts.set(ip, { count: 1, resetAt: now + 60000 });
    return { allowed: true };
  }
  
  if (record.count >= 20) {
    return { allowed: false, retryAfter: record.resetAt - now };
  }
  
  record.count++;
  return { allowed: true };
}
```

#### æ—¶é—´è¯„ä¼°

| å­ä»»åŠ¡ | åŸè®¡åˆ’ | è°ƒæ•´å | è¯´æ˜ |
|--------|--------|--------|------|
| 2.3.1 é…ç½® Upstash | 0.5å¤© | 0å¤© | æš‚ä¸ä½¿ç”¨ |
| 2.3.2 å®ç°é™æµå™¨ | 1å¤© | 0.5å¤© | ç®€åŒ–å®ç° |
| 2.3.3 é›†æˆåˆ° Actions | 0.5å¤© | 0.5å¤© | åˆç† |
| **æ€»è®¡** | **2å¤©** | **1å¤©** | **å‡å°‘1å¤©** |

---

### 2.4-2.6 æ€§èƒ½ä¼˜åŒ–ï¼ˆå›¾ç‰‡ã€å­—ä½“ã€ä»£ç åˆ†å‰²ï¼‰

#### ä»»åŠ¡åˆç†æ€§: âœ… åˆç†

è¿™äº›ä»»åŠ¡éƒ½æ˜¯æ ‡å‡†çš„ Next.js ä¼˜åŒ–ï¼Œæ²¡æœ‰ç‰¹æ®Šéš¾ç‚¹ã€‚

#### å…³é”®æ³¨æ„äº‹é¡¹

**2.4 å›¾ç‰‡ä¼˜åŒ–**:
- âš ï¸ ç”¨æˆ·ç”Ÿæˆçš„å›¾ç‰‡ï¼ˆbase64ï¼‰æ— æ³•ä½¿ç”¨ `next/image` ä¼˜åŒ–
- âœ… é™æ€èµ„æºå›¾ç‰‡å¯ä»¥ä¼˜åŒ–

**2.5 å­—ä½“ä¼˜åŒ–**:
- âœ… å·²åœ¨ Phase 1 å®Œæˆï¼ˆä½¿ç”¨ `next/font`ï¼‰
- å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ– Material Symbols çš„åŠ è½½

**2.6 ä»£ç åˆ†å‰²**:
- âœ… ä½¿ç”¨ `dynamic()` å¯¼å…¥å¤§ç»„ä»¶
- é‡ç‚¹: Canvas ç¼–è¾‘å™¨ã€è§†é¢‘æ’­æ”¾å™¨



---

### 2.7-2.10 SEO å’Œæ€§èƒ½æµ‹è¯•

#### ä»»åŠ¡åˆç†æ€§: âœ… åˆç†

è¿™äº›éƒ½æ˜¯æ ‡å‡†ä»»åŠ¡ï¼Œä½†éœ€è¦æ³¨æ„ï¼š

**2.9 SSR/SSG ä¼˜åŒ–çš„é™åˆ¶**:
- âš ï¸ å½“å‰åº”ç”¨é«˜åº¦ä¾èµ–å®¢æˆ·ç«¯çŠ¶æ€ï¼ˆZustand + localStorageï¼‰
- âš ï¸ å¤§éƒ¨åˆ†é¡µé¢å¿…é¡»ä¿æŒ CSR æ¨¡å¼
- âœ… å¯ä»¥ä¼˜åŒ–çš„éƒ¨åˆ†ï¼š
  - æ•ˆæœåˆ—è¡¨ï¼ˆTransformationSelectorï¼‰å¯ä»¥ SSG
  - é¡µé¢æ¡†æ¶å¯ä»¥ SSR
  - é™æ€å†…å®¹å¯ä»¥é¢„æ¸²æŸ“

**å»ºè®®**: ä¸è¦è¿‡åº¦è¿½æ±‚ SSR/SSGï¼Œä¿æŒ CSR ä¸ºä¸»

---

## ğŸ¯ Phase 2 ä¼˜åŒ–å»ºè®®

### 1. ä»»åŠ¡ä¼˜å…ˆçº§è°ƒæ•´

**åŸè®¡åˆ’é¡ºåº**:
```
2.1 Server Actions â†’ 2.2 æ›´æ–° Store â†’ 2.3 é€Ÿç‡é™åˆ¶ â†’ 2.4-2.10 æ€§èƒ½ä¼˜åŒ–
```

**å»ºè®®é¡ºåº**:
```
2.1 Server Actions (æ ¸å¿ƒ) â†’ 2.2 æ›´æ–° Store (æ ¸å¿ƒ) â†’ 
2.4-2.6 æ€§èƒ½ä¼˜åŒ– (ç”¨æˆ·ä½“éªŒ) â†’ 2.7-2.8 SEO (å¯è§æ€§) â†’ 
2.3 é€Ÿç‡é™åˆ¶ (å®‰å…¨) â†’ 2.9-2.10 é«˜çº§ä¼˜åŒ– (é”¦ä¸Šæ·»èŠ±)
```

**ç†ç”±**:
1. å…ˆä¿è¯åŠŸèƒ½æ­£å¸¸ï¼ˆ2.1-2.2ï¼‰
2. å†æå‡ç”¨æˆ·ä½“éªŒï¼ˆ2.4-2.6ï¼‰
3. æœ€ååšå®‰å…¨å’Œé«˜çº§ä¼˜åŒ–ï¼ˆ2.3, 2.9-2.10ï¼‰

### 2. åˆ†é˜¶æ®µéªŒè¯ç­–ç•¥

**ä¸è¦ç­‰æ‰€æœ‰ä»»åŠ¡å®Œæˆå†æµ‹è¯•ï¼**

å»ºè®®çš„éªŒè¯ç‚¹ï¼š
- âœ… å®Œæˆ 2.1.2ï¼ˆeditImageActionï¼‰â†’ ç«‹å³æµ‹è¯•å›¾åƒç¼–è¾‘
- âœ… å®Œæˆ 2.1.8ï¼ˆgenerateImageInChatActionï¼‰â†’ ç«‹å³æµ‹è¯•èŠå¤©
- âœ… å®Œæˆ 2.2 â†’ å®Œæ•´å›å½’æµ‹è¯•
- âœ… å®Œæˆ 2.4-2.6 â†’ Lighthouse æµ‹è¯•



### 3. æ¶æ„å†³ç­–å»ºè®®

#### å†³ç­– 1: å›¾ç‰‡ä¼ è¾“æ–¹å¼

**é€‰é¡¹å¯¹æ¯”**:

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| A. ç»§ç»­ä½¿ç”¨ base64 | ç®€å•ï¼Œæ— éœ€æ”¹åŠ¨ | è¶…è¿‡ 1MB é™åˆ¶ | âŒ |
| B. ä¸Šä¼ åˆ°ä¸´æ—¶å­˜å‚¨ | æ— å¤§å°é™åˆ¶ | å¢åŠ å¤æ‚åº¦å’Œæˆæœ¬ | â­â­â­ |
| C. ä½¿ç”¨ API Routes | æ— å¤§å°é™åˆ¶ï¼Œçµæ´» | éœ€è¦é‡æ„ | â­â­â­â­â­ |

**æ¨è**: æ–¹æ¡ˆC - ä½¿ç”¨ API Routes å¤„ç†å¤§æ–‡ä»¶

```typescript
// app/api/image/edit/route.ts
export async function POST(req: Request) {
  const formData = await req.formData();
  const image = formData.get('image') as File;
  const prompt = formData.get('prompt') as string;
  
  // è½¬æ¢ä¸º buffer
  const buffer = Buffer.from(await image.arrayBuffer());
  const base64 = buffer.toString('base64');
  
  // è°ƒç”¨ Gemini API
  const result = await geminiService.editImage(prompt, [{
    base64,
    mimeType: image.type
  }], null);
  
  return Response.json(result);
}
```

#### å†³ç­– 2: è§†é¢‘ç”Ÿæˆæ–¹å¼

**æ¨èæ¶æ„**:

```typescript
// 1. å¯åŠ¨è§†é¢‘ç”Ÿæˆ
// app/api/video/generate/route.ts
export async function POST(req: Request) {
  const { prompt, imageUrl } = await req.json();
  const operation = await geminiService.startVideoGeneration(prompt, imageUrl);
  
  // å­˜å‚¨æ“ä½œIDï¼ˆå¯é€‰ï¼šå­˜å…¥æ•°æ®åº“ï¼‰
  return Response.json({ 
    operationId: operation.name,
    status: 'processing'
  });
}

// 2. è½®è¯¢çŠ¶æ€
// app/api/video/status/[id]/route.ts
export async function GET(req: Request, { params }: { params: { id: string } }) {
  const operation = await geminiService.checkVideoStatus(params.id);
  
  if (operation.done) {
    if (operation.error) {
      return Response.json({ status: 'error', error: operation.error });
    }
    return Response.json({ 
      status: 'completed', 
      videoUrl: operation.response.generatedVideos[0].video.uri 
    });
  }
  
  return Response.json({ status: 'processing' });
}

// 3. å®¢æˆ·ç«¯è½®è¯¢
async function generateVideo(prompt: string, imageUrl: string) {
  // å¯åŠ¨ç”Ÿæˆ
  const { operationId } = await fetch('/api/video/generate', {
    method: 'POST',
    body: JSON.stringify({ prompt, imageUrl })
  }).then(r => r.json());
  
  // è½®è¯¢çŠ¶æ€
  while (true) {
    await new Promise(r => setTimeout(r, 10000)); // 10ç§’
    const status = await fetch(`/api/video/status/${operationId}`).then(r => r.json());
    
    if (status.status === 'completed') {
      return status.videoUrl;
    }
    if (status.status === 'error') {
      throw new Error(status.error);
    }
  }
}
```



#### å†³ç­– 3: é”™è¯¯å¤„ç†ç­–ç•¥

**æ¨èç»Ÿä¸€çš„ Result ç±»å‹**:

```typescript
// types/api.ts
export type ApiResult<T> = 
  | { success: true; data: T }
  | { success: false; error: ApiError };

export interface ApiError {
  code: string;
  message: string;
  userMessage: string;
  details?: any;
}

// Server Action ç¤ºä¾‹
'use server'
export async function editImageAction(
  prompt: string,
  imageUrl: string
): Promise<ApiResult<GeneratedContent>> {
  try {
    const result = await geminiService.editImage(...);
    return { success: true, data: result };
  } catch (error) {
    return {
      success: false,
      error: {
        code: 'GENERATION_FAILED',
        message: error.message,
        userMessage: 'å›¾åƒç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•',
        details: error
      }
    };
  }
}

// Store ä¸­ä½¿ç”¨
const result = await editImageAction(prompt, imageUrl);
if (!result.success) {
  set({ error: result.error.userMessage });
  return;
}
set({ generatedContent: result.data });
```

---

## ğŸ“ˆ æ—¶é—´å’Œèµ„æºè¯„ä¼°

### è°ƒæ•´åçš„æ—¶é—´è¡¨

| ä»»åŠ¡ç»„ | åŸè®¡åˆ’ | è°ƒæ•´å | å˜åŒ– | è¯´æ˜ |
|--------|--------|--------|------|------|
| 2.1 Server Actions | 3å¤© | 5å¤© | +2å¤© | éœ€è¦å¤„ç† base64 é™åˆ¶å’Œ API Routes |
| 2.2 æ›´æ–° Store | 3å¤© | 3å¤© | 0 | ä¿æŒä¸å˜ |
| 2.3 é€Ÿç‡é™åˆ¶ | 2å¤© | 1å¤© | -1å¤© | ç®€åŒ–å®ç° |
| 2.4-2.6 æ€§èƒ½ä¼˜åŒ– | 4å¤© | 4å¤© | 0 | ä¿æŒä¸å˜ |
| 2.7-2.8 SEO | 2å¤© | 2å¤© | 0 | ä¿æŒä¸å˜ |
| 2.9-2.10 é«˜çº§ä¼˜åŒ– | 6å¤© | 4å¤© | -2å¤© | é™ä½ SSR/SSG ç›®æ ‡ |
| **æ€»è®¡** | **20å¤©** | **19å¤©** | **-1å¤©** | **ç•¥æœ‰ä¼˜åŒ–** |

### é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| Base64 å¤§å°é™åˆ¶ | é«˜ | é«˜ | ä½¿ç”¨ API Routes |
| è§†é¢‘ç”Ÿæˆè¶…æ—¶ | é«˜ | é«˜ | ä½¿ç”¨è½®è¯¢æœºåˆ¶ |
| æ€§èƒ½ä¸‹é™ | ä¸­ | ä¸­ | åˆ†é˜¶æ®µæµ‹è¯• |
| API å¯†é’¥æ³„éœ² | ä½ | é«˜ | æœåŠ¡ç«¯è°ƒç”¨ |
| ç”¨æˆ·ä½“éªŒä¸‹é™ | ä¸­ | é«˜ | ä¿ç•™è¿›åº¦åé¦ˆ |



---

## ğŸ”§ å…·ä½“å®æ–½å»ºè®®

### Week 1: æ ¸å¿ƒ API è¿ç§»ï¼ˆDay 21-25ï¼‰

**Day 21-22: åŸºç¡€è®¾æ–½**
- [ ] åˆ›å»º `app/api/image/` ç›®å½•ç»“æ„
- [ ] åˆ›å»ºç»Ÿä¸€çš„ `ApiResult` ç±»å‹
- [ ] å®ç°é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- [ ] é…ç½®ç¯å¢ƒå˜é‡ï¼ˆæœåŠ¡ç«¯ `GEMINI_API_KEY`ï¼‰

**Day 23-24: å›¾åƒç›¸å…³ API**
- [ ] å®ç° `POST /api/image/edit` - å›¾åƒç¼–è¾‘
- [ ] å®ç° `POST /api/image/generate` - æ–‡æœ¬ç”Ÿæˆå›¾åƒ
- [ ] å®ç° `POST /api/image/style-mimic` - é£æ ¼æ¨¡ä»¿
- [ ] æµ‹è¯•ï¼šä¸Šä¼ å›¾ç‰‡ â†’ ç¼–è¾‘ â†’ ä¸‹è½½

**Day 25: èŠå¤©ç›¸å…³ API**
- [ ] å®ç° `POST /api/chat/generate` - èŠå¤©ä¸­ç”Ÿæˆå›¾åƒ
- [ ] å®ç° `POST /api/chat/preprocess` - æç¤ºè¯é¢„å¤„ç†
- [ ] æµ‹è¯•ï¼šèŠå¤©å¯¹è¯ â†’ ç”Ÿæˆå›¾åƒ

### Week 2: Store æ›´æ–°å’Œè§†é¢‘ï¼ˆDay 26-30ï¼‰

**Day 26-27: æ›´æ–° Stores**
- [ ] ä¿®æ”¹ `enhancerStore.ts` è°ƒç”¨æ–° API
- [ ] ä¿®æ”¹ `chatStore.ts` è°ƒç”¨æ–° API
- [ ] ç§»é™¤å®¢æˆ·ç«¯çš„ `geminiService` ä¾èµ–
- [ ] å®Œæ•´å›å½’æµ‹è¯•

**Day 28-29: è§†é¢‘ç”Ÿæˆ**
- [ ] å®ç° `POST /api/video/generate` - å¯åŠ¨è§†é¢‘ç”Ÿæˆ
- [ ] å®ç° `GET /api/video/status/[id]` - æŸ¥è¯¢çŠ¶æ€
- [ ] æ›´æ–° `enhancerStore` çš„è§†é¢‘ç”Ÿæˆé€»è¾‘
- [ ] æµ‹è¯•ï¼šè§†é¢‘ç”Ÿæˆ â†’ è½®è¯¢ â†’ ä¸‹è½½

**Day 30: API å®‰å…¨éªŒè¯**
- [ ] æ£€æŸ¥æµè§ˆå™¨ DevToolsï¼Œç¡®è®¤ API å¯†é’¥ä¸å¯è§
- [ ] æ£€æŸ¥ç½‘ç»œè¯·æ±‚ï¼Œç¡®è®¤æ‰€æœ‰ API è°ƒç”¨èµ°æœåŠ¡ç«¯
- [ ] å®ç°ç®€å•çš„ IP é™æµ
- [ ] æµ‹è¯•ï¼šå°è¯•ç›´æ¥è°ƒç”¨ APIï¼ˆåº”è¯¥å¤±è´¥ï¼‰



### Week 3: æ€§èƒ½ä¼˜åŒ–ï¼ˆDay 31-35ï¼‰

**Day 31-32: å›¾ç‰‡å’Œå­—ä½“ä¼˜åŒ–**
- [ ] ä¼˜åŒ–é™æ€å›¾ç‰‡ï¼ˆä½¿ç”¨ `next/image`ï¼‰
- [ ] ä¼˜åŒ– Material Symbols åŠ è½½ï¼ˆæœ¬åœ°åŒ–æˆ– CDN ä¼˜åŒ–ï¼‰
- [ ] é…ç½®å›¾ç‰‡åŸŸåç™½åå•
- [ ] Lighthouse æµ‹è¯•ï¼ˆç›®æ ‡ï¼šæ€§èƒ½ > 80ï¼‰

**Day 33-34: ä»£ç åˆ†å‰²**
- [ ] ä½¿ç”¨ `dynamic()` å¯¼å…¥ Canvas ç¼–è¾‘å™¨
- [ ] ä½¿ç”¨ `dynamic()` å¯¼å…¥è§†é¢‘æ’­æ”¾å™¨
- [ ] ä½¿ç”¨ `dynamic()` å¯¼å…¥å¤§å‹æ•ˆæœç»„ä»¶
- [ ] Bundle åˆ†æï¼ˆ`npm run analyze`ï¼‰

**Day 35: SEO ä¼˜åŒ–**
- [ ] æ·»åŠ é¡µé¢ Metadata
- [ ] åˆ›å»º `robots.txt`
- [ ] åˆ›å»º `sitemap.xml`
- [ ] é…ç½® OpenGraph æ ‡ç­¾

### Week 4: é«˜çº§ä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆDay 36-40ï¼‰

**Day 36-37: Streaming å’Œ Loading**
- [ ] åˆ›å»º Loading ç»„ä»¶
- [ ] åˆ›å»º Skeleton ç»„ä»¶
- [ ] ä½¿ç”¨ Suspenseï¼ˆå¦‚æœé€‚ç”¨ï¼‰
- [ ] æµ‹è¯•åŠ è½½ä½“éªŒ

**Day 38-39: æ€§èƒ½æµ‹è¯•**
- [ ] Lighthouse å®Œæ•´æµ‹è¯•ï¼ˆæ‰€æœ‰é¡µé¢ï¼‰
- [ ] æ€§èƒ½æŒ‡æ ‡è®°å½•ï¼ˆTTFB, FCP, LCP, TTIï¼‰
- [ ] ä¸ Phase 1 å¯¹æ¯”
- [ ] ä¼˜åŒ–ç“¶é¢ˆ

**Day 40: æœ€ç»ˆéªŒè¯**
- [ ] å®Œæ•´åŠŸèƒ½å›å½’æµ‹è¯•
- [ ] æ€§èƒ½éªŒè¯ï¼ˆç›®æ ‡è¾¾æˆï¼‰
- [ ] API å®‰å…¨éªŒè¯
- [ ] æ–‡æ¡£æ›´æ–°

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### å¿…é¡»è¾¾æˆï¼ˆP0ï¼‰

- âœ… API å¯†é’¥å®Œå…¨ä¸æš´éœ²åœ¨å®¢æˆ·ç«¯
- âœ… æ‰€æœ‰ 8 ä¸ª API å‡½æ•°è¿ç§»åˆ°æœåŠ¡ç«¯
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆä¸ Phase 1 ä¸€è‡´ï¼‰
- âœ… æ— æ§åˆ¶å°é”™è¯¯
- âœ… æ„å»ºæˆåŠŸ

### åº”è¯¥è¾¾æˆï¼ˆP1ï¼‰

- âœ… Lighthouse æ€§èƒ½åˆ†æ•° > 80
- âœ… é¦–å±åŠ è½½æ—¶é—´ < 3ç§’
- âœ… TTFB < 800ms
- âœ… ç®€å•çš„é€Ÿç‡é™åˆ¶ç”Ÿæ•ˆ

### å¯ä»¥è¾¾æˆï¼ˆP2ï¼‰

- â­ Lighthouse æ€§èƒ½åˆ†æ•° > 90
- â­ é¦–å±åŠ è½½æ—¶é—´ < 2ç§’
- â­ TTFB < 600ms
- â­ éƒ¨åˆ† SSR/SSG å®ç°



---

## ğŸ’¡ å…³é”®å»ºè®®æ€»ç»“

### 1. æ¶æ„è°ƒæ•´

**å¿…é¡»è°ƒæ•´**:
- âŒ ä¸è¦ä½¿ç”¨ Server Actions ä¼ è¾“å¤§æ–‡ä»¶ï¼ˆbase64ï¼‰
- âœ… ä½¿ç”¨ API Routes å¤„ç†å›¾ç‰‡ä¸Šä¼ å’Œç”Ÿæˆ
- âœ… è§†é¢‘ç”Ÿæˆä½¿ç”¨è½®è¯¢æœºåˆ¶ï¼Œä¸è¦é˜»å¡ Server Actions

**å¯é€‰è°ƒæ•´**:
- é€Ÿç‡é™åˆ¶å¯ä»¥ç®€åŒ–ï¼ˆPhase 2 ç”¨ IPï¼ŒPhase 3 ç”¨ç”¨æˆ·ï¼‰
- SSR/SSG ç›®æ ‡å¯ä»¥é™ä½ï¼ˆä¿æŒ CSR ä¸ºä¸»ï¼‰

### 2. å®æ–½ç­–ç•¥

**åˆ†é˜¶æ®µéªŒè¯**:
```
å®Œæˆä¸€ä¸ª API â†’ ç«‹å³æµ‹è¯• â†’ ç¡®è®¤æ— è¯¯ â†’ ç»§ç»­ä¸‹ä¸€ä¸ª
```

**ä¸è¦**:
```
å®Œæˆæ‰€æœ‰ API â†’ ä¸€æ¬¡æ€§æµ‹è¯• â†’ å‘ç°é—®é¢˜ â†’ éš¾ä»¥å®šä½
```

### 3. é£é™©æ§åˆ¶

**é«˜é£é™©ä»»åŠ¡**:
1. å›¾ç‰‡ä¼ è¾“æ–¹å¼æ”¹é€ ï¼ˆbase64 â†’ API Routesï¼‰
2. è§†é¢‘ç”Ÿæˆçš„é•¿æ—¶é—´è¿è¡Œå¤„ç†
3. é”™è¯¯å¤„ç†çš„åŒå±‚ç»“æ„

**ç¼“è§£æªæ–½**:
- æå‰åšæŠ€æœ¯éªŒè¯ï¼ˆPOCï¼‰
- ä¿ç•™ Phase 1 çš„ä»£ç ä½œä¸ºå›é€€
- æ¯ä¸ª API ç‹¬ç«‹æµ‹è¯•

### 4. æ—¶é—´ç®¡ç†

**åŸè®¡åˆ’**: 20å¤©ï¼ˆ3-4å‘¨ï¼‰  
**è°ƒæ•´å**: 19å¤©ï¼ˆçº¦3å‘¨ï¼‰  
**å»ºè®®**: é¢„ç•™ 1 å‘¨ç¼“å†²æ—¶é—´ï¼Œæ€»è®¡ 4 å‘¨

**å…³é”®è·¯å¾„**:
```
API è¿ç§»ï¼ˆ5å¤©ï¼‰â†’ Store æ›´æ–°ï¼ˆ3å¤©ï¼‰â†’ æµ‹è¯•ï¼ˆ2å¤©ï¼‰â†’ æ€§èƒ½ä¼˜åŒ–ï¼ˆ5å¤©ï¼‰â†’ æœ€ç»ˆéªŒè¯ï¼ˆ4å¤©ï¼‰
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### Next.js å®˜æ–¹æ–‡æ¡£
- [Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations)
- [API Routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)
- [Image Optimization](https://nextjs.org/docs/app/building-your-application/optimizing/images)
- [Font Optimization](https://nextjs.org/docs/app/building-your-application/optimizing/fonts)

### ç›¸å…³æŠ€æœ¯
- [Upstash Redis](https://upstash.com/docs/redis/overall/getstarted)
- [Vercel Blob Storage](https://vercel.com/docs/storage/vercel-blob)
- [Server-Sent Events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**åˆ†æäºº**: Kiro AI  
**åˆ†ææ—¥æœŸ**: 2025-10-29  
**ä¸‹ä¸€æ­¥**: ç­‰å¾…ç”¨æˆ·ç¡®è®¤åå¼€å§‹ Phase 2 å®æ–½



---

## ğŸ¯ æœ€ç»ˆå†³ç­–è®°å½•

**å†³ç­–æ—¥æœŸ**: 2025-10-29  
**å†³ç­–äºº**: é¡¹ç›®è´Ÿè´£äºº

### å†³ç­–å†…å®¹

#### 1. æ¶æ„æ–¹æ¡ˆ âœ… **å·²ç¡®è®¤**

**å†³ç­–**: å…¨é¢ä½¿ç”¨ API Routes

**ç†ç”±**:
- 50% çš„ API æ— æ³•ä½¿ç”¨ Server Actionsï¼ˆå¤§å°æˆ–è¶…æ—¶é™åˆ¶ï¼‰
- ä»£ç ä¸€è‡´æ€§æ¯”ç®€æ´æ€§æ›´é‡è¦
- æœªæ¥æ‰©å±•æ€§æ›´å¥½ï¼ˆæµå¼å“åº”ã€Webhook ç­‰ï¼‰

**è¯¦ç»†æ–‡æ¡£**: å‚è§ `server-actions-vs-api-routes.md`

#### 2. æ—¶é—´å®‰æ’ âœ… **å·²ç¡®è®¤**

**å†³ç­–**: æ¥å— 4 å‘¨æ—¶é—´å®‰æ’ï¼ˆè€ŒéåŸè®¡åˆ’çš„ 3 å‘¨ï¼‰

**è°ƒæ•´åæ—¶é—´è¡¨**:
- Week 1 (Day 21-25): API Routes åŸºç¡€è®¾æ–½ + å›¾åƒ API
- Week 2 (Day 26-30): èŠå¤©å’Œè§†é¢‘ API + Store æ›´æ–°
- Week 3 (Day 31-37): æ€§èƒ½ä¼˜åŒ–ï¼ˆå›¾ç‰‡ã€å­—ä½“ã€ä»£ç åˆ†å‰²ã€SEOï¼‰
- Week 4 (Day 38-44): é«˜çº§ä¼˜åŒ–ï¼ˆStreamingã€SSR/SSGï¼‰+ æœ€ç»ˆæµ‹è¯•

**æ€»è®¡**: 24 å¤©ï¼ˆçº¦ 4 å‘¨ï¼‰+ ç¼“å†²æ—¶é—´

**ç†ç”±**:
- API Routes å®ç°æ¯” Server Actions éœ€è¦æ›´å¤šæ—¶é—´
- éœ€è¦å……åˆ†çš„æµ‹è¯•æ—¶é—´
- ä¸ºä¸å¯é¢„è§çš„é—®é¢˜é¢„ç•™ç¼“å†²

#### 3. é€Ÿç‡é™åˆ¶å®ç°æ—¶æœº âœ… **å·²ç¡®è®¤**

**å†³ç­–**: Phase 3 å®ç°å®Œæ•´ç‰ˆï¼ˆè€Œé Phase 2 ç®€åŒ–ç‰ˆï¼‰

**Phase 2 ç­–ç•¥**: æš‚ä¸å®ç°é€Ÿç‡é™åˆ¶

**Phase 3 ç­–ç•¥**: ç»“åˆç”¨æˆ·ç³»ç»Ÿå®ç°å®Œæ•´çš„é…é¢ç®¡ç†

**ç†ç”±**:
- Phase 2 æ— ç”¨æˆ·ç³»ç»Ÿï¼ŒåŸºäº IP çš„é™æµæ„ä¹‰ä¸å¤§
- Phase 3 æœ‰ç”¨æˆ·ç³»ç»Ÿåï¼Œå¯ä»¥å®ç°æ›´ç²¾ç¡®çš„é…é¢ç®¡ç†
- èŠ‚çœ Phase 2 çš„å¼€å‘æ—¶é—´ï¼Œä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½

**å½±å“**: Phase 2 ä»»åŠ¡å‡å°‘ 1-2 å¤©

#### 4. SSR/SSG ä¼˜åŒ–ç›®æ ‡ âœ… **å·²ç¡®è®¤**

**å†³ç­–**: ç§¯æä¼˜åŒ–ï¼ˆè€Œéä¿æŒ CSR ä¸ºä¸»ï¼‰

**å…·ä½“ç›®æ ‡**:
- é¡µé¢æ¡†æ¶ä½¿ç”¨ SSRï¼ˆlayout, metadataï¼‰
- é™æ€å†…å®¹ä½¿ç”¨ SSGï¼ˆæ•ˆæœåˆ—è¡¨ã€æ–‡æ¡£é¡µé¢ï¼‰
- äº¤äº’ç»„ä»¶ä¿æŒ CSRï¼ˆç¼–è¾‘å™¨ã€èŠå¤©ï¼‰
- ç›®æ ‡ï¼šLighthouse æ€§èƒ½åˆ†æ•° > 90

**å®æ–½ç­–ç•¥**:
1. è¯†åˆ«å¯ä»¥ SSR/SSG çš„ç»„ä»¶
2. æ‹†åˆ† Server Components å’Œ Client Components
3. ä¼˜åŒ–é¦–å±åŠ è½½
4. ä½¿ç”¨ Suspense å’Œ Streaming

**ç†ç”±**:
- æå‡ SEO æ•ˆæœ
- æ”¹å–„é¦–å±åŠ è½½é€Ÿåº¦
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
- å±•ç¤º Next.js çš„ä¼˜åŠ¿

---

## ğŸ“Š å†³ç­–å½±å“åˆ†æ

### æ—¶é—´å½±å“

| ä»»åŠ¡ç»„ | åŸè®¡åˆ’ | å†³ç­–å | å˜åŒ– | è¯´æ˜ |
|--------|--------|--------|------|------|
| 2.1 API Routes å®ç° | 3å¤© | 5å¤© | +2å¤© | ä½¿ç”¨ API Routes éœ€è¦æ›´å¤šä»£ç  |
| 2.2 Store æ›´æ–° | 3å¤© | 3å¤© | 0 | ä¿æŒä¸å˜ |
| 2.3 é€Ÿç‡é™åˆ¶ | 2å¤© | 0å¤© | -2å¤© | ç§»è‡³ Phase 3 |
| 2.4-2.6 æ€§èƒ½ä¼˜åŒ– | 4å¤© | 4å¤© | 0 | ä¿æŒä¸å˜ |
| 2.7-2.8 SEO | 2å¤© | 2å¤© | 0 | ä¿æŒä¸å˜ |
| 2.9-2.10 SSR/SSG | 6å¤© | 7å¤© | +1å¤© | ç§¯æä¼˜åŒ–éœ€è¦æ›´å¤šæ—¶é—´ |
| **æ€»è®¡** | **20å¤©** | **21å¤©** | **+1å¤©** | **çº¦ 4 å‘¨ï¼ˆå«ç¼“å†²ï¼‰** |

### å·¥ä½œé‡å½±å“

**å¢åŠ çš„å·¥ä½œ**:
- âœ… API Routes å®ç°ï¼ˆ+2å¤©ï¼‰
- âœ… SSR/SSG ç§¯æä¼˜åŒ–ï¼ˆ+1å¤©ï¼‰

**å‡å°‘çš„å·¥ä½œ**:
- âœ… é€Ÿç‡é™åˆ¶ç§»è‡³ Phase 3ï¼ˆ-2å¤©ï¼‰

**å‡€å¢åŠ **: +1 å¤©ï¼Œä½†è€ƒè™‘åˆ°ç¼“å†²æ—¶é—´ï¼Œæ€»ä½“ä¸º 4 å‘¨

### é£é™©å½±å“

**é™ä½çš„é£é™©**:
- âœ… API Routes æ— å¤§å°å’Œè¶…æ—¶é™åˆ¶
- âœ… é€Ÿç‡é™åˆ¶å»¶åï¼Œå‡å°‘ Phase 2 å¤æ‚åº¦

**æ–°å¢çš„é£é™©**:
- âš ï¸ API Routes ä»£ç é‡å¢åŠ ï¼Œå¯èƒ½æœ‰æ›´å¤š bug
- âš ï¸ SSR/SSG ä¼˜åŒ–å¯èƒ½é‡åˆ°æ°´åˆé”™è¯¯

**ç¼“è§£æªæ–½**:
- åˆ†é˜¶æ®µæµ‹è¯•ï¼Œæ¯ä¸ª API å®Œæˆåç«‹å³æµ‹è¯•
- SSR/SSG é€æ­¥ä¼˜åŒ–ï¼Œä¿ç•™ CSR ä½œä¸ºå›é€€

---

## ğŸ¯ æ›´æ–°åçš„æˆåŠŸæ ‡å‡†

### Phase 2 å¿…é¡»è¾¾æˆï¼ˆP0ï¼‰

- âœ… æ‰€æœ‰ API ä½¿ç”¨ API Routes å®ç°
- âœ… API å¯†é’¥å®Œå…¨ä¸æš´éœ²åœ¨å®¢æˆ·ç«¯
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆä¸ Phase 1 ä¸€è‡´ï¼‰
- âœ… æ— æ§åˆ¶å°é”™è¯¯
- âœ… æ„å»ºæˆåŠŸ

### Phase 2 åº”è¯¥è¾¾æˆï¼ˆP1ï¼‰

- âœ… Lighthouse æ€§èƒ½åˆ†æ•° > 85
- âœ… é¦–å±åŠ è½½æ—¶é—´ < 3ç§’
- âœ… TTFB < 800ms
- âœ… éƒ¨åˆ† SSR/SSG å®ç°ï¼ˆé¡µé¢æ¡†æ¶ã€é™æ€å†…å®¹ï¼‰
- âœ… å›¾ç‰‡å’Œå­—ä½“ä¼˜åŒ–å®Œæˆ
- âœ… ä»£ç åˆ†å‰²ä¼˜åŒ–å®Œæˆ

### Phase 2 å¯ä»¥è¾¾æˆï¼ˆP2ï¼‰

- â­ Lighthouse æ€§èƒ½åˆ†æ•° > 90
- â­ é¦–å±åŠ è½½æ—¶é—´ < 2ç§’
- â­ TTFB < 600ms
- â­ æ›´å¤šç»„ä»¶ä½¿ç”¨ SSR/SSG

### Phase 3 ç›®æ ‡ï¼ˆå»¶åï¼‰

- ğŸ”„ å®Œæ•´çš„é€Ÿç‡é™åˆ¶å’Œé…é¢ç®¡ç†
- ğŸ”„ ç”¨æˆ·ç³»ç»Ÿé›†æˆ
- ğŸ”„ æ•°æ®åº“æŒä¹…åŒ–

---

## ğŸ“‹ æ›´æ–°åçš„å®æ–½è®¡åˆ’

### Week 1: API Routes åŸºç¡€è®¾æ–½ï¼ˆDay 21-25ï¼Œ5å¤©ï¼‰

**Day 21: åŸºç¡€è®¾æ–½æ­å»º**
- [ ] åˆ›å»º `app/api/` ç›®å½•ç»“æ„
- [ ] åˆ›å»º `types/api.ts` ç»Ÿä¸€ç±»å‹å®šä¹‰
- [ ] åˆ›å»º `lib/api-utils.ts` å·¥å…·å‡½æ•°
- [ ] é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ`GEMINI_API_KEY`ï¼‰
- [ ] ç¼–å†™ API æµ‹è¯•å·¥å…·

**Day 22-23: å›¾åƒç›¸å…³ API**
- [ ] å®ç° `POST /api/image/edit` - å›¾åƒç¼–è¾‘
- [ ] å®ç° `POST /api/image/generate` - æ–‡æœ¬ç”Ÿæˆå›¾åƒ
- [ ] å®ç° `POST /api/image/style-mimic` - é£æ ¼æ¨¡ä»¿
- [ ] å®ç° `POST /api/image/batch` - æ‰¹é‡ç¼–è¾‘
- [ ] ä½¿ç”¨ Postman æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹

**Day 24-25: èŠå¤©å’Œå…¶ä»– API**
- [ ] å®ç° `POST /api/chat/generate` - èŠå¤©ä¸­ç”Ÿæˆå›¾åƒ
- [ ] å®ç° `POST /api/chat/preprocess` - æç¤ºè¯é¢„å¤„ç†
- [ ] å®ç° `POST /api/transformations/suggestions` - æ•ˆæœå»ºè®®
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### Week 2: è§†é¢‘ API å’Œ Store æ›´æ–°ï¼ˆDay 26-30ï¼Œ5å¤©ï¼‰

**Day 26-27: è§†é¢‘ç”Ÿæˆ API**
- [ ] å®ç° `POST /api/video/generate` - å¯åŠ¨è§†é¢‘ç”Ÿæˆ
- [ ] å®ç° `GET /api/video/status/[id]` - æŸ¥è¯¢çŠ¶æ€
- [ ] åœ¨ `geminiService.ts` ä¸­æ‹†åˆ†è§†é¢‘ç”Ÿæˆé€»è¾‘
- [ ] æµ‹è¯•å®Œæ•´çš„è§†é¢‘ç”Ÿæˆæµç¨‹

**Day 28-29: æ›´æ–° Stores**
- [ ] æ›´æ–° `enhancerStore.ts` ä½¿ç”¨æ–° API
- [ ] æ›´æ–° `chatStore.ts` ä½¿ç”¨æ–° API
- [ ] å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼ˆFile å¯¹è±¡ï¼‰
- [ ] æ›´æ–°é”™è¯¯å¤„ç†é€»è¾‘

**Day 30: API å®‰å…¨å’ŒåŠŸèƒ½éªŒè¯**
- [ ] éªŒè¯ API å¯†é’¥ä¸åœ¨å®¢æˆ·ç«¯å¯è§
- [ ] éªŒè¯æ‰€æœ‰ API è°ƒç”¨èµ°æœåŠ¡ç«¯
- [ ] å®Œæ•´åŠŸèƒ½å›å½’æµ‹è¯•
- [ ] ä¿®å¤å‘ç°çš„é—®é¢˜

### Week 3: æ€§èƒ½ä¼˜åŒ–ï¼ˆDay 31-37ï¼Œ7å¤©ï¼‰

**Day 31-32: å›¾ç‰‡å’Œå­—ä½“ä¼˜åŒ–**
- [ ] ä½¿ç”¨ `next/image` ä¼˜åŒ–é™æ€å›¾ç‰‡
- [ ] ä¼˜åŒ– Material Symbols åŠ è½½
- [ ] é…ç½®å›¾ç‰‡åŸŸåç™½åå•
- [ ] Lighthouse æµ‹è¯•ï¼ˆç›®æ ‡ï¼šæ€§èƒ½ > 80ï¼‰

**Day 33-34: ä»£ç åˆ†å‰²**
- [ ] ä½¿ç”¨ `dynamic()` å¯¼å…¥ Canvas ç¼–è¾‘å™¨
- [ ] ä½¿ç”¨ `dynamic()` å¯¼å…¥è§†é¢‘æ’­æ”¾å™¨
- [ ] ä½¿ç”¨ `dynamic()` å¯¼å…¥å¤§å‹æ•ˆæœç»„ä»¶
- [ ] Bundle åˆ†æï¼ˆ`npm run analyze`ï¼‰

**Day 35-36: SEO ä¼˜åŒ–**
- [ ] æ·»åŠ æ‰€æœ‰é¡µé¢çš„ Metadata
- [ ] åˆ›å»º `robots.txt`
- [ ] åˆ›å»º `sitemap.xml`
- [ ] é…ç½® OpenGraph å’Œ Twitter Card

**Day 37: ä¸­æœŸéªŒè¯**
- [ ] Lighthouse å®Œæ•´æµ‹è¯•
- [ ] æ€§èƒ½æŒ‡æ ‡è®°å½•
- [ ] ä¸ Phase 1 å¯¹æ¯”
- [ ] è¯†åˆ«ä¼˜åŒ–ç“¶é¢ˆ

### Week 4: é«˜çº§ä¼˜åŒ–å’Œæœ€ç»ˆæµ‹è¯•ï¼ˆDay 38-44ï¼Œ7å¤©ï¼‰

**Day 38-39: Streaming å’Œ Loading**
- [ ] åˆ›å»º Loading ç»„ä»¶ï¼ˆ`app/loading.tsx`ï¼‰
- [ ] åˆ›å»º Skeleton ç»„ä»¶
- [ ] ä½¿ç”¨ Suspense åŒ…è£…å¼‚æ­¥ç»„ä»¶
- [ ] æµ‹è¯•åŠ è½½ä½“éªŒ

**Day 40-42: SSR/SSG ä¼˜åŒ–ï¼ˆç§¯æä¼˜åŒ–ï¼‰**
- [ ] è¯†åˆ«å¯ä»¥ SSR/SSG çš„ç»„ä»¶
- [ ] æ‹†åˆ† Server Components å’Œ Client Components
- [ ] å°†æ•ˆæœåˆ—è¡¨æ”¹ä¸º SSG
- [ ] å°†é¡µé¢æ¡†æ¶æ”¹ä¸º SSR
- [ ] æµ‹è¯•æ°´åˆï¼ˆhydrationï¼‰
- [ ] éªŒè¯æ— æ°´åˆé”™è¯¯

**Day 43: æ€§èƒ½æœ€ç»ˆä¼˜åŒ–**
- [ ] Lighthouse æµ‹è¯•ï¼ˆç›®æ ‡ï¼š> 90ï¼‰
- [ ] ä¼˜åŒ–é¦–å±åŠ è½½æ—¶é—´ï¼ˆç›®æ ‡ï¼š< 2ç§’ï¼‰
- [ ] ä¼˜åŒ– TTFBï¼ˆç›®æ ‡ï¼š< 600msï¼‰
- [ ] ä¼˜åŒ– Bundle å¤§å°

**Day 44: æœ€ç»ˆéªŒè¯å’Œæ–‡æ¡£**
- [ ] å®Œæ•´åŠŸèƒ½å›å½’æµ‹è¯•
- [ ] æ€§èƒ½éªŒè¯ï¼ˆæ‰€æœ‰æŒ‡æ ‡è¾¾æ ‡ï¼‰
- [ ] API å®‰å…¨éªŒè¯
- [ ] æ›´æ–°æ–‡æ¡£
- [ ] å‡†å¤‡ Phase 3

---

## ğŸ”„ ä¸åŸè®¡åˆ’çš„ä¸»è¦å˜åŒ–

### å˜åŒ– 1: æ¶æ„æ–¹æ¡ˆ

**åŸè®¡åˆ’**: æ··åˆä½¿ç”¨ Server Actions å’Œ API Routes  
**æœ€ç»ˆå†³ç­–**: å…¨é¢ä½¿ç”¨ API Routes

**å½±å“**:
- ä»£ç é£æ ¼æ›´ç»Ÿä¸€
- å¼€å‘æ—¶é—´ç•¥å¢ï¼ˆ+2å¤©ï¼‰
- çµæ´»æ€§å¤§å¹…æå‡

### å˜åŒ– 2: é€Ÿç‡é™åˆ¶

**åŸè®¡åˆ’**: Phase 2 å®ç°åŸºäº IP çš„ç®€å•é™æµ  
**æœ€ç»ˆå†³ç­–**: ç§»è‡³ Phase 3ï¼Œç»“åˆç”¨æˆ·ç³»ç»Ÿå®ç°

**å½±å“**:
- Phase 2 æ—¶é—´å‡å°‘ï¼ˆ-2å¤©ï¼‰
- Phase 2 å¤æ‚åº¦é™ä½
- Phase 3 åŠŸèƒ½æ›´å®Œæ•´

### å˜åŒ– 3: SSR/SSG ç›®æ ‡

**åŸè®¡åˆ’**: ä¿æŒ CSR ä¸ºä¸»ï¼Œå°‘é‡ SSR/SSG  
**æœ€ç»ˆå†³ç­–**: ç§¯æä¼˜åŒ–ï¼Œå……åˆ†åˆ©ç”¨ SSR/SSG

**å½±å“**:
- æ€§èƒ½ç›®æ ‡æé«˜ï¼ˆLighthouse > 90ï¼‰
- å¼€å‘æ—¶é—´ç•¥å¢ï¼ˆ+1å¤©ï¼‰
- SEO æ•ˆæœæ›´å¥½

### å˜åŒ– 4: æ€»æ—¶é—´

**åŸè®¡åˆ’**: 3-4 å‘¨ï¼ˆ20å¤©ï¼‰  
**æœ€ç»ˆå†³ç­–**: 4 å‘¨ï¼ˆ21å¤© + ç¼“å†²ï¼‰

**å½±å“**:
- æ›´å……è£•çš„å¼€å‘æ—¶é—´
- æ›´å……åˆ†çš„æµ‹è¯•
- æ›´é«˜çš„è´¨é‡ä¿è¯

---

## âœ… å†³ç­–ç¡®è®¤æ¸…å•

- [x] æ¶æ„æ–¹æ¡ˆï¼šå…¨é¢ä½¿ç”¨ API Routes
- [x] æ—¶é—´å®‰æ’ï¼šæ¥å— 4 å‘¨ï¼ˆ21å¤© + ç¼“å†²ï¼‰
- [x] é€Ÿç‡é™åˆ¶ï¼šç§»è‡³ Phase 3
- [x] SSR/SSGï¼šç§¯æä¼˜åŒ–
- [x] æˆåŠŸæ ‡å‡†ï¼šLighthouse > 90
- [x] å®æ–½è®¡åˆ’ï¼š4 å‘¨è¯¦ç»†ä»»åŠ¡
- [x] é£é™©è¯„ä¼°ï¼šå·²è¯†åˆ«å¹¶åˆ¶å®šç¼“è§£æªæ–½
- [x] å›æ»šæœºåˆ¶ï¼šä¿ç•™ Phase 1 ä»£ç 

---

**å†³ç­–çŠ¶æ€**: âœ… å·²ç¡®è®¤  
**æ–‡æ¡£ç‰ˆæœ¬**: 2.0ï¼ˆæœ€ç»ˆç‰ˆï¼‰  
**ä¸‹ä¸€æ­¥**: æ›´æ–° tasks.mdï¼Œå‡†å¤‡å¼€å§‹å®æ–½

