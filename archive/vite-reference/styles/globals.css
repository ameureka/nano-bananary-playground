/* ========================================= */
      /* 1. 设计令牌 & 全局样式 (Design Tokens & Global Styles) */
      /* ========================================= */
      :root {
          /* 亮色主题 (Light Theme) */
          --md-sys-color-primary: #3b608f;
          --md-sys-color-on-primary: #ffffff;
          --md-sys-color-primary-container: #d5e3ff;
          --md-sys-color-on-primary-container: #001d36;
          --md-sys-color-secondary: #535f70;
          --md-sys-color-on-secondary: #ffffff;
          --md-sys-color-secondary-container: #d7e3f8;
          --md-sys-color-on-secondary-container: #101c2b;
          --md-sys-color-tertiary: #6b5778;
          --md-sys-color-on-tertiary: #ffffff;
          --md-sys-color-tertiary-container: #f2daff;
          --md-sys-color-on-tertiary-container: #251431;
          --md-sys-color-error: #ba1a1a;
          --md-sys-color-on-error: #ffffff;
          --md-sys-color-error-container: #ffdad6;
          --md-sys-color-on-error-container: #410002;
          --md-sys-color-background: #fdfcff;
          --md-sys-color-on-background: #1a1c1e;
          --md-sys-color-surface: #fdfcff;
          --md-sys-color-on-surface: #1a1c1e;
          --md-sys-color-surface-variant: #F8FAFD;
          --md-sys-color-on-surface-variant: #43474e;
          --md-sys-color-outline: #73777f;
          --md-sys-color-outline-variant: #c3c7cf;
          --md-sys-color-scrim: #000000;
          --md-sys-color-shadow: #000000;
          --md-sys-color-inverse-surface: #2f3033;
          --md-sys-color-inverse-on-surface: #f1f0f4;
          --md-sys-color-inverse-primary: #a7c8ff;
      
          /* 状态层 (State Layers) */
          --md-state-hover: 0.08;
          --md-state-pressed: 0.12;
          --md-state-focused: 0.12;
          --md-state-dragged: 0.16;
          
          /* 阴影效果 (Elevation Shadows - Softer) */
          --md-elevation-1: 0px 1px 2px rgba(0, 0, 0, 0.05), 0px 2px 5px rgba(0, 0, 0, 0.05);
          --md-elevation-2: 0px 2px 4px rgba(0, 0, 0, 0.06), 0px 4px 10px rgba(0, 0, 0, 0.06);
      }
      
      /* 暗色主题 (Dark Theme) */
      html[data-theme="dark"] {
          --md-sys-color-primary: #a7c8ff;
          --md-sys-color-on-primary: #003258;
          --md-sys-color-primary-container: #214875;
          --md-sys-color-on-primary-container: #d5e3ff;
          --md-sys-color-secondary: #bbc7db;
          --md-sys-color-on-secondary: #253140;
          --md-sys-color-secondary-container: #3b4858;
          --md-sys-color-on-secondary-container: #d7e3f8;
          --md-sys-color-tertiary: #d6bee4;
          --md-sys-color-on-tertiary: #3b2947;
          --md-sys-color-tertiary-container: #523f5f;
          --md-sys-color-on-tertiary-container: #f2daff;
          --md-sys-color-error: #ffb4ab;
          --md-sys-color-on-error: #690005;
          --md-sys-color-error-container: #93000a;
          --md-sys-color-on-error-container: #ffdad6;
          --md-sys-color-background: #1a1c1e;
          --md-sys-color-on-background: #e3e2e6;
          --md-sys-color-surface: #1a1c1e;
          --md-sys-color-on-surface: #e2e2e6;
          --md-sys-color-surface-variant: #2a2d30;
          --md-sys-color-on-surface-variant: #c3c7cf;
          --md-sys-color-outline: #8d9199;
          --md-sys-color-outline-variant: #43474e;
          --md-sys-color-inverse-surface: #e2e2e6;
          --md-sys-color-inverse-on-surface: #2f3033;
          --md-sys-color-inverse-primary: #3b608f;
      }
      
      *, *::before, *::after {
          box-sizing: border-box;
      }
      
      body {
          font-family: 'Roboto', sans-serif;
          color: var(--md-sys-color-on-surface);
          background-color: var(--md-sys-color-background);
          margin: 0;
          padding: 0;
          height: 100vh;
          overflow: hidden;
      }
      
      h1, h2, h3, p { margin: 0; }
      
      .material-symbols-outlined {
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        vertical-align: middle;
        font-size: 24px;
      }
      
      /* ========================================= */
      /* 2. 水波纹 & 动画 (Ripple & Animations)      */
      /* ========================================= */
      .ripple-surface {
          position: relative;
          overflow: hidden;
          isolation: isolate;
      }
      .ripple-surface::before {
          content: "";
          position: absolute;
          inset: 0;
          background-color: var(--ripple-color, currentColor);
          opacity: 0;
          transition: opacity 200ms linear;
          pointer-events: none;
          z-index: 0; 
      }
      .ripple-surface:hover::before { opacity: var(--md-state-hover); }
      .ripple-surface:active::before { opacity: var(--md-state-pressed); }

      .ripple-effect {
          position: absolute;
          border-radius: 50%;
          background-color: var(--md-sys-color-primary);
          transform: scale(0);
          animation: ripple-animation 600ms linear;
          opacity: 0.3;
          pointer-events: none;
      }
      @keyframes ripple-animation {
          to {
              transform: scale(4);
              opacity: 0;
          }
      }
      
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      /* ========================================= */
      /* 3. 布局 & 应用结构 (Layout & App Structure) */
      /* ========================================= */
      #root, .app-container {
          display: flex;
          height: 100vh;
          width: 100vw;
      }
      .main-content {
          flex: 1;
          position: relative;
          background: var(--md-sys-color-surface);
          display: flex;
          flex-direction: column;
          overflow: hidden;
          transition: border-radius 0.3s ease;
      }
      .top-app-bar {
          height: 64px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 0 1rem;
          border-bottom: 1px solid var(--md-sys-color-outline-variant);
          flex-shrink: 0;
          position: relative;
          transition: background-color 200ms ease;
      }
      .top-app-bar-start, .top-app-bar-actions {
          display: flex;
          align-items: center;
          gap: 1rem;
      }
      .view-wrapper {
        flex: 1;
        position: relative;
        display: flex;
        overflow: hidden;
      }
      .view-container {
          flex: 1;
          position: relative;
          overflow: auto;
          display: flex;
          flex-direction: column;
          transition: width 0.3s ease;
      }
      .enhancer-view-padding {
          padding: 1rem;
      }
      
      /* --- 侧边栏 (Sidebar) --- */
      .sidebar {
          width: 256px;
          height: 100%;
          padding: 12px;
          display: flex;
          flex-direction: column;
          gap: 8px;
          flex-shrink: 0;
          background-color: var(--md-sys-color-surface-variant);
          transition: width 0.3s ease;
          position: relative;
      }
      .sidebar.collapsed {
        width: 80px;
      }
      .sidebar-header {
          padding: 12px 16px;
          display: flex;
          align-items: center;
          gap: 12px;
          white-space: nowrap;
      }
      .sidebar-logo-text {
          font-family: "'Exo 2', sans-serif";
          font-size: 1.5rem;
          font-weight: 700;
          color: var(--md-sys-color-primary);
      }
      .sidebar-nav-items {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .sidebar-item {
          display: flex; align-items: center; gap: 12px;
          padding: 0 16px; height: 48px; border-radius: 24px;
          text-decoration: none; font-weight: 500; font-size: 0.875rem;
          cursor: pointer;
          color: var(--md-sys-color-on-surface-variant);
          --ripple-color: var(--md-sys-color-on-surface);
          white-space: nowrap;
          overflow: hidden;
      }
      .sidebar.collapsed .sidebar-item {
        justify-content: center;
      }
      .sidebar.collapsed .sidebar-item-text {
        display: none;
      }
      .sidebar-item.active {
          background-color: var(--md-sys-color-secondary-container);
          color: var(--md-sys-color-on-secondary-container);
          --ripple-color: var(--md-sys-color-on-secondary-container);
      }
      .sidebar-item.active .material-symbols-outlined { font-variation-settings: 'FILL' 1; }
      .sidebar-footer {
        padding-top: 1rem;
        margin-top: auto;
        display: flex;
        justify-content: flex-end;
      }
      .sidebar-toggle .material-symbols-outlined {
        transition: transform 0.3s ease;
      }
      .sidebar.collapsed .sidebar-toggle .material-symbols-outlined {
        transform: rotate(180deg);
      }
      
      /* --- 底部导航 (Bottom Navigation - Mobile Only) --- */
      .bottom-nav {
          display: none; position: fixed; bottom: 0; left: 0; right: 0;
          height: 80px; background-color: var(--md-sys-color-surface);
          border-top: 1px solid var(--md-sys-color-outline-variant);
          justify-content: space-around; align-items: center; z-index: 20;
      }
      .bn-item {
          border: none; background: none; padding: 0; margin: 0;
          display: flex; flex-direction: column; align-items: center;
          cursor: pointer; flex-grow: 1; height: 100%; justify-content: center;
          color: var(--md-sys-color-on-surface-variant);
          --ripple-color: var(--md-sys-color-on-surface);
      }
      .bn-icon-container {
          width: 64px; height: 32px; border-radius: 16px;
          display: flex; align-items: center; justify-content: center;
      }
      .bn-label { font-size: 0.75rem; margin-top: 4px; font-weight: 500; }
      .bn-item.active { color: var(--md-sys-color-on-surface); }
      .bn-item.active .bn-icon-container {
          background-color: var(--md-sys-color-secondary-container);
          color: var(--md-sys-color-on-secondary-container);
      }
      .bn-item.active .material-symbols-outlined { font-variation-settings: 'FILL' 1; }
      
      /* ========================================= */
      /* 4. 响应式设计 (Responsive Design)         */
      /* ========================================= */
      @media (max-width: 839px) {
          .sidebar, .chat-settings-panel { display: none; }
          .bottom-nav { display: flex; }
          .main-content { padding-bottom: 80px; }
          .chat-bubble-actions { opacity: 1 !important; pointer-events: auto !important; }
          .effects-grid {
              grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          }
          .effect-card-header {
            flex-direction: column;
            gap: 0.5rem;
          }
          .effect-card-title {
            white-space: normal;
            text-align: center;
          }
          .view-container::-webkit-scrollbar { display: none; }
          .view-container { -ms-overflow-style: none; scrollbar-width: none; }

          .top-app-bar-actions .upload-btn {
            width: 40px;
            padding: 0;
            border-radius: 50%;
          }
          .top-app-bar-actions .upload-btn .upload-btn-label {
            display: none;
          }

          .uploader-actions {
            width: 100%;
          }
          .uploader-actions .btn {
            flex-grow: 1;
          }

          .asset-library-modal {
            width: 100%;
            height: 100%;
            max-width: 100%;
            border-radius: 0;
          }
      }
      @media (min-width: 840px) {
          body { background-color: var(--md-sys-color-surface-variant); }
          .main-content { border-radius: 24px 0 0 24px; }
      }

      /* ========================================= */
      /* 5. UI 组件 (UI Components)                 */
      /* ========================================= */
      
      /* --- 启动加载动画 (Startup Loader) --- */
      #loader {
          position: fixed; inset: 0; z-index: 9999;
          background-color: var(--md-sys-color-surface);
          display: flex; align-items: center; justify-content: center;
          transition: opacity 0.5s ease-out;
      }
      #loader h1 {
          font-family: "'Exo 2', sans-serif", sans-serif;
          font-size: 2rem; font-weight: 700;
          color: var(--md-sys-color-primary);
      }
      
      /* --- 按钮 (Buttons) --- */
      .btn, .icon-btn { cursor: pointer; border: none; background: none; font-family: inherit; }
      .btn {
          border-radius: 20px; padding: 0 24px; height: 40px;
          font-size: 0.875rem; font-weight: 500;
          display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      }
      .icon-btn {
          width: 40px; height: 40px; border-radius: 50%;
          display: inline-flex; align-items: center; justify-content: center;
          color: var(--md-sys-color-on-surface-variant);
          --ripple-color: var(--md-sys-color-on-surface-variant);
      }
      .btn-filled { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); --ripple-color: var(--md-sys-color-on-primary); }
      .btn-tonal { background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); --ripple-color: var(--md-sys-color-on-secondary-container); }
      .btn-text { color: var(--md-sys-color-primary); --ripple-color: var(--md-sys-color-primary); }
      .btn-outlined {
          background-color: transparent;
          border: 1px solid var(--md-sys-color-outline);
          color: var(--md-sys-color-primary);
          padding: 0 23px;
          --ripple-color: var(--md-sys-color-primary);
      }
      .btn:disabled, .icon-btn:disabled {
          cursor: not-allowed;
          background-color: color-mix(in srgb, var(--md-sys-color-on-surface) 12%, transparent);
          color: color-mix(in srgb, var(--md-sys-color-on-surface) 38%, transparent);
          box-shadow: none;
      }
      /* Focus Visible for accessibility */
      .btn:focus-visible,
      .icon-btn:focus-visible,
      .ripple-surface:focus-visible,
      select:focus-visible {
          outline: 3px solid color-mix(in srgb, var(--md-sys-color-primary) 60%, transparent);
          outline-offset: 2px;
      }
      .btn:disabled:focus-visible,
      .icon-btn:disabled:focus-visible {
          outline: none;
      }

      /* --- 滑块 (Slider) --- */
      .md-slider {
          -webkit-appearance: none;
          appearance: none;
          width: 100%;
          height: 4px;
          border-radius: 2px;
          outline: none;
          cursor: pointer;
          --slider-percent: 50%;
          background-image: linear-gradient(to right, var(--md-sys-color-primary), var(--md-sys-color-primary) var(--slider-percent), var(--md-sys-color-surface-variant) var(--slider-percent));
      }
      .md-slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 20px;
          height: 20px;
          background-color: var(--md-sys-color-primary);
          border-radius: 50%;
          border: none;
          cursor: pointer;
          transition: box-shadow 150ms ease-in-out;
      }
      .md-slider::-moz-range-thumb {
          width: 20px;
          height: 20px;
          background-color: var(--md-sys-color-primary);
          border-radius: 50%;
          border: none;
          cursor: pointer;
          transition: box-shadow 150ms ease-in-out;
      }
      .md-slider:hover::-webkit-slider-thumb, .md-slider:focus::-webkit-slider-thumb {
          box-shadow: 0 0 0 8px color-mix(in srgb, var(--md-sys-color-primary) 12%, transparent);
      }
      .md-slider:hover::-moz-range-thumb, .md-slider:focus::-moz-range-thumb {
          box-shadow: 0 0 0 8px color-mix(in srgb, var(--md-sys-color-primary) 12%, transparent);
      }

      /* --- 资产库 (Asset Library) --- */
      .asset-grid {
          padding: 1rem;
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          grid-auto-flow: dense;
          gap: 1rem;
      }
      .asset-card {
          border: 2px solid var(--md-sys-color-outline-variant); border-radius: 16px;
          display: flex; flex-direction: column; overflow: hidden;
          transition: box-shadow 200ms ease, border-color 200ms ease;
      }
      .asset-card:hover { box-shadow: var(--md-elevation-1); border-color: var(--md-sys-color-outline); }
      .asset-card.selected { border-color: var(--md-sys-color-primary); box-shadow: var(--md-elevation-1); }
      .asset-image-container { position: relative; flex-grow: 1; aspect-ratio: 1 / 1; }
      .asset-card-image { width: 100%; height: 100%; object-fit: cover; cursor: zoom-in; display: block; }
      .asset-selection-overlay { position: absolute; inset: 0; background-color: var(--md-sys-color-primary); opacity: 0; transition: opacity 200ms ease; pointer-events: none; }
      .asset-card.selected .asset-selection-overlay { opacity: 0.15; }
      .asset-checkbox-label { position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; cursor: pointer; z-index: 1; }
      .asset-checkbox-input { opacity: 0; width: 0; height: 0; }
      .asset-checkbox-custom { width: 100%; height: 100%; border-radius: 50%; background-color: color-mix(in srgb, var(--md-sys-color-scrim) 40%, transparent); border: 2px solid #fff; display: flex; align-items: center; justify-content: center; }
      .asset-checkbox-custom .check-icon { font-size: 18px; color: var(--md-sys-color-on-primary); opacity: 0; transform: scale(0.5); transition: opacity 200ms ease, transform 200ms ease; }
      .asset-checkbox-input:checked + .asset-checkbox-custom { background-color: var(--md-sys-color-primary); border-color: var(--md-sys-color-primary); }
      .asset-checkbox-input:checked + .asset-checkbox-custom .check-icon { opacity: 1; transform: scale(1); }
      .asset-card-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 8px;
      }
      .asset-card-actions .icon-btn { 
        color: var(--md-sys-color-on-surface-variant); 
        --ripple-color: var(--md-sys-color-on-surface-variant);
        background-color: transparent;
        border: none;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        flex: 0 0 36px;
      }
      .asset-card-actions .icon-btn:hover {
        background-color: color-mix(in srgb, var(--md-sys-color-on-surface-variant) 8%, transparent);
      }
      
      /* --- 上下文顶部应用栏 (Contextual Top App Bar) --- */
      .contextual-app-bar { background-color: var(--md-sys-color-primary-container); }
      .contextual-app-bar .icon-btn { color: var(--md-sys-color-on-primary-container); --ripple-color: var(--md-sys-color-on-primary-container); }
      .multi-select-all-label { display: flex; align-items: center; gap: 16px; cursor: pointer; padding: 0 8px; font-weight: 500; font-size: 1.1rem; color: var(--md-sys-color-on-primary-container); }
      .multi-select-checkbox { width: 18px; height: 18px; accent-color: var(--md-sys-color-primary); }
      
      /* --- 交互式图片预览模态框 (Interactive Image Preview Modal) --- */
      .preview-overlay-interactive {
        position: fixed; inset: 0;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(8px);
        display: flex; align-items: center; justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      }
      .preview-image-interactive {
        position: absolute; top: 0; left: 0; max-width: none;
        transform-origin: 0 0;
        transition: transform 0.2s ease-out;
        will-change: transform;
      }
      .preview-close-btn { position: absolute; top: 1rem; right: 1rem; z-index: 1002; background-color: var(--md-sys-color-surface-variant); color: var(--md-sys-color-on-surface-variant); box-shadow: var(--md-elevation-2); }
      .preview-actions { position: absolute; bottom: 2rem; right: 2rem; z-index: 1002; display: flex; flex-direction: column; gap: 1rem; background-color: var(--md-sys-color-surface-variant); padding: 0.5rem; border-radius: 28px; box-shadow: var(--md-elevation-2); }
      .preview-actions .icon-btn { background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); width: 48px; height: 48px; }

      /* --- 聊天视图样式 (Chat View Styles) --- */
      .chat-view-container { flex: 1; display: flex; flex-direction: column; gap: 1rem; padding: 1rem; }
      .chat-messages-container { 
        flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; 
        scrollbar-width: none; /* For Firefox */
      }
      .chat-messages-container::-webkit-scrollbar {
        display: none; /* For Chrome, Safari, and Opera */
      }
      .chat-message { display: flex; max-width: 80%; gap: 8px; align-items: flex-end; }
      .chat-message.user { align-self: flex-end; flex-direction: row-reverse; }
      .chat-message.model { align-self: flex-start; }
      .chat-bubble { padding: 0.75rem 1rem; border-radius: 20px; line-height: 1.5; display: flex; flex-direction: column; gap: 0.5rem;}
      .chat-message.user .chat-bubble { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); border-bottom-right-radius: 4px; }
      .chat-message.model .chat-bubble { background-color: var(--md-sys-color-surface-variant); color: var(--md-sys-color-on-surface-variant); border-bottom-left-radius: 4px; }
      
      .chat-bubble-image-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-self: center;
        margin-top: 0.5rem;
      }
      .chat-bubble .chat-image-wrapper { 
        flex: 1 1 150px;
        max-width: calc(50% - 0.25rem);
        min-width: 120px;
        border-radius: 12px; 
        overflow: hidden; 
        background-color: var(--md-sys-color-surface); 
      }
      .chat-bubble-image-gallery .chat-image-wrapper {
        align-self: auto;
      }
      .chat-bubble .chat-image-wrapper img { display: block; width: 100%; height: 100%; object-fit: contain; cursor: zoom-in; }

      .chat-bubble-actions { display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s ease; pointer-events: none; margin-bottom: 4px; }
      .chat-message:hover .chat-bubble-actions { opacity: 1; pointer-events: auto; }
      .chat-bubble-actions .icon-btn { width: 32px; height: 32px; background-color: var(--md-sys-color-surface-variant); box-shadow: var(--md-elevation-1); color: var(--md-sys-color-on-surface-variant); --ripple-color: var(--md-sys-color-on-surface-variant); }
      .chat-input-container { padding-top: 1rem; border-top: 1px solid var(--md-sys-color-outline-variant); }
      .chat-input-area { display: flex; gap: 1rem; align-items: flex-start; }
      .chat-input-textarea { 
          flex: 1; 
          resize: none; 
          border-radius: 24px; 
          border: 1px solid var(--md-sys-color-outline); 
          padding: 14px 20px; 
          font-family: inherit; 
          font-size: 1rem; 
          background-color: var(--md-sys-color-surface-variant); 
          color: var(--md-sys-color-on-surface-variant); 
          scrollbar-width: none; /* For Firefox */
          line-height: 1.5;
          max-height: 150px; /* Limit max height */
      }
      .chat-input-textarea::-webkit-scrollbar {
          display: none; /* For Chrome, Safari, and Opera */
      }
      .chat-input-area .icon-btn { width: 48px; height: 48px; flex-shrink: 0; }
      .chat-input-attachment-grid { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 0.75rem; }
      .chat-input-image-preview { position: relative; width: 80px; height: 80px; border-radius: 8px; overflow: hidden; border: 1px solid var(--md-sys-color-outline-variant); }
      .chat-input-image-preview img { width: 100%; height: 100%; object-fit: cover; }
      .chat-input-image-preview .remove-img-btn { position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background-color: color-mix(in srgb, var(--md-sys-color-scrim) 50%, transparent); color: var(--md-sys-color-inverse-on-surface); --ripple-color: var(--md-sys-color-inverse-on-surface); }
      
      .pseudo-progress-bar {
        width: 120px;
        height: 10px;
        background-color: var(--md-sys-color-surface);
        border-radius: 5px;
        overflow: hidden;
        border: 1px solid var(--md-sys-color-outline-variant);
      }
      .pseudo-progress-bar-inner {
        height: 100%;
        background-color: var(--md-sys-color-primary);
        border-radius: 5px;
        transition: width 0.2s ease-out;
      }
      
      /* --- Material You 开关 (Switch) --- */
      .md-switch { display: inline-flex; align-items: center; gap: 0.75rem; cursor: pointer; -webkit-tap-highlight-color: transparent; }
      .switch { position: relative; display: inline-block; width: 52px; height: 32px; }
      .switch input { opacity: 0; width: 0; height: 0; }
      .slider { position: absolute; cursor: pointer; inset: 0; background-color: var(--md-sys-color-surface-variant); border: 2px solid var(--md-sys-color-outline); border-radius: 32px; transition: .3s;}
      .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 6px; bottom: 6px; background-color: var(--md-sys-color-outline); border-radius: 50%; transition: .3s; }
      .switch input:checked + .slider { background-color: var(--md-sys-color-primary); border-color: var(--md-sys-color-primary); }
      .switch input:checked + .slider:before { transform: translateX(20px); background-color: var(--md-sys-color-on-primary); width: 24px; height: 24px; left: 2px; bottom: 2px; }

      /* --- 模态框 & 面板 (Modals & Panels) --- */
      .modal-overlay { position: fixed; inset: 0; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; }
      .modal-content { background-color: var(--md-sys-color-surface); border-radius: 24px; padding: 1.5rem; max-width: 400px; width: calc(100% - 2rem); box-shadow: var(--md-elevation-2); }
      
      .asset-library-modal {
        max-width: 80vw;
        width: 900px;
        height: 80vh;
        display: flex;
        flex-direction: column;
        padding: 0;
      }
      .asset-library-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
        padding: 1.5rem 1.5rem 1rem;
        border-bottom: 1px solid var(--md-sys-color-outline-variant);
      }
      .asset-library-modal-body {
        flex-grow: 1;
        overflow-y: auto;
      }
      .asset-library-modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        flex-shrink: 0;
        padding: 1rem 1.5rem 1.5rem;
        border-top: 1px solid var(--md-sys-color-outline-variant);
      }
      
      .chat-settings-panel {
        width: 320px;
        flex-shrink: 0;
        height: 100%;
        background-color: var(--md-sys-color-surface-variant);
        border-left: 1px solid var(--md-sys-color-outline-variant);
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease, padding 0.3s ease;
      }
      .chat-settings-panel.hidden {
        width: 0;
        padding: 0;
        overflow: hidden;
      }
      .settings-panel-header {
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1rem;
        border-bottom: 1px solid var(--md-sys-color-outline-variant);
        flex-shrink: 0;
      }
      .settings-panel-content {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        overflow-y: auto;
      }
      .settings-group { display: flex; flex-direction: column; gap: 0.75rem; }

      /* 结果页浮动操作按钮 (Result Floating Action Buttons) */
      .result-actions-container {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 30;
        background-color: var(--md-sys-color-secondary-container);
        border-radius: 99px;
        padding: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: var(--md-elevation-2);
      }
      .result-actions-container .btn {
          border-radius: 99px;
      }
      @media (max-width: 839px) {
        .result-actions-container {
          flex-direction: column;
          right: 1rem;
          bottom: calc(80px + 1rem);
          border-radius: 28px;
          gap: 0.75rem;
          padding: 0.75rem 0.5rem;
        }
        .result-actions-container .btn {
          width: 48px;
          height: 48px;
          border-radius: 50%;
          padding: 0;
          gap: 0;
        }
        .result-actions-container .btn-label {
          display: none;
        }
      }

      /* --- 兼容性样式 (Compatibility Styles) --- */
       .textarea {
        width: 100%; padding: 1rem; background-color: var(--md-sys-color-surface-variant);
        border: 1px solid var(--md-sys-color-outline); border-radius: 8px; font-family: inherit;
        color: var(--md-sys-color-on-surface-variant); resize: vertical; min-height: 80px;
      }
      .search-container { position: relative; width: 100%; max-width: 500px; margin: 0 auto 2rem; }
      .search-input { width: 100%; height: 56px; border-radius: 28px; border: 1px solid var(--md-sys-color-outline); padding: 0 60px 0 20px; font-size: 1rem; background-color: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface); }
      .search-container .icon-btn { position: absolute; right: 8px; top: 8px; }
      .category-details { border-radius: 12px; border: 1px solid var(--md-sys-color-outline-variant); margin-bottom: 1rem; background-color: var(--md-sys-color-surface); overflow: hidden; }
      .category-summary { display: flex; align-items: center; gap: 1rem; padding: 1rem; cursor: pointer; font-size: 1.25rem; font-weight: 500; color: var(--md-sys-color-on-surface); list-style: none; }
      .category-summary::-webkit-details-marker { display: none; }
      .category-summary .icon { margin-left: auto; transition: transform 0.2s ease-in-out; }
      .category-details[open] > .category-summary .icon { transform: rotate(180deg); }
      .category-content { padding: 0 1rem 1rem 1rem; }
      .main-container { max-width: 1280px; margin: 0 auto; padding: 1rem 2rem; }
      @media (max-width: 768px) { .main-container { padding: 1rem; } }
      .card { background-color: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface); border-radius: 12px; padding: 1rem; border: 1px solid var(--md-sys-color-outline-variant); }
      
      /* 效果卡片样式更新 (Transformation Card Style Updates) */
      .effects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        grid-auto-rows: 1fr;
      }
      .effect-card {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        text-align: left;
        padding: 1rem;
        height: 100%;
        cursor: pointer;
      }
      .effect-card:hover {
        box-shadow: var(--md-elevation-1);
        border-color: var(--md-sys-color-outline);
      }
      .effect-card-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
      }
      .effect-card-icon-wrapper {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--md-sys-color-primary-container);
        flex-shrink: 0;
      }
      .effect-card-icon {
        font-size: 2rem;
        color: var(--md-sys-color-on-primary-container);
      }
      .effect-card-title {
        background-color: var(--md-sys-color-secondary-container);
        color: var(--md-sys-color-on-secondary-container);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        min-width: 0;
      }
      .effect-card-description-wrapper {
        background-color: var(--md-sys-color-surface-variant);
        border-radius: 12px;
        padding: 0.75rem;
        flex-grow: 1;
        display: flex;
        align-items: center;
      }
      .effect-card-description-text {
        font-size: 0.75rem;
        color: var(--md-sys-color-on-surface-variant);
        margin: 0;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      /* 增强器详情视图头部 (Enhancer Detail View Header) */
      .enhancer-header {
        display: flex;
        flex-direction: row; /* Aligned to a row */
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        text-align: left; /* Text aligned to the left */
        background-color: var(--md-sys-color-surface-variant); /* Combined into a single card */
        border-radius: 16px;
        padding: 1rem;
      }
      .enhancer-header-icon-wrapper {
        width: 48px; /* Reduced size */
        height: 48px; /* Reduced size */
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--md-sys-color-primary-container);
        flex-shrink: 0;
      }
      .enhancer-header-icon {
        font-size: 24px; /* Reduced size */
        color: var(--md-sys-color-on-primary-container);
      }
      .enhancer-header-text-wrapper {
        /* Styling moved to the parent .enhancer-header element */
        padding: 0;
        background-color: transparent;
        width: auto;
        border-radius: 0;
      }
      .enhancer-header-title {
        font-size: 1.1rem; /* Reduced size */
        font-weight: 700;
        color: var(--md-sys-color-on-surface);
        margin-bottom: 0.25rem;
      }
      .enhancer-header-description {
        color: var(--md-sys-color-on-surface-variant);
        font-size: 0.875rem;
        line-height: 1.4;
      }
      
      /* --- 动画关键帧 (Animation Keyframes) --- */
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
      @keyframes contentSlideIn { from { transform: translateY(20px) scale(0.98); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
      @keyframes contentSlideOut { from { transform: translateY(0) scale(1); opacity: 1; } to { transform: translateY(20px) scale(0.98); opacity: 0; } }
      @keyframes menuSlideIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
      @keyframes menuSlideOut { from { opacity: 1; transform: scale(1) translateY(0); } to { opacity: 0; transform: scale(0.95) translateY(10px); } }
      @keyframes toast-in { from { opacity: 0; transform: translate(-50%, -20px); } to { opacity: 1; transform: translate(-50%, 0); } }
      @keyframes toast-out { from { opacity: 1; transform: translate(-50%, 0); } to { opacity: 0; transform: translate(-50%, -20px); } }

      /* --- 动画类 (Animation Classes) --- */
      .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
      .modal-overlay.animating-in { animation: fadeIn 0.3s ease-out forwards; }
      .modal-overlay.animating-in .modal-content { animation: contentSlideIn 0.3s ease-out forwards; }
      .modal-overlay.animating-out { animation: fadeOut 0.2s ease-in forwards; pointer-events: none; }
      .modal-overlay.animating-out .modal-content { animation: contentSlideOut 0.2s ease-in forwards; }
      
      .chat-attach-menu {
        position: absolute;
        bottom: 110%;
        left: 0;
        width: 220px;
        background-color: var(--md-sys-color-surface-variant);
        border-radius: 12px;
        box-shadow: var(--md-elevation-2);
        z-index: 10;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        padding: 0.5rem;
        transform-origin: bottom left;
      }
      .chat-attach-menu.animating-in { animation: menuSlideIn 0.2s ease-out forwards; }
      .chat-attach-menu.animating-out { animation: menuSlideOut 0.15s ease-in forwards; }

      .library-drop-overlay {
        position: absolute;
        inset: 1rem;
        background-color: color-mix(in srgb, var(--md-sys-color-primary) 15%, transparent);
        border: 2px dashed var(--md-sys-color-primary);
        z-index: 50;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--md-sys-color-primary);
        pointer-events: none;
        text-align: center;
        border-radius: 12px;
      }
      .library-drop-overlay .material-symbols-outlined {
        font-size: 4rem;
      }
      .library-drop-overlay p {
        font-size: 1.25rem;
        font-weight: 500;
        margin-top: 0.5rem;
      }
      
      /* --- 提示消息 (Toast Notification) --- */
      .toast-container {
          position: fixed;
          top: 2rem;
          left: 50%;
          transform: translateX(-50%);
          z-index: 2000;
          pointer-events: none;
          display: flex;
          justify-content: center;
      }
      .toast-message {
          background-color: var(--md-sys-color-inverse-surface);
          color: var(--md-sys-color-inverse-on-surface);
          padding: 0.75rem 1.5rem;
          border-radius: 20px;
          box-shadow: var(--md-elevation-2);
          font-weight: 500;
          pointer-events: auto;
      }
      .toast-container.animating-in { animation: toast-in 0.3s ease-out forwards; }
      .toast-container.animating-out { animation: toast-out 0.3s ease-in forwards; }