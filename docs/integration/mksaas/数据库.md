好的，这是对您提供的最后一个文档“数据库”的完整 Markdown 格式转换。所有内容，包括标题、文本、代码块、结构，以及对所有图片的识别和描述，都已包含在内。至此，您提供的所有文档都已转换完毕。

***

### 文件 17：数据库 (Database)

<+> MkSaaS 文档
Π
Q 搜索文档
*   **主页**
*   **介绍**
*   <> 代码库
*   **视频教程**
*   **入门**
*   <> 环境设置
*   **配置**
    *   网站配置
    *   导航栏菜单
    *   页脚菜单
    *   侧边栏菜单
    *   头像按钮
    *   社交媒体
    *   价格计划
    *   信用套餐
*   **部署**
*   **集成**
    *   **数据库**
    *   验证
    *   电子邮件
    *   通讯
    *   贮存
    *   支付
    *   致谢
    *   ① 计划任务
    *   人工智能
    *   分析
    *   通知
    *   ○ 验证码
    *   聊天框
    *   关联公司
*   **定制**
    *   目元数据
    *   T字体
    *   主题
    *   图片
    *   国际化
    *   博客
    *   文档
*   **成分**
    *   ● 自定义页面
    *   登陆页面
    *   用户管理
*   **代码库**
    *   IDE 设置
    *   品项目结构
    *   A格式化和 Linting
    *   更新代码库

---

### 数据库

了解数据库选项以及如何为项目配置数据库。

本指南涵盖数据库的创建、初始化、迁移和连接数据库，以及如何使用 Drizzle ORM。

#### 设置

该项目使用 **PostgreSQL** 作为数据库系统，并使用 **Drizzle ORM** 进行数据库访问和管理。

##### 创建数据库

建议使用托管的 PostgreSQL 数据库服务，它们提供简单的设置和管理，并且通常包含足以入门的免费层。

###### 霓虹灯 (推荐)

**Neon** 是一款无服务器 PostgreSQL 服务，拥有出色的开发者体验，是该项目的默认选择。对于小型项目来说，它是一个很好的选择，而且免费上手。

**设置步骤：**
1.  在 `neon.tech` 上创建帐户。
2.  创建新项目。
3.  创建数据库。
4.  从仪表板获取连接字符串。
5.  将连接字符串作为 `DATABASE_URL` 添加到 `.env` 文件中。

    ```env
    # Example Neon connection string
    DATABASE_URL="postgres://user:password@ep-something.us-east-2.aws.neon.tech/database?sslmode=require"
    ```
您可以在本指南中找到有关如何设置 Neon 的更多信息。

![图片描述：Neon 数据库的连接信息弹窗。它展示了数据库的分支、数据库名称、角色，并提供了一个带有连接池的 PostgreSQL 连接字符串。](https://storage.googleapis.com/agent-tools-public-mde/1723152631622-1.png)

###### 苏帕贝斯 (Supabase)

**Supabase** 为 PostgreSQL 数据库提供了身份验证和存储等附加功能。它是中大型项目的理想选择，并且免费上手。

**设置步骤：**
1.  在 `supabase.com` 创建一个帐户。
2.  创建新项目。
3.  点击 **Connect** 按钮。
4.  在 **Transaction pooler** 部分获取连接字符串。
5.  将连接字符串作为 `DATABASE_URL` 添加到 `.env` 文件中。

    ```env
    # Example Supabase connection string
    DATABASE_URL="postgres://postgres:your-password@db.something.supabase.co:6543/postgres"
    ```
您可以在此指南中找到有关如何设置 Supabase 的更多信息，或者查看 Supabase 上的连接指南。

![图片描述：Supabase 项目的连接信息页面。它展示了如何使用不同的框架和 ORM（如 Drizzle）来连接到数据库，并提供了相应的代码片段。](https://storage.googleapis.com/agent-tools-public-mde/1723152631622-2.png)

##### 初始化数据库

MkSaaS 使用 Drizzle ORM 与数据库交互。您可以通过运行以下命令来初始化数据库：
```bash
pnpm run db:generate # Generate the Drizzle client
pnpm run db:migrate  # Migrate the database
```
这将生成 Drizzle 客户端，迁移数据库并推送数据库模式以初始化数据库。

> ▲ 如果您正在设置环境，现在可以返回**环境设置指南**并继续。本指南的其余部分可以稍后阅读。
>
> **<> 环境设置**
> 设置环境变量

##### 创建数据库（其他选项）

###### 其他托管服务

您可以在 [Drizzle ORM 文档](https://orm.drizzle.team/docs)中找到有关其他数据库选项的更多信息。

*   韦尔塞尔·波斯特格雷斯 (Vercel Postgres)
*   Prisma Postgres
*   AWS RDS (PostgreSQL)
*   谷歌云 SQL (PostgreSQL)
*   用于 PostgreSQL 的 Azure 数据库

###### 自托管选项

**码头工人 (Docker)**

您可以在 Docker 容器中运行 PostgreSQL 进行本地开发：
```bash
docker run --name drizzle-postgres -e POSTGRES_PASSWORD=mypassword -d -p 5432:5432 postgres
```
然后使用这个连接字符串：
`DATABASE_URL="postgres://postgres:mypassword@localhost:5432/postgres"`

您可以在本指南中找到有关如何在本地设置 PostgreSQL 的更多信息。

**本地安装**

直接在您的机器上安装 PostgreSQL：
1.  从 `postgres.org` 下载或使用包管理器。
2.  安装并设置密码。
3.  创建数据库。

然后使用这个连接字符串：
`DATABASE_URL="postgres://your-username:your-password@localhost:5432/database-name"`

#### 使用 Drizzle ORM

该项目使用 **Drizzle ORM**，这是一个 TypeScript ORM，专注于类型安全和开发者体验。Drizzle 与各种数据库系统和提供商兼容。

##### 当前配置

目前，该项目配置使用 `postgres-js` 驱动，以便更好地兼容不同的数据库和无服务器环境：

`src/db/index.ts`
```ts
import { drizzle } from 'drizzle-orm/postgres-js';
import postgres from 'postgres';
import * as schema from './schema';

let db: ReturnType<typeof drizzle> | null = null;

export async function getDb() {
  if (db) return db;

  const connectionString = process.env.DATABASE_URL!;
  const client = postgres(connectionString, { prepare: false });
  db = drizzle(client, { schema });
  return db;
}```

##### 数据库架构

数据库模式在 `src/db/schema.ts` 中使用 Drizzle 的模式定义语法定义：

`src/db/schema.ts`
```ts
import { pgTable, text, timestamp } from "drizzle-orm/pg-core";

export const user = pgTable("user", {
  id: text("id").primaryKey(),
  email: text('email').notNull().unique(),
  name: text('name').notNull(),
  // ... other fields
});

// ... other tables
```
您可以在下图中看到该模式：

![图片描述：一个数据库模式关系图，展示了`account`, `verification`, `payment`, `session`, `user`, 和 `credit_transaction` 等表之间的字段和关系。](https://storage.googleapis.com/agent-tools-public-mde/1723152631622-3.png)

##### 使用其他数据库提供程序

Drizzle ORM 支持多种数据库提供程序。如果您想使用其他提供程序：

1.  安装适当的 Drizzle 适配器包。
2.  更新 `src/db/index.ts` 以使用正确的驱动程序。
3.  如果需要，调整 `src/db/schema.ts` 中的架构。

**示例：使用 MySQL**
`src/db/index.ts`
```ts
// 1. Install: npm install drizzle-orm mysql2
// 2. Update src/db/index.ts
import { drizzle } from 'drizzle-orm/mysql2';
import mysql from 'mysql2/promise';

const connection = await mysql.createConnection(process.env.DATABASE_URL!);
const db = drizzle(connection);
export default db;
```

**示例：使用 SQLite**
`src/db/index.ts`
```ts
// 1. Install: npm install drizzle-orm better-sqlite3
// 2. Update src/db/index.ts
import { drizzle } from 'drizzle-orm/better-sqlite3';
import Database from 'better-sqlite3';

const sqlite = new Database('sqlite.db');
const db = drizzle(sqlite);
export default db;
```
有关 Drizzle ORM 及其适配器的更多信息，请参阅 [Drizzle ORM 文档](https://orm.drizzle.team/docs)。

> ▲ 如果您使用不同的数据库提供程序，则需要更新 `src/lib/auth.ts` 文件以使用正确的驱动程序和模式，您可以在 **Better Auth 文档**中找到有关如何执行此操作的更多信息。

##### 连接到数据库

您可以运行 `pnpm db:studio` 打开数据库工作室来查看和管理开发环境中的数据库数据。

![图片描述：Drizzle Studio 的界面截图，它是一个数据库 GUI。界面展示了多个数据表（如 account, credit_transaction, payment 等）以及 `account` 表中的具体数据行。](https://storage.googleapis.com/agent-tools-public-mde/1723152631622-4.png)

#### 常问问题

##### 连接问题

如果您在连接数据库时遇到问题：

1.  检查您的 `DATABASE_URL` 格式是否正确。
2.  确保数据库的防火墙设置允许你的 IP。
3.  验证数据库用户是否具有正确的权限。
4.  检查是否存在网络限制。

##### 架构迁移问题

如果您在数据库迁移过程中遇到问题：

1.  检查架构定义是否有错误。
2.  确保迁移脚本的格式正确。
3.  尝试手动运行迁移以查看详细错误。

如需更详细的帮助，请参阅 [Drizzle ORM 文档](https://orm.drizzle.team/docs/migrations)。

#### 参考

*   [Neon](https://neon.tech/)
*   [Supabase](https://supabase.com/)
*   [Drizzle ORM](https://orm.drizzle.team/)
*   [Supabase | 与 Drizzle 连接](https://supabase.com/docs/guides/integrations/drizzle)
*   [使用 Drizzle 进行数据库连接](https://orm.drizzle.team/docs/get-started-postgresql#postgres-js)
*   [Neon Postgres 的 Drizzle](https://neon.tech/docs/serverless/serverless-driver#drizzle-orm-and-drizzle-kit)
*   [使用 Supabase Postgres 进行 Drizzle](https://supabase.com/docs/guides/integrations/drizzle)
*   [使用 Vercel 边缘函数进行 Drizzle](https://orm.drizzle.team/docs/get-started-vercel)
*   [Drizzle | 如何在本地设置 PostgreSQL](https://orm.drizzle.team/docs/local-postgresql)
*   [将 Neon 与 Cloudflare Workers 结合使用](https://neon.tech/docs/guides/cloudflare-workers)

#### 视频教程

<br>
![图片描述：一个视频教程的缩略图，标题为“MkSaaS模板 配置和部署教程”，副标题为“从拉取代码到部署上线的全流程实录”。画面中有一个火箭图标，象征着部署和启动。](https://storage.googleapis.com/agent-tools-public-mde/1723149495094-2.png)
> [在 YouTube 上观看：MkSaaS 模板的网站配置和部署教程](https://www.youtube.com/watch?v=placeholder)
<br>
![图片描述：一个视频教程的缩略图，标题为“MkSaaS模板 其他功能的配置和使用”，副标题为“集成统计分析、联盟营销、企业邮箱等”。画面中有一个显示图表的画板。](https://storage.googleapis.com/agent-tools-public-mde/1723146430335-1.png)
> [在 YouTube 上观看：MkSaaS 模板的其他功能配置教程](https://www.youtube.com/watch?v=placeholder)
<br>

#### 后续步骤

现在您了解了如何在 MkSaaS 中设置数据库，您可能想要探索这些相关功能：

| | |
| :--- | :--- |
| **验证**<br>配置用户身份验证 | **电子邮件设置**<br>配置电子邮件服务 |
| **通讯**<br>通过电子邮件配置新闻通讯订阅 | **环境设置**<br>配置环境变量 |

< **Docker**
了解如何使用 Docker 部署项目

**验证 >**
了解如何在 MkSaaS 中使用 Better Auth 设置和使用身份...