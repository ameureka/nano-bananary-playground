好的，这是对您提供的最后一个文档“验证”的完整 Markdown 格式转换。所有内容，包括标题、文本、代码块、结构，以及对所有图片的识别和描述，都已包含在内。至此，您提供的所有文档都已转换完毕。

***

### 文件 43：验证 (Authentication)

<+> MkSaaS 文档
Π
Q 搜索文档
*   **主页**
*   **介绍**
*   <> 代码库
*   **视频教程**
*   **入门**
*   <> 环境设置
*   **配置**
*   **部署**
*   **集成**
    *   数据库
    *   **验证**
    *   电子邮件
    *   通讯
    *   贮存
    *   支付
    *   致谢
    *   ① 计划任务
    *   人工智能
    *   分析
    *   通知
    *   ○ 验证码
    *   聊天框
    *   关联公司
*   **定制**
    *   目元数据
    *   T字体
    *   主题
    *   图片
    *   国际化
    *   博客
    *   文档
*   **成分**
    *   ● 自定义页面
    *   登陆页面
    *   用户管理
*   **代码库**
    *   IDE 设置
    *   品项目结构
    *   A格式化和 Linting
    *   更新代码库

---

### 验证

了解如何在 MkSaaS 中使用 Better Auth 设置和使用身份验证。

MkSaaS 使用 **Better Auth** 进行身份验证，提供具有多种身份验证方法、会话管理和基于角色的访问控制的灵活安全的系统。

#### 设置

请按照以下步骤配置必要的环境变量：

##### 1. 生成更好的身份验证密钥

`BETTER_AUTH_SECRET` 是用于加密和生成哈希值的随机字符串。您可以使用 OpenSSL 命令生成密钥：
```bash
openssl rand -base64 32
```
生成密钥后，将其添加到您的 `.env` 文件中：
`BETTER_AUTH_SECRET="your_generated_secret_key"`

##### 2. 配置 GitHub OAuth

要启用 GitHub 身份验证，您需要注册您的应用程序：

1.  前往 **GitHub 开发者设置**。
2.  点击“**OAuth 应用程序**”，然后点击“**新建 OAuth 应用程序**”。
3.  填写注册表：
    *   **应用程序名称**：您的应用程序名称（例如 “MkSaaS”）。
    *   **主页 URL**：您的网站 URL（例如，`https://your-domain.com` 或 `http://localhost:3000` 用于本地开发）。
    *   **应用程序描述**：您的应用程序的简要描述。
    *   **授权回调 URL**：将其设置为 `https://your-domain.com/api/auth/callback/github`（或本地开发设置为 `http://localhost:3000/api/auth/callback/github`）。
4.  点击“**注册应用程序**”。
5.  注册后，您将看到您的客户 ID。
6.  单击“**生成新的客户端密钥**”来创建您的客户端密钥。
7.  复制这两个值并将它们添加到您的 `.env` 文件中：
    ```
    GITHUB_CLIENT_ID="your_github_client_id"
    GITHUB_CLIENT_SECRET="your_github_client_secret"
    ```
8.  确保 `website.tsx` 文件 `auth.enableGithubLogin` 设置为 `true`。
    `src/config/website.tsx`
    ```tsx
    auth: {
      enableGithubLogin: true,
    }
    ```
    > ● 在 GitHub 中创建两个不同的 OAuth 应用程序：一个用于生产环境，一个用于开发环境。切勿在两个环境中使用相同的 OAuth 应用程序，因为它们需要不同的回调 URL。

##### 3. 配置 Google OAuth

要启用 Google 身份验证，请按照以下步骤获取客户端凭据：

1.  前往 **Google Cloud Console**。
2.  创建新项目或选择现有项目。
3.  前往左侧边栏中的 **Credentials**。
4.  单击 **Create Credentials** 并选择 **OAuth client ID**。
5.  如果这是您第一次，您可能需要配置 OAuth 同意屏幕：
    *   **用户类型**：选择“**外部**”。
    *   填写所需信息（网站名称、用户支持电子邮件、开发人员联系方式）。
    *   添加授权域名，包括您的网站域名。
    *   单击 **Save and Continue** 完成每个部分。
6.  返回“凭据”并创建 OAuth Client ID：
    *   **应用程序类型**：`Web` 应用程序。
    *   **名称**：您的网站名称。
    *   **授权 JavaScript 来源**：添加您的域名（例如 `https://your-domain.com` 或 `http://localhost:3000`）。
    *   **授权重定向 URI**：添加 `https://your-domain.com/api/auth/callback/google`（或 `http://localhost:3000/api/auth/callback/google` 用于本地开发）。
7.  点击 **Create**，复制提供的客户端 ID 和客户端密钥，并添加到 `.env` 文件中：
    ```
    GOOGLE_CLIENT_ID="your_google_client_id"
    GOOGLE_CLIENT_SECRET="your_google_client_secret"
    ```
8.  确保 `website.tsx` 文件 `auth.enableGoogleLogin` 设置为 `true`。
    `src/config/website.tsx`
    ```tsx
    auth: {
      enableGoogleLogin: true,
    }
    ```
    > ● 在 Google Cloud Console 中创建两个不同的 OAuth 应用：一个用于生产环境，一个用于开发环境。切勿在两个环境中使用相同的 OAuth 应用，因为它们需要不同的回调网址。

##### 4. 配置凭证登录

要启用凭证登录，请按照以下步骤获取客户端凭据：

1.  按照**邮件配置**文档的要求配置邮件服务。
2.  更新 `website.tsx` 文件，将 `enableCredentialLogin` 设置为 `true`，并设置电子邮件提供商和默认发件人电子邮件地址，例如：
    `src/config/website.tsx`
    ```tsx
    export const websiteConfig = {
      // ...other config
      auth: {
        enableCredentialLogin: true,
      },
      mail: {
        provider: 'resend', // Email provider to use
        fromEmail: 'support@example.com', // Default sender email address
      },
      // ...other config
    }
    ```
> ▲ 如果您正在设置环境，现在可以返回**环境设置指南**并继续。本指南的其余部分可以稍后阅读。
>
> **<> 环境设置**
> 设置环境变量

#### 认证系统结构

MkSaaS 中的身份验证系统设计有以下组件：

*   **源码 (src)**
    *   `库 (lib)`
        *   `授权.ts`
        *   `授权类型.ts`
        *   `身份验证客户端.ts`
    *   `成分 (components)`
    *   `应用程序 (app)`

#### 核心功能

*   通过电子邮件验证进行电子邮件和密码身份验证
*   社交登录，默认支持 Google、GitHub 登录，您可以扩展更多社交提供商，如 Twitter、Apple、Facebook 等。
*   不同身份验证方法之间的帐户链接，例如将 GitHub 帐户链接到电子邮件帐户
*   用户和角色管理，包括管理功能，例如禁止用户
*   注册时自动订阅新闻通讯（可配置）

#### 客户端使用

##### 访问会话数据

在客户端组件中，您可以使用 `useSession` 钩子访问用户的会话数据：
```tsx
'use client';

import { useSession } from '@/lib/auth-client';

export function ProfileButton() {
  const { data: session, isPending } = useSession();

  if (isPending) {
    // Loading state
  }

  if (session) {
    return (
      <div>
        <p>Welcome, {session.user.name}!</p>
        <button onClick={() => signOut()}>Sign out</button>
      </div>
    );
  }

  return (
    <button onClick={() => signIn.social({ provider: 'google' })}>
      Sign in
    </button>
  );
}
```

##### 身份验证操作

`auth` 客户端提供了常见的身份验证操作的方法：
```ts
import { signIn, signOut } from '@/lib/auth-client';

// Sign in with email and password
signIn.emailAndPassword({
  email: 'user@example.com',
  password: 'password123',
});

// Sign in with social provider
signIn.social({
  provider: 'google',
});

// Sign out
signOut();
```

#### 服务器端使用

##### 服务器端路由保护

在服务器组件中，您可以通过检查会话来保护路由：
```ts
import { auth } from '@/lib/auth';
import { redirect } from 'next/navigation';
import { headers } from 'next/headers';

export default async function ProtectedPage() {
  const session = await auth.api.getSession({ headers: await headers() });

  if (!session?.user) {
    redirect('/auth/login');
  }

  return <div>Protected content</div>;
}```

##### 管理路由保护

对于仅限管理员的路线，您可以在会话中检查用户角色：
```ts
import { auth } from '@/lib/auth';
import { redirect } from 'next/navigation';
import { headers } from 'next/headers';

export default async function AdminPage() {
  const session = await auth.api.getSession({ headers: await headers() });

  if (!session?.user || session.user.role !== 'admin') {
    redirect('/auth/login');
  }

  return <div>Admin content</div>;
}```

#### 最佳实践

1.  **要求电子邮件验证**：始终要求新用户进行电子邮件验证。
2.  **提供多种身份验证方法**：提供电子邮件/密码和社交登录。
3.  **使用安全会话设置**：配置适当的会话超时和 cookie 安全性。
4.  **保护敏感路线**：在客户端和服务器上实施适当的授权检查。
5.  **考虑不同的用户角色**：实施适当的基于角色的访问控制。

#### 视频教程

<br>
![图片描述：一个视频教程的缩略图，标题为“MkSaaS模板 配置和部署教程”，副标题为“从拉取代码到部署上线的全流程实录”。画面中有一个火箭图标，象征着部署和启动。](https://storage.googleapis.com/agent-tools-public-mde/1723149495094-2.png)
> [在 YouTube 上观看：MkSaaS 模板的网站配置和部署教程](https://www.youtube.com/watch?v=placeholder)
<br>

#### 后续步骤

现在您已经了解了身份验证在 MkSaaS 中的工作原理，请探索以下相关集成：

| | |
| :--- | :--- |
| **电子邮件**<br>配置电子邮件服务 | **通讯**<br>配置新闻稿 |
| **数据库**<br>配置数据库 | **环境设置**<br>配置环境变量 |

< **数据库**
了解数据库选项以及如何为项目配置数据库

**电子邮件 >**
了解如何通过“重新发送”和“反应电子邮件”模板设置和使...