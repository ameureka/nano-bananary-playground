好的，这是对您提供的最后一个文档“计划任务”的完整 Markdown 格式转换。所有内容，包括标题、文本、代码块、结构，以及对所有图片的识别和描述，都已包含在内。至此，您提供的所有文档都已转换完毕。

***

### 文件 30：计划任务 (Cron Jobs)

<+> MkSaaS 文档
Π
Q 搜索文档
*   **主页**
*   **介绍**
*   <> 代码库
*   **视频教程**
*   **入门**
*   <> 环境设置
*   **配置**
*   **部署**
*   **集成**
    *   数据库
    *   验证
    *   电子邮件
    *   通讯
    *   贮存
    *   支付
    *   致谢
    *   **① 计划任务**
    *   人工智能
    *   分析
    *   通知
    *   ○ 验证码
    *   聊天框
    *   关联公司
*   **定制**
    *   目元数据
    *   T字体
    *   主题
    *   图片
    *   国际化
    *   博客
    *   文档
*   **成分**
    *   ● 自定义页面
    *   登陆页面
    *   用户管理
*   **代码库**
    *   IDE 设置
    *   品项目结构
    *   A格式化和 Linting
    *   更新代码库

---

### 计划任务

了解如何在 MkSaaS 中设置和使用 Cron Jobs。

MkSaaS 支持集成 **Cron Jobs**（一个免费的开源 cron 作业调度程序）用于计划任务，允许您自动执行网站的任务，例如向用户分配信用。

> ▲ 如果您启用积分系统，则必须设置 cron 作业来向用户分配积分并处理积分到期。
>
> **致谢**
> 了解有关积分的更多信息

#### 设置

1.  在 [Cron Job](https://cron-job.org/) 中创建一个新帐户。
2.  转到 **Cron Job Dashboard > Cronjobs**，单击 **CREATE CRONJOB**。
3.  在 **Cron Job Common** 部分设置 **Title** 和 **URL**，并设置 **Execution schedule** 为每天运行，时间任意，例如 `00:00`。URL 格式为 `https://{your-domain}/api/distribute-credits`。

    ![图片描述：cron-job.org 网站创建 cron job 的界面。用户正在配置一个名为 “mksaas-demo-distribute-credits” 的任务，设置了执行 URL 和每天 00:00 运行的调度计划。](https://storage.googleapis.com/agent-tools-public-mde/1723154823293-1.png)
4.  在 **Cron Job Advance** 部分设置 **Username** 和 **Password**，并将 **Timeout** 设置为 `30` 秒。

    > ▲ 该用户名和密码并非 Cronjob 网站的账号密码，而是 cron job 访问网站 API 的基本认证凭证，请妥善保管。

    ![图片描述：cron-job.org 网站创建 cron job 的高级设置界面。用户正在配置 HTTP 认证的用户名和密码，以及 30 秒的超时时间。](https://storage.googleapis.com/agent-tools-public-mde/1723154823293-2.png)
5.  创建 cron 作业后，在 `.env` 文件中设置 `Username` 和 `Password`。

    `.env`
    ```
    CRON_JOBS_USERNAME=your_username
    CRON_JOBS_PASSWORD=your_password
    ```

> ▲ 如果您正在设置环境，现在可以返回**环境设置指南**并继续。本指南的其余部分可以稍后阅读。
>
> **<> 环境设置**
> 设置环境变量

#### Cron Job 系统结构

*   **源码 (src)**
    *   `应用程序 (app)`
        *   `api`
            *   `分配信用 (distribute-credits)`
                *   `路线.ts (route.ts)`

文件 `src/app/api/distribute-credits/route.ts` 是用于向用户分配信用的 cron 作业 API 路由。

#### 用法

目前只有一个 cron 作业，用于向用户分发积分并处理积分到期。它应该每天运行，因此您应该在创建 cron 作业时设置正确的 **Execution schedule**。

当 cron 作业被触发时，它将向 `/api/distribute-credits` 路由发出请求，使用 `Username` 和 `Password` 作为基本身份验证凭据，向用户分配信用，并处理信用到期。

您可以通过点击 cron 作业页面中的 **TEST RUN** 按钮来测试 cron 作业，并在下图中的 **Response** 选项卡中检查响应。您还可以查看 cron 作业的执行历史记录。

![图片描述：cron-job.org 网站的任务测试运行结果界面。显示了名为 “distribute-credits-daily” 的任务执行成功（200 OK），并返回了包含处理和错误计数的 JSON 响应。](https://storage.googleapis.com/agent-tools-public-mde/1723154823293-3.png)

#### 参考

*   [Cron Job 官方网站](https://cron-job.org/)

#### 后续步骤

现在您已经启用了 cron 作业，您可能想要探索这些相关的集成：

| | |
| :--- | :--- |
| **支付**<br>配置支付服务 | **验证**<br>配置用户身份验证 |
| **分析**<br>配置分析 | **贮存**<br>配置存储 |

< **致谢**
了解如何在应用程序中设置和使用积分系统

**人工智能 >**
了解如何设置和使用 AI 功能